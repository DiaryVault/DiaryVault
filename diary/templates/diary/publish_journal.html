<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Journal Compiler - DiaryVault</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .btn-primary {
            background: linear-gradient(135deg, #6366f1, #4f46e5);
            color: white;
            border: none;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.3);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            transform: none;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: #f8fafc;
            color: #475569;
            border: 1px solid #e2e8f0;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
        }

        .step-indicator {
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.875rem;
            transition: all 0.3s ease;
        }

        /* Mobile step indicators */
        @media (max-width: 768px) {
            .step-indicator {
                width: 1.5rem;
                height: 1.5rem;
                font-size: 0.75rem;
            }
        }

        .step-indicator.completed {
            background: #10b981;
            color: white;
        }

        .step-indicator.active {
            background: #6366f1;
            color: white;
            animation: pulse 2s infinite;
        }

        .step-indicator.pending {
            background: #e5e7eb;
            color: #6b7280;
        }

        .step-line {
            height: 2px;
            background: #e5e7eb;
            width: 2rem;
        }

        /* Mobile step lines */
        @media (max-width: 768px) {
            .step-line {
                width: 1rem;
            }
        }

        .step-line.completed {
            background: #10b981;
        }

        .method-card {
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
        }

        .method-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 20px rgba(0, 0, 0, 0.1);
        }

        /* Reduce hover effects on mobile */
        @media (max-width: 768px) {
            .method-card:hover {
                transform: none;
            }
        }

        .method-card.selected {
            border-color: #6366f1;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.05), rgba(79, 70, 229, 0.02));
        }

        .entry-card {
            transition: all 0.2s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .entry-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        }

        @media (max-width: 768px) {
            .entry-card:hover {
                transform: none;
            }
        }

        .entry-card.selected {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.05);
        }

        .journal-card {
            transition: all 0.3s ease;
            border: 1px solid #e5e7eb;
        }

        .journal-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            border-color: #cbd5e1;
        }

        @media (max-width: 768px) {
            .journal-card:hover {
                transform: none;
            }
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
        }

        .loading-spinner {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            text-align: center;
            max-width: 400px;
            width: 100%;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .gradient-text {
            background: linear-gradient(135deg, #6366f1, #4f46e5);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .primary-600 { color: #4f46e5; }
        .secondary-600 { color: #475569; }
        .secondary-800 { color: #1e293b; }
        .success-600 { color: #059669; }
        .warning-600 { color: #d97706; }
        .error-600 { color: #dc2626; }

        /* Mobile-specific improvements */
        @media (max-width: 768px) {
            .mobile-sticky-header {
                position: sticky;
                top: 0;
                z-index: 40;
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(10px);
            }

            .mobile-bottom-actions {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: white;
                border-top: 1px solid #e5e7eb;
                padding: 1rem;
                z-index: 30;
                box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
            }

            .mobile-content-padding {
                padding-bottom: 100px;
            }

            .mobile-card-compact {
                padding: 1rem;
            }

            .mobile-text-base {
                font-size: 1rem;
                line-height: 1.5;
            }

            .mobile-grid-single {
                grid-template-columns: 1fr;
            }

            .touch-target {
                min-height: 44px;
                min-width: 44px;
            }
        }

        /* Improved form inputs for mobile */
        .form-input {
            -webkit-appearance: none;
            font-size: 16px; /* Prevents zoom on iOS */
        }

        /* Better modal positioning on mobile */
        @media (max-width: 768px) {
            .modal-content {
                margin: 1rem;
                max-height: calc(100vh - 2rem);
                overflow-y: auto;
            }
        }

        /* Swipe indicators */
        .swipe-hint {
            position: relative;
        }

        .swipe-hint::after {
            content: "← Swipe to see more →";
            position: absolute;
            bottom: -1.5rem;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.75rem;
            color: #9ca3af;
            opacity: 0.7;
        }

        @media (min-width: 768px) {
            .swipe-hint::after {
                display: none;
            }
        }

        /* Improved touch scrolling */
        .horizontal-scroll {
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .horizontal-scroll::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="max-w-6xl mx-auto mobile-content-padding">
        <!-- Mobile Sticky Header -->
        <div class="mobile-sticky-header md:hidden px-4 py-3 mb-4">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-xl font-bold gradient-text">Smart Journal</h1>
                    <p class="text-sm text-secondary-600">Step <span id="mobileCurrentStep">1</span> of 4</p>
                </div>
                <!-- Mobile Progress Steps -->
                <div class="flex items-center space-x-2">
                    <div class="step-indicator active" id="mobileStep1">1</div>
                    <div class="step-line" id="mobileLine1"></div>
                    <div class="step-indicator pending" id="mobileStep2">2</div>
                    <div class="step-line" id="mobileLine2"></div>
                    <div class="step-indicator pending" id="mobileStep3">3</div>
                    <div class="step-line" id="mobileLine3"></div>
                    <div class="step-indicator pending" id="mobileStep4">4</div>
                </div>
            </div>
        </div>

        <!-- Desktop Header -->
        <div class="hidden md:block p-6 space-y-8">
            <div class="glass-card rounded-3xl p-8">
                <div class="flex items-center justify-between mb-6">
                    <div>
                        <h1 class="text-4xl font-bold gradient-text">Smart Journal Compiler</h1>
                        <p class="text-lg text-secondary-600 mt-2">Transform your journal entries into publishable content</p>
                    </div>

                    <!-- Desktop Progress Steps -->
                    <div class="flex items-center space-x-4">
                        <div class="step-indicator active" id="step1">1</div>
                        <div class="step-line" id="line1"></div>
                        <div class="step-indicator pending" id="step2">2</div>
                        <div class="step-line" id="line2"></div>
                        <div class="step-indicator pending" id="step3">3</div>
                        <div class="step-line" id="line3"></div>
                        <div class="step-indicator pending" id="step4">4</div>
                    </div>
                </div>

                <!-- Stats Overview -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="text-center p-4 bg-white rounded-2xl">
                        <div class="text-3xl font-bold text-primary-600">42</div>
                        <div class="text-sm text-secondary-600">Total Entries</div>
                    </div>
                    <div class="text-center p-4 bg-white rounded-2xl">
                        <div class="text-3xl font-bold text-success-600">8</div>
                        <div class="text-sm text-secondary-600">Themes</div>
                    </div>
                    <div class="text-center p-4 bg-white rounded-2xl">
                        <div class="text-3xl font-bold text-warning-600">85%</div>
                        <div class="text-sm text-secondary-600">Quality Score</div>
                    </div>
                    <div class="text-center p-4 bg-white rounded-2xl">
                        <div class="text-3xl font-bold text-error-600">3</div>
                        <div class="text-sm text-secondary-600">Story Arcs</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mobile Stats Overview -->
        <div class="md:hidden px-4 mb-6">
            <div class="glass-card rounded-2xl p-4">
                <div class="grid grid-cols-2 gap-3">
                    <div class="text-center p-3 bg-white rounded-xl">
                        <div class="text-xl font-bold text-primary-600">42</div>
                        <div class="text-xs text-secondary-600">Entries</div>
                    </div>
                    <div class="text-center p-3 bg-white rounded-xl">
                        <div class="text-xl font-bold text-success-600">8</div>
                        <div class="text-xs text-secondary-600">Themes</div>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-3 mt-3">
                    <div class="text-center p-3 bg-white rounded-xl">
                        <div class="text-xl font-bold text-warning-600">85%</div>
                        <div class="text-xs text-secondary-600">Quality</div>
                    </div>
                    <div class="text-center p-3 bg-white rounded-xl">
                        <div class="text-xl font-bold text-error-600">3</div>
                        <div class="text-xs text-secondary-600">Story Arcs</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Compiled Journals -->
        <div class="px-4 md:px-6 mb-6 md:mb-8">
            <div class="glass-card rounded-2xl md:rounded-3xl p-4 md:p-6">
                <div class="flex items-center justify-between mb-4 md:mb-6">
                    <h2 class="text-lg md:text-2xl font-bold text-secondary-800">Your Journals</h2>
                    <span class="text-sm text-secondary-600">3 journals</span>
                </div>

                <!-- Mobile: Horizontal scroll -->
                <div class="md:hidden">
                    <div class="flex space-x-4 overflow-x-auto horizontal-scroll pb-4 swipe-hint">
                        <!-- Sample journal cards for mobile -->
                        <div class="journal-card bg-white rounded-xl p-4 min-w-[280px] flex-shrink-0">
                            <div class="flex items-start justify-between mb-3">
                                <h3 class="font-bold text-secondary-800 text-base leading-tight flex-1 mr-3">My Growth Journey</h3>
                                <span class="inline-flex items-center px-2 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full">
                                    <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                    </svg>
                                    Published
                                </span>
                            </div>
                            <p class="text-sm text-secondary-600 mb-4">A compilation of my personal development journey through 2024...</p>
                            <div class="flex justify-between items-center text-sm mb-4">
                                <span class="text-secondary-500">Mar 15, 2025</span>
                                <span class="text-secondary-500">12 entries</span>
                            </div>
                            <button class="btn-primary w-full py-2 text-sm rounded-lg touch-target">
                                View in Marketplace
                            </button>
                        </div>

                        <div class="journal-card bg-white rounded-xl p-4 min-w-[280px] flex-shrink-0">
                            <div class="flex items-start justify-between mb-3">
                                <h3 class="font-bold text-secondary-800 text-base leading-tight flex-1 mr-3">Travel Adventures 2024</h3>
                                <span class="inline-flex items-center px-2 py-1 bg-yellow-100 text-yellow-800 text-xs font-medium rounded-full">
                                    <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                                    </svg>
                                    Draft
                                </span>
                            </div>
                            <p class="text-sm text-secondary-600 mb-4">Stories from my travels across Europe and Asia...</p>
                            <div class="flex justify-between items-center text-sm mb-4">
                                <span class="text-secondary-500">Feb 28, 2025</span>
                                <span class="text-secondary-500">8 entries</span>
                            </div>
                            <button class="btn-secondary w-full py-2 text-sm rounded-lg touch-target">
                                Continue Editing
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Desktop: Grid layout -->
                <div class="hidden md:grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="journal-card bg-white rounded-xl p-6">
                        <div class="flex items-start justify-between mb-3">
                            <h3 class="font-bold text-secondary-800 text-lg leading-tight flex-1 mr-3">My Growth Journey</h3>
                            <span class="inline-flex items-center px-2 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full">
                                <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                </svg>
                                Published
                            </span>
                        </div>
                        <p class="text-sm text-secondary-600 mb-4 line-clamp-3">A compilation of my personal development journey through 2024, including insights on career growth, relationships, and self-discovery.</p>
                        <div class="flex justify-between items-center text-sm mb-4">
                            <div class="flex items-center space-x-4">
                                <span class="text-secondary-500">Mar 15, 2025</span>
                                <span class="text-secondary-500">12 entries</span>
                            </div>
                            <span class="font-bold text-success-600">$12.99</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button class="btn-primary px-4 py-2 text-sm rounded-lg flex-1 text-center">
                                View in Marketplace
                            </button>
                            <button class="text-secondary-500 hover:text-secondary-700 p-2" title="More options">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 1: Method Selection -->
        <div id="step1Content" class="px-4 md:px-6 mb-6 md:mb-8">
            <div class="glass-card rounded-2xl md:rounded-3xl mobile-card-compact md:p-8">
                <h2 class="text-lg md:text-2xl font-bold text-secondary-800 mb-4 md:mb-6">Choose Your Method</h2>

                <div class="grid mobile-grid-single md:grid-cols-3 gap-4 md:gap-6">
                    <div class="method-card glass-card rounded-2xl p-4 md:p-6 touch-target" data-method="ai">
                        <div class="text-center">
                            <div class="w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center mx-auto mb-3 md:mb-4">
                                <svg class="w-6 h-6 md:w-8 md:h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                                </svg>
                            </div>
                            <h3 class="text-lg md:text-xl font-bold mb-2">AI Smart Compilation</h3>
                            <p class="text-secondary-600 text-sm mb-3 md:mb-4">Let AI analyze your entries and create the optimal structure</p>
                            <div class="flex flex-wrap justify-center gap-1">
                                <span class="inline-block px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs">Theme Detection</span>
                                <span class="inline-block px-2 py-1 bg-purple-100 text-purple-800 rounded-full text-xs">Story Arcs</span>
                            </div>
                        </div>
                    </div>

                    <div class="method-card glass-card rounded-2xl p-4 md:p-6 touch-target" data-method="thematic">
                        <div class="text-center">
                            <div class="w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-green-500 to-teal-600 rounded-2xl flex items-center justify-center mx-auto mb-3 md:mb-4">
                                <svg class="w-6 h-6 md:w-8 md:h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"></path>
                                </svg>
                            </div>
                            <h3 class="text-lg md:text-xl font-bold mb-2">Thematic Collection</h3>
                            <p class="text-secondary-600 text-sm mb-3 md:mb-4">Organize entries around specific themes and topics</p>
                            <div class="flex flex-wrap justify-center gap-1">
                                <span class="inline-block px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs">Travel</span>
                                <span class="inline-block px-2 py-1 bg-teal-100 text-teal-800 rounded-full text-xs">Growth</span>
                            </div>
                        </div>
                    </div>

                    <div class="method-card glass-card rounded-2xl p-4 md:p-6 touch-target" data-method="chronological">
                        <div class="text-center">
                            <div class="w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-orange-500 to-red-600 rounded-2xl flex items-center justify-center mx-auto mb-3 md:mb-4">
                                <svg class="w-6 h-6 md:w-8 md:h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                            </div>
                            <h3 class="text-lg md:text-xl font-bold mb-2">Timeline Journey</h3>
                            <p class="text-secondary-600 text-sm mb-3 md:mb-4">Create a chronological narrative of your experiences</p>
                            <div class="flex flex-wrap justify-center gap-1">
                                <span class="inline-block px-2 py-1 bg-orange-100 text-orange-800 rounded-full text-xs">Timeline</span>
                                <span class="inline-block px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs">Journey</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 2: Entry Selection -->
        <div id="step2Content" class="px-4 md:px-6 mb-6 md:mb-8 hidden">
            <div class="glass-card rounded-2xl md:rounded-3xl mobile-card-compact md:p-8">
                <!-- Mobile Header -->
                <div class="md:hidden mb-4">
                    <h2 class="text-lg font-bold text-secondary-800 mb-2">Select Entries</h2>
                    <div class="flex items-center justify-between text-sm">
                        <span class="text-secondary-600">Selected: <span id="selectedCount">0</span></span>
                        <div class="space-x-2">
                            <button id="selectAllBtn" class="btn-secondary px-3 py-1 text-sm rounded touch-target">All</button>
                            <button id="selectNoneBtn" class="btn-secondary px-3 py-1 text-sm rounded touch-target">None</button>
                        </div>
                    </div>
                </div>

                <!-- Desktop Header -->
                <div class="hidden md:flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-secondary-800">Select Entries</h2>
                    <div class="flex items-center space-x-4">
                        <span class="text-sm text-secondary-600">Selected: <span id="selectedCountDesktop">0</span></span>
                        <div class="space-x-2">
                            <button id="selectAllBtnDesktop" class="btn-secondary px-3 py-1 text-sm rounded-lg">All</button>
                            <button id="selectNoneBtnDesktop" class="btn-secondary px-3 py-1 text-sm rounded-lg">None</button>
                        </div>
                    </div>
                </div>

                <div id="entriesGrid" class="grid mobile-grid-single md:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-4 mb-4 md:mb-6">
                    <!-- Sample entries -->
                    <div class="entry-card glass-card rounded-xl p-3 md:p-4 touch-target" data-entry-id="1">
                        <div class="flex items-start space-x-3">
                            <input type="checkbox" class="entry-checkbox mt-1 touch-target" value="1">
                            <div class="flex-1 min-w-0">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-medium text-secondary-800 flex-1 mr-2 entry-title truncate" data-original="My first day at the new job">My first day at the new job</h4>
                                    <button class="edit-entry-btn text-blue-600 hover:text-blue-800 text-sm touch-target" data-entry-id="1" title="Edit entry">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                        </svg>
                                    </button>
                                </div>
                                <p class="text-sm text-secondary-600 mb-2 entry-content" data-original="Today was nerve-wracking but exciting. I met my new team and got settled into my workspace. Everyone seems friendly and welcoming.">Today was nerve-wracking but exciting...</p>
                                <div class="flex justify-between text-xs text-secondary-500 mb-2">
                                    <span>Mar 1, 2025</span>
                                    <span class="word-count">45 words</span>
                                </div>
                                <div class="flex flex-wrap gap-1">
                                    <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs">career</span>
                                    <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs">growth</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="entry-card glass-card rounded-xl p-3 md:p-4 touch-target" data-entry-id="2">
                        <div class="flex items-start space-x-3">
                            <input type="checkbox" class="entry-checkbox mt-1 touch-target" value="2">
                            <div class="flex-1 min-w-0">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-medium text-secondary-800 flex-1 mr-2 entry-title truncate" data-original="Weekend hiking adventure">Weekend hiking adventure</h4>
                                    <button class="edit-entry-btn text-blue-600 hover:text-blue-800 text-sm touch-target" data-entry-id="2" title="Edit entry">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                        </svg>
                                    </button>
                                </div>
                                <p class="text-sm text-secondary-600 mb-2 entry-content" data-original="Explored the mountain trails near the city. The views were breathtaking and the exercise felt amazing after a week of desk work.">Explored the mountain trails near the city...</p>
                                <div class="flex justify-between text-xs text-secondary-500 mb-2">
                                    <span>Feb 28, 2025</span>
                                    <span class="word-count">32 words</span>
                                </div>
                                <div class="flex flex-wrap gap-1">
                                    <span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs">nature</span>
                                    <span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs">health</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Mobile Word Count Summary -->
                <div class="md:hidden text-center text-sm text-secondary-600 mb-4">
                    Estimated: <span id="totalWordsMobile">0</span> words
                </div>

                <!-- Desktop Footer -->
                <div class="hidden md:flex justify-between items-center">
                    <div class="text-sm text-secondary-600">
                        Estimated: <span id="totalWords">0</span> words
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 3: Analysis Results -->
        <div id="step3Content" class="px-4 md:px-6 mb-6 md:mb-8 hidden">
            <div class="glass-card rounded-2xl md:rounded-3xl mobile-card-compact md:p-8">
                <h2 class="text-lg md:text-2xl font-bold text-secondary-800 mb-4 md:mb-6">Analysis Results</h2>
                <div id="analysisResults">
                    <div class="text-center py-8">
                        <div class="w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-blue-100 to-purple-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                            <svg class="w-6 h-6 md:w-8 md:h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                        </div>
                        <div class="text-secondary-600">Analysis results will appear here...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 4: Structure & Publishing -->
        <div id="step4Content" class="px-4 md:px-6 mb-6 md:mb-8 hidden">
            <div class="glass-card rounded-2xl md:rounded-3xl mobile-card-compact md:p-8">
                <h2 class="text-lg md:text-2xl font-bold text-secondary-800 mb-4 md:mb-6">Journal Structure & Publishing</h2>

                <div class="grid mobile-grid-single lg:grid-cols-2 gap-6 md:gap-8">
                    <!-- Structure Preview -->
                    <div>
                        <h3 class="font-bold text-secondary-800 mb-4">Generated Structure</h3>
                        <div id="structurePreview" class="space-y-4">
                            <div class="text-center py-8 text-secondary-600">
                                Structure will appear here...
                            </div>
                        </div>
                    </div>

                    <!-- Publishing Form -->
                    <div>
                        <h3 class="font-bold text-secondary-800 mb-4">Publishing Details</h3>
                        <form id="publishForm" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-secondary-700 mb-2">Title</label>
                                <input type="text" id="journalTitle" required
                                       class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 touch-target"
                                       placeholder="Enter journal title...">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-secondary-700 mb-2">Description</label>
                                <textarea id="journalDescription" rows="4" required
                                          class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none"
                                          placeholder="Describe your journal..."></textarea>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-secondary-700 mb-2">Price ($)</label>
                                <input type="number" id="journalPrice" step="0.01" min="0"
                                       class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 touch-target"
                                       placeholder="9.99">
                            </div>

                            <div class="space-y-3">
                                <h4 class="font-medium text-secondary-700">Journal Type</h4>
                                <div class="space-y-2">
                                    <label class="flex items-center touch-target">
                                        <input type="radio" name="journalType" value="growth" class="mr-3" checked>
                                        <span class="text-sm">Personal Growth</span>
                                    </label>
                                    <label class="flex items-center touch-target">
                                        <input type="radio" name="journalType" value="travel" class="mr-3">
                                        <span class="text-sm">Travel & Adventures</span>
                                    </label>
                                    <label class="flex items-center touch-target">
                                        <input type="radio" name="journalType" value="career" class="mr-3">
                                        <span class="text-sm">Career Journey</span>
                                    </label>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mobile Bottom Actions -->
        <div class="mobile-bottom-actions md:hidden">
            <div id="mobileStep1Actions" class="space-y-3">
                <div class="text-xs text-center text-secondary-600 mb-2">Choose a compilation method above</div>
            </div>

            <div id="mobileStep2Actions" class="space-y-3 hidden">
                <div class="flex items-center justify-between text-sm mb-2">
                    <span class="text-secondary-600">Selected: <span id="selectedCountMobile">0</span> entries</span>
                    <span class="text-secondary-600"><span id="totalWordsMobileAction">0</span> words</span>
                </div>
                <button id="analyzeBtn" class="btn-primary w-full py-3 rounded-xl text-base font-semibold touch-target" disabled>
                    Analyze Selected Entries
                </button>
            </div>

            <div id="mobileStep3Actions" class="space-y-3 hidden">
                <button id="generateStructureBtn" class="btn-primary w-full py-3 rounded-xl text-base font-semibold touch-target" disabled>
                    Generate Journal Structure
                </button>
            </div>

            <div id="mobileStep4Actions" class="space-y-3 hidden">
                <button id="publishBtn" class="btn-primary w-full py-3 rounded-xl text-base font-semibold touch-target">
                    Publish Journal
                </button>
            </div>
        </div>

        <!-- Desktop Bottom Actions -->
        <div class="hidden md:block px-6 pb-8">
            <div id="desktopStep2Actions" class="text-center hidden">
                <button id="analyzeBtnDesktop" class="btn-primary px-6 py-3 rounded-xl text-base font-semibold" disabled>
                    Analyze Selected Entries
                </button>
            </div>

            <div id="desktopStep3Actions" class="text-center hidden">
                <button id="generateStructureBtnDesktop" class="btn-primary px-6 py-3 rounded-xl text-base font-semibold" disabled>
                    Generate Journal Structure
                </button>
            </div>

            <div id="desktopStep4Actions" class="text-center hidden">
                <button id="publishBtnDesktop" class="btn-primary px-6 py-3 rounded-xl text-base font-semibold">
                    Publish Journal
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
            <div id="loadingText" class="text-secondary-800 font-medium">Processing...</div>
            <div class="text-sm text-secondary-600 mt-2">This may take a moment</div>
        </div>
    </div>

    <!-- Edit Entry Modal -->
    <div id="editModal" class="loading-overlay" style="display: none;">
        <div class="modal-content bg-white rounded-2xl p-4 md:p-6 max-w-2xl w-full max-h-96 overflow-hidden">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg md:text-xl font-bold text-secondary-800">Edit Entry</h3>
                <button id="closeEditModal" class="text-gray-400 hover:text-gray-600 touch-target">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <form id="editEntryForm" class="space-y-4">
                <input type="hidden" id="editEntryId">
                <div>
                    <label class="block text-sm font-medium text-secondary-700 mb-2">Title</label>
                    <input type="text" id="editEntryTitle" required
                           class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 touch-target">
                </div>

                <div>
                    <label class="block text-sm font-medium text-secondary-700 mb-2">Content</label>
                    <textarea id="editEntryContent" rows="6" required
                              class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none"></textarea>
                </div>

                <div class="flex flex-col md:flex-row justify-end space-y-2 md:space-y-0 md:space-x-3 pt-4">
                    <button type="button" id="cancelEdit" class="btn-secondary px-4 py-3 md:py-2 rounded-lg touch-target">Cancel</button>
                    <button type="submit" class="btn-primary px-6 py-3 md:py-2 rounded-lg touch-target">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="loading-overlay" style="display: none;">
        <div class="loading-spinner">
            <div class="text-6xl text-green-500 mb-4">✓</div>
            <div class="text-secondary-800 font-medium text-xl mb-2">Journal Published!</div>
            <div class="text-sm text-secondary-600 mb-4">Your journal has been successfully published to the marketplace.</div>
            <button id="viewJournalBtn" class="btn-primary px-6 py-3 rounded-lg touch-target">View Journal</button>
        </div>
    </div>

    <script>
        class SmartJournalCompiler {
            constructor() {
                this.selectedMethod = null;
                this.selectedEntries = new Set();
                this.currentStep = 1;
                this.analysisData = null;
                this.structureData = null;

                this.init();
            }

            init() {
                this.bindEvents();
                this.updateStepDisplay();
            }

            bindEvents() {
                // Method selection
                document.querySelectorAll('.method-card').forEach(card => {
                    card.addEventListener('click', (e) => this.selectMethod(e));
                });

                // Entry selection
                document.querySelectorAll('.entry-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', (e) => this.updateSelectedEntries());
                });

                // Entry editing
                document.querySelectorAll('.edit-entry-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => this.openEditModal(e));
                });

                // Bind both mobile and desktop select buttons
                ['selectAllBtn', 'selectAllBtnDesktop'].forEach(id => {
                    document.getElementById(id)?.addEventListener('click', () => this.selectAllEntries());
                });

                ['selectNoneBtn', 'selectNoneBtnDesktop'].forEach(id => {
                    document.getElementById(id)?.addEventListener('click', () => this.selectNoneEntries());
                });

                // Edit modal events
                document.getElementById('closeEditModal')?.addEventListener('click', () => this.closeEditModal());
                document.getElementById('cancelEdit')?.addEventListener('click', () => this.closeEditModal());
                document.getElementById('editEntryForm')?.addEventListener('submit', (e) => this.saveEntryEdit(e));

                // Action buttons - both mobile and desktop
                ['analyzeBtn', 'analyzeBtnDesktop'].forEach(id => {
                    document.getElementById(id)?.addEventListener('click', (e) => this.analyzeEntries(e));
                });

                ['generateStructureBtn', 'generateStructureBtnDesktop'].forEach(id => {
                    document.getElementById(id)?.addEventListener('click', (e) => this.generateStructure(e));
                });

                ['publishBtn', 'publishBtnDesktop'].forEach(id => {
                    document.getElementById(id)?.addEventListener('click', (e) => this.publishJournal(e));
                });

                document.getElementById('publishForm')?.addEventListener('submit', (e) => this.publishJournal(e));
            }

            selectMethod(event) {
                // Remove previous selections
                document.querySelectorAll('.method-card').forEach(card => {
                    card.classList.remove('selected');
                });

                // Select clicked method
                const card = event.currentTarget;
                card.classList.add('selected');
                this.selectedMethod = card.dataset.method;

                console.log('Selected method:', this.selectedMethod);

                // Move to next step
                this.goToStep(2);
            }

            updateSelectedEntries() {
                const checkboxes = document.querySelectorAll('.entry-checkbox:checked');
                this.selectedEntries = new Set(Array.from(checkboxes).map(cb => parseInt(cb.value)));

                // Update all count displays
                const count = this.selectedEntries.size;
                ['selectedCount', 'selectedCountDesktop', 'selectedCountMobile'].forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.textContent = count;
                });

                // Calculate total words
                let totalWords = 0;
                checkboxes.forEach(cb => {
                    const card = cb.closest('.entry-card');
                    const wordCountEl = card.querySelector('.word-count');
                    const wordCount = wordCountEl.textContent.match(/\d+/);
                    if (wordCount) totalWords += parseInt(wordCount[0]);
                });

                // Update all word count displays
                ['totalWords', 'totalWordsMobile', 'totalWordsMobileAction'].forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.textContent = totalWords.toLocaleString();
                });

                // Enable/disable analyze buttons
                ['analyzeBtn', 'analyzeBtnDesktop'].forEach(id => {
                    const btn = document.getElementById(id);
                    if (btn) btn.disabled = this.selectedEntries.size === 0;
                });

                // Update entry card styling
                document.querySelectorAll('.entry-card').forEach(card => {
                    const checkbox = card.querySelector('.entry-checkbox');
                    if (checkbox.checked) {
                        card.classList.add('selected');
                    } else {
                        card.classList.remove('selected');
                    }
                });
            }

            openEditModal(event) {
                event.stopPropagation();
                const entryId = event.currentTarget.dataset.entryId;
                const entryCard = event.currentTarget.closest('.entry-card');

                // Get current entry data
                const title = entryCard.querySelector('.entry-title').dataset.original;
                const content = entryCard.querySelector('.entry-content').dataset.original;

                // Populate modal
                document.getElementById('editEntryId').value = entryId;
                document.getElementById('editEntryTitle').value = title;
                document.getElementById('editEntryContent').value = content;

                // Show modal
                document.getElementById('editModal').style.display = 'flex';
            }

            closeEditModal() {
                document.getElementById('editModal').style.display = 'none';
            }

            async saveEntryEdit(event) {
                event.preventDefault();

                const entryId = document.getElementById('editEntryId').value;
                const title = document.getElementById('editEntryTitle').value;
                const content = document.getElementById('editEntryContent').value;

                if (!title.trim() || !content.trim()) {
                    this.showError('Title and content are required');
                    return;
                }

                const submitBtn = event.target.querySelector('button[type="submit"]');
                const originalText = submitBtn.textContent;

                try {
                    submitBtn.disabled = true;
                    submitBtn.textContent = 'Saving...';

                    // Simulate API call
                    await new Promise(resolve => setTimeout(resolve, 1000));

                    // Update the entry card in the UI
                    this.updateEntryCardAfterEdit(entryId, title, content);
                    this.closeEditModal();
                    this.showSuccess('Entry updated successfully!');

                    // If this entry was selected, update the word count
                    const checkbox = document.querySelector(`input[value="${entryId}"]`);
                    if (checkbox && checkbox.checked) {
                        this.updateSelectedEntries();
                    }

                } catch (error) {
                    console.error('Save error:', error);
                    this.showError('Failed to save entry: ' + error.message);
                } finally {
                    submitBtn.disabled = false;
                    submitBtn.textContent = originalText;
                }
            }

            updateEntryCardAfterEdit(entryId, newTitle, newContent) {
                const entryCard = document.querySelector(`[data-entry-id="${entryId}"]`);
                if (!entryCard) return;

                // Update title
                const titleEl = entryCard.querySelector('.entry-title');
                titleEl.textContent = newTitle.length > 40 ? newTitle.substring(0, 40) + '...' : newTitle;
                titleEl.dataset.original = newTitle;

                // Update content
                const contentEl = entryCard.querySelector('.entry-content');
                contentEl.textContent = newContent.length > 80 ? newContent.substring(0, 80) + '...' : newContent;
                contentEl.dataset.original = newContent;

                // Update word count
                const wordCount = newContent.split(/\s+/).filter(word => word.length > 0).length;
                const wordCountEl = entryCard.querySelector('.word-count');
                wordCountEl.textContent = `${wordCount} words`;
            }

            selectAllEntries() {
                document.querySelectorAll('.entry-checkbox').forEach(cb => cb.checked = true);
                this.updateSelectedEntries();
            }

            selectNoneEntries() {
                document.querySelectorAll('.entry-checkbox').forEach(cb => cb.checked = false);
                this.updateSelectedEntries();
            }

            async analyzeEntries(event) {
                event.preventDefault();

                if (!this.selectedMethod || this.selectedEntries.size === 0) {
                    this.showError('Please select a method and entries first');
                    return;
                }

                const buttons = ['analyzeBtn', 'analyzeBtnDesktop'];
                const originalTexts = {};

                try {
                    this.showLoading('Analyzing your entries...');

                    // Disable all analyze buttons
                    buttons.forEach(id => {
                        const btn = document.getElementById(id);
                        if (btn) {
                            originalTexts[id] = btn.textContent;
                            btn.disabled = true;
                            btn.textContent = 'Analyzing...';
                        }
                    });

                    // Simulate API call
                    await new Promise(resolve => setTimeout(resolve, 2000));

                    const mockAnalysis = {
                        total_entries: this.selectedEntries.size,
                        themes: [
                            { name: 'Personal Growth', count: 3 },
                            { name: 'Career Development', count: 2 },
                            { name: 'Health & Wellness', count: 1 }
                        ],
                        quality_score: { score: 87 },
                        story_arcs: [
                            { title: 'Career Transition', entries: 2 },
                            { title: 'Personal Reflection', entries: 1 }
                        ],
                        ai_insights: 'Your entries show a strong focus on personal development and career growth, with consistent reflection on progress and challenges.'
                    };

                    this.analysisData = mockAnalysis;
                    this.displayAnalysisResults(mockAnalysis);
                    this.goToStep(3);
                    this.showSuccess('Analysis completed successfully!');

                } catch (error) {
                    console.error('Analysis error:', error);
                    this.showError('Failed to analyze entries: ' + error.message);
                } finally {
                    this.hideLoading();
                    // Restore all buttons
                    buttons.forEach(id => {
                        const btn = document.getElementById(id);
                        if (btn && originalTexts[id]) {
                            btn.disabled = false;
                            btn.textContent = originalTexts[id];
                        }
                    });
                }
            }

            async generateStructure(event) {
                event.preventDefault();

                if (!this.analysisData) {
                    this.showError('Please complete analysis first');
                    return;
                }

                const buttons = ['generateStructureBtn', 'generateStructureBtnDesktop'];
                const originalTexts = {};

                try {
                    this.showLoading('Generating journal structure...');

                    buttons.forEach(id => {
                        const btn = document.getElementById(id);
                        if (btn) {
                            originalTexts[id] = btn.textContent;
                            btn.disabled = true;
                            btn.textContent = 'Generating...';
                        }
                    });

                    // Simulate API call
                    await new Promise(resolve => setTimeout(resolve, 2000));

                    const mockStructure = {
                        title: 'My Growth Journey',
                        description: 'A compilation of personal development and career growth experiences',
                        chapters: [
                            {
                                title: 'Career Beginnings',
                                entry_count: 2,
                                description: 'Starting my new role and early experiences'
                            },
                            {
                                title: 'Personal Wellness',
                                entry_count: 1,
                                description: 'Health and lifestyle improvements'
                            }
                        ],
                        estimated_length: 1240,
                        suggested_price: '12.99'
                    };

                    this.structureData = mockStructure;
                    this.displayStructure(mockStructure);
                    this.populatePublishingForm(mockStructure);
                    this.goToStep(4);
                    this.showSuccess('Structure generated successfully!');

                } catch (error) {
                    console.error('Structure generation error:', error);
                    this.showError('Failed to generate structure: ' + error.message);
                } finally {
                    this.hideLoading();
                    buttons.forEach(id => {
                        const btn = document.getElementById(id);
                        if (btn && originalTexts[id]) {
                            btn.disabled = false;
                            btn.textContent = originalTexts[id];
                        }
                    });
                }
            }

            async publishJournal(event) {
                event.preventDefault();

                if (!this.structureData) {
                    this.showError('Please generate structure first');
                    return;
                }

                const title = document.getElementById('journalTitle').value;
                const description = document.getElementById('journalDescription').value;
                const price = parseFloat(document.getElementById('journalPrice').value || 0);

                if (!title || !description) {
                    this.showError('Please fill in all required fields');
                    return;
                }

                if (!confirm('Are you sure you want to publish this journal?')) {
                    return;
                }

                const buttons = ['publishBtn', 'publishBtnDesktop'];
                const originalTexts = {};

                try {
                    this.showLoading('Publishing your journal...');

                    buttons.forEach(id => {
                        const btn = document.getElementById(id);
                        if (btn) {
                            originalTexts[id] = btn.textContent;
                            btn.disabled = true;
                            btn.textContent = 'Publishing...';
                        }
                    });

                    // Simulate API call
                    await new Promise(resolve => setTimeout(resolve, 2000));

                    this.hideLoading();
                    this.showSuccessModal('123');

                } catch (error) {
                    console.error('Publishing error:', error);
                    this.showError('Failed to publish journal: ' + error.message);
                    this.hideLoading();
                    buttons.forEach(id => {
                        const btn = document.getElementById(id);
                        if (btn && originalTexts[id]) {
                            btn.disabled = false;
                            btn.textContent = originalTexts[id];
                        }
                    });
                }
            }

            displayAnalysisResults(analysis) {
                const container = document.getElementById('analysisResults');
                container.innerHTML = `
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4 mb-6">
                        <div class="text-center p-3 md:p-4 bg-white rounded-xl">
                            <div class="text-xl md:text-2xl font-bold text-blue-600">${analysis.total_entries || 0}</div>
                            <div class="text-xs md:text-sm text-gray-600">Entries</div>
                        </div>
                        <div class="text-center p-3 md:p-4 bg-white rounded-xl">
                            <div class="text-xl md:text-2xl font-bold text-green-600">${analysis.themes?.length || 0}</div>
                            <div class="text-xs md:text-sm text-gray-600">Themes</div>
                        </div>
                        <div class="text-center p-3 md:p-4 bg-white rounded-xl">
                            <div class="text-xl md:text-2xl font-bold text-yellow-600">${analysis.quality_score?.score || 0}%</div>
                            <div class="text-xs md:text-sm text-gray-600">Quality</div>
                        </div>
                        <div class="text-center p-3 md:p-4 bg-white rounded-xl">
                            <div class="text-xl md:text-2xl font-bold text-purple-600">${analysis.story_arcs?.length || 0}</div>
                            <div class="text-xs md:text-sm text-gray-600">Story Arcs</div>
                        </div>
                    </div>
                    <div class="bg-blue-50 rounded-xl p-4">
                        <h4 class="font-semibold text-blue-800 mb-2">Analysis Summary</h4>
                        <p class="text-blue-700 text-sm">${analysis.ai_insights || 'Your entries have been analyzed and are ready for compilation.'}</p>
                    </div>
                `;

                ['generateStructureBtn', 'generateStructureBtnDesktop'].forEach(id => {
                    const btn = document.getElementById(id);
                    if (btn) btn.disabled = false;
                });
            }

            displayStructure(structure) {
                const container = document.getElementById('structurePreview');

                let chaptersHtml = '';
                if (structure.chapters) {
                    chaptersHtml = structure.chapters.map((chapter, index) => `
                        <div class="border-l-4 border-blue-500 pl-4 py-2">
                            <h4 class="font-medium text-gray-800">${chapter.title}</h4>
                            <p class="text-sm text-gray-600">${chapter.entry_count || 0} entries</p>
                            <p class="text-xs text-gray-500">${chapter.description || ''}</p>
                        </div>
                    `).join('');
                }

                container.innerHTML = `
                    <div class="space-y-4">
                        <div class="bg-white rounded-xl p-4">
                            <h3 class="font-bold text-gray-800 mb-2">${structure.title || 'Generated Journal'}</h3>
                            <p class="text-gray-600 text-sm">${structure.description || ''}</p>
                        </div>
                        <div class="space-y-3">${chaptersHtml}</div>
                        <div class="bg-green-50 rounded-xl p-4">
                            <div class="text-sm">
                                <strong>Estimated Length:</strong> ${(structure.estimated_length || 0).toLocaleString()} words<br>
                                <strong>Suggested Price:</strong> ${structure.suggested_price || '9.99'}
                            </div>
                        </div>
                    </div>
                `;
            }

            populatePublishingForm(structure) {
                if (structure.title) {
                    document.getElementById('journalTitle').value = structure.title;
                }
                if (structure.description) {
                    document.getElementById('journalDescription').value = structure.description;
                }
                if (structure.suggested_price) {
                    const price = typeof structure.suggested_price === 'string'
                        ? structure.suggested_price.replace('
                    , '')
                        : structure.suggested_price;
                    document.getElementById('journalPrice').value = price;
                }
            }

            goToStep(step) {
                this.currentStep = step;
                this.updateStepDisplay();
            }

            updateStepDisplay() {
                // Hide all step contents
                for (let i = 1; i <= 4; i++) {
                    const content = document.getElementById(`step${i}Content`);
                    if (content) {
                        if (i === this.currentStep) {
                            content.classList.remove('hidden');
                            content.classList.add('fade-in');
                        } else {
                            content.classList.add('hidden');
                        }
                    }
                }

                // Update mobile step display
                const mobileCurrentStep = document.getElementById('mobileCurrentStep');
                if (mobileCurrentStep) {
                    mobileCurrentStep.textContent = this.currentStep;
                }

                // Update step indicators (both desktop and mobile)
                const indicators = ['step', 'mobileStep'];
                const lines = ['line', 'mobileLine'];

                indicators.forEach(prefix => {
                    for (let i = 1; i <= 4; i++) {
                        const indicator = document.getElementById(`${prefix}${i}`);
                        if (indicator) {
                            indicator.classList.remove('active', 'completed', 'pending');
                            if (i < this.currentStep) {
                                indicator.classList.add('completed');
                            } else if (i === this.currentStep) {
                                indicator.classList.add('active');
                            } else {
                                indicator.classList.add('pending');
                            }
                        }
                    }
                });

                lines.forEach(prefix => {
                    for (let i = 1; i < 4; i++) {
                        const line = document.getElementById(`${prefix}${i}`);
                        if (line) {
                            line.classList.toggle('completed', i < this.currentStep);
                        }
                    }
                });

                // Show/hide mobile action buttons
                for (let i = 1; i <= 4; i++) {
                    const actions = document.getElementById(`mobileStep${i}Actions`);
                    if (actions) {
                        if (i === this.currentStep) {
                            actions.classList.remove('hidden');
                        } else {
                            actions.classList.add('hidden');
                        }
                    }
                }

                // Show/hide desktop action buttons
                for (let i = 2; i <= 4; i++) {
                    const actions = document.getElementById(`desktopStep${i}Actions`);
                    if (actions) {
                        if (i === this.currentStep) {
                            actions.classList.remove('hidden');
                        } else {
                            actions.classList.add('hidden');
                        }
                    }
                }
            }

            showLoading(message) {
                document.getElementById('loadingText').textContent = message;
                document.getElementById('loadingOverlay').style.display = 'flex';
            }

            hideLoading() {
                document.getElementById('loadingOverlay').style.display = 'none';
            }

            showSuccessModal(journalId) {
                const modal = document.getElementById('successModal');
                modal.style.display = 'flex';

                document.getElementById('viewJournalBtn').onclick = () => {
                    window.location.href = `/marketplace/journal/${journalId}/`;
                };
            }

            showSuccess(message) {
                this.showToast(message, 'success');
            }

            showError(message) {
                this.showToast(message, 'error');
            }

            showToast(message, type = 'success') {
                const toast = document.createElement('div');
                const bgColor = type === 'success' ? 'bg-green-500' : 'bg-red-500';
                const duration = type === 'success' ? 3000 : 4000;

                toast.className = `fixed top-4 right-4 ${bgColor} text-white px-4 md:px-6 py-3 rounded-lg shadow-lg z-50 transform translate-x-full transition-transform duration-300 max-w-sm mx-4`;
                toast.textContent = message;

                document.body.appendChild(toast);

                // Show toast
                setTimeout(() => {
                    toast.classList.remove('translate-x-full');
                }, 100);

                // Hide toast
                setTimeout(() => {
                    toast.classList.add('translate-x-full');
                    setTimeout(() => {
                        if (document.body.contains(toast)) {
                            document.body.removeChild(toast);
                        }
                    }, 300);
                }, duration);
            }

            getCSRFToken() {
                return document.querySelector('[name=csrfmiddlewaretoken]')?.value || '';
            }
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            new SmartJournalCompiler();

            // Add touch event handling for better mobile interaction
            if ('ontouchstart' in window) {
                document.body.classList.add('touch-device');

                // Improve scrolling on mobile
                document.querySelectorAll('.horizontal-scroll').forEach(element => {
                    let isScrolling = false;

                    element.addEventListener('touchstart', () => {
                        isScrolling = true;
                    });

                    element.addEventListener('touchend', () => {
                        setTimeout(() => {
                            isScrolling = false;
                        }, 100);
                    });
                });
            }

            // Prevent zoom on input focus for iOS
            if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
                document.querySelectorAll('input, textarea, select').forEach(element => {
                    element.addEventListener('focus', function() {
                        if (this.style.fontSize !== '16px') {
                            this.style.fontSize = '16px';
                        }
                    });
                });
            }

            // Add smooth scrolling behavior
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });
        });
    </script>
</body>
</html>
