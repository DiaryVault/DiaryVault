{% extends '../../base.html' %}
{% load widget_tweaks %}
{% load allauth account socialaccount %}

{% block title %}Login - DiaryVault{% endblock %}

{% block extra_css %}
<style>
  /* CSS Custom Properties for better maintainability */
  :root {
    --primary-50: #f0f9ff;
    --primary-500: #6366f1;
    --primary-600: #4f46e5;
    --primary-700: #4338ca;
    --secondary-500: #8b5cf6;
    --secondary-600: #7c3aed;
    --success-500: #10b981;
    --error-500: #ef4444;
    --gray-50: #f9fafb;
    --gray-100: #f3f4f6;
    --gray-400: #9ca3af;
    --gray-600: #6b7280;
    --gray-700: #374151;
    --gray-800: #1f2937;
    --border-radius: 0.75rem;
    --border-radius-lg: 1rem;
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    --transition-base: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    --transition-smooth: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  }

  /* Optimized font loading */
  .diary-font {
    font-family: 'Playfair Display', serif;
    letter-spacing: -0.01em;
    line-height: 1.5;
    font-display: swap;
  }

  .handwritten {
    font-family: 'Satisfy', cursive;
    letter-spacing: 0.01em;
    line-height: 1.7;
    font-display: swap;
  }

  /* Reduced motion preference support */
  @media (prefers-reduced-motion: reduce) {
    *, *::before, *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }

  /* Optimized animations - reduced complexity */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(1rem);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes scaleIn {
    from {
      opacity: 0;
      transform: scale(0.98);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  @keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-0.5rem); }
  }

  @keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }

  /* Animation classes */
  .animate-fade-in-up {
    animation: fadeInUp 0.6s ease forwards;
  }

  .animate-scale-in {
    animation: scaleIn 0.4s ease forwards;
  }

  .animate-float {
    animation: float 4s ease-in-out infinite;
  }

  .delay-100 { animation-delay: 100ms; }
  .delay-200 { animation-delay: 200ms; }
  .delay-300 { animation-delay: 300ms; }
  .delay-400 { animation-delay: 400ms; }

  /* Enhanced button system */
  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    font-weight: 500;
    border-radius: var(--border-radius);
    transition: var(--transition-base);
    min-height: 2.75rem;
    position: relative;
    overflow: hidden;
    text-decoration: none;
    border: 1px solid transparent;
  }

  .btn:focus-visible {
    outline: 2px solid var(--primary-500);
    outline-offset: 2px;
  }

  .btn-primary {
    background: linear-gradient(135deg, var(--primary-500) 0%, var(--secondary-500) 100%);
    color: white;
  }

  .btn-primary:hover:not(:disabled) {
    background: linear-gradient(135deg, var(--primary-600) 0%, var(--secondary-600) 100%);
    transform: translateY(-1px);
    box-shadow: 0 8px 20px -5px rgba(99, 102, 241, 0.4);
  }

  .btn-primary:disabled {
    opacity: 0.7;
    cursor: not-allowed;
    transform: none;
  }

  /* Enhanced social buttons */
  .btn-social {
    background: white;
    border: 1px solid #e5e7eb;
    color: #374151;
    position: relative;
    overflow: hidden;
  }

  .btn-social::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
    transition: left 0.5s;
  }

  .btn-social:hover::before {
    left: 100%;
  }

  .btn-social:hover {
    transform: translateY(-1px);
    box-shadow: var(--shadow-lg);
    border-color: #d1d5db;
  }

  .btn-social.google:hover { background: #f8f9fa; }
  .btn-social.apple { background: #000; color: #fff; }
  .btn-social.apple:hover { background: #1a1a1a; }
  .btn-social.microsoft { background: #0078d4; color: #fff; }
  .btn-social.microsoft:hover { background: #106ebe; }

  /* Enhanced form system */
  .form-group {
    margin-bottom: 1.5rem;
  }

  .form-label {
    display: block;
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--gray-700);
    margin-bottom: 0.5rem;
  }

  .form-input-wrapper {
    position: relative;
  }

  .form-input {
    width: 100%;
    padding: 0.75rem 1rem 0.75rem 2.5rem;
    border: 1px solid #d1d5db;
    border-radius: var(--border-radius);
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(8px);
    transition: var(--transition-base);
    font-size: 1rem;
  }

  .form-input:focus {
    outline: none;
    border-color: var(--primary-500);
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    background: rgba(255, 255, 255, 0.95);
    transform: translateY(-1px);
  }

  .form-input.error {
    border-color: var(--error-500);
    box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
  }

  .form-input.success {
    border-color: var(--success-500);
    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
  }

  .form-icon {
    position: absolute;
    left: 0.75rem;
    top: 50%;
    transform: translateY(-50%);
    width: 1.25rem;
    height: 1.25rem;
    color: var(--gray-400);
    transition: var(--transition-base);
    pointer-events: none;
  }

  .form-input:focus + .form-icon {
    color: var(--primary-500);
  }

  .password-toggle {
    position: absolute;
    right: 0.75rem;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    cursor: pointer;
    padding: 0.25rem;
    color: var(--gray-400);
    transition: var(--transition-base);
    border-radius: 0.25rem;
  }

  .password-toggle:hover {
    color: var(--primary-500);
  }

  .password-toggle:focus-visible {
    outline: 2px solid var(--primary-500);
    outline-offset: 2px;
  }

  /* Enhanced card system */
  .card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(16px);
    border: 1px solid rgba(255, 255, 255, 0.5);
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow-xl);
    transition: var(--transition-smooth);
  }

  .card:hover {
    transform: translateY(-2px);
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
  }

  /* Enhanced alert system */
  .alert {
    border-radius: var(--border-radius);
    padding: 1rem;
    margin-bottom: 1rem;
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
  }

  .alert-error {
    background: linear-gradient(135deg, #fef2f2 0%, #fdf2f8 100%);
    border: 1px solid #fecaca;
    color: #991b1b;
  }

  .alert-success {
    background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%);
    border: 1px solid #bbf7d0;
    color: #065f46;
  }

  /* Trust indicators */
  .trust-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.25rem 0.75rem;
    background: rgba(34, 197, 94, 0.1);
    border: 1px solid rgba(34, 197, 94, 0.2);
    border-radius: 50px;
    color: #059669;
    font-size: 0.75rem;
    font-weight: 500;
  }

  /* Divider */
  .divider {
    position: relative;
    text-align: center;
    margin: 2rem 0;
  }

  .divider::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, #e5e7eb, transparent);
  }

  .divider span {
    background: white;
    padding: 0 1rem;
    color: var(--gray-600);
    font-size: 0.875rem;
  }

  /* Background decorations */
  .bg-decoration {
    position: absolute;
    border-radius: 50%;
    mix-blend-mode: multiply;
    filter: blur(40px);
    opacity: 0.3;
  }

  .bg-decoration-1 {
    top: -2rem;
    left: -4rem;
    width: 8rem;
    height: 8rem;
    background: var(--secondary-500);
    animation: float 6s ease-in-out infinite;
  }

  .bg-decoration-2 {
    bottom: -2rem;
    right: -4rem;
    width: 8rem;
    height: 8rem;
    background: var(--primary-500);
    animation: float 6s ease-in-out infinite reverse;
  }

  .bg-decoration-3 {
    top: 33%;
    left: 25%;
    width: 6rem;
    height: 6rem;
    background: #f59e0b;
    opacity: 0.2;
    animation: float 8s ease-in-out infinite;
    animation-delay: 2s;
  }

  /* Header gradient */
  .header-gradient {
    background: linear-gradient(135deg, var(--primary-500) 0%, var(--secondary-500) 100%);
    position: relative;
    overflow: hidden;
  }

  .header-gradient::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
    animation: float 10s ease-in-out infinite;
  }

  /* Loading animation */
  .loading-dots::after {
    content: '';
    animation: loading-dots 1.5s infinite;
  }

  @keyframes loading-dots {
    0%, 20% { content: '.'; }
    40% { content: '..'; }
    60% { content: '...'; }
    80%, 100% { content: ''; }
  }

  /* Responsive improvements */
  @media (max-width: 640px) {
    .btn {
      min-height: 2.75rem;
      padding: 0.75rem 1rem;
    }

    .form-input {
      font-size: 1rem; /* Prevents zoom on iOS */
      min-height: 2.75rem;
    }

    .form-icon {
      left: 0.75rem;
    }
  }

  /* High contrast mode support */
  @media (prefers-contrast: high) {
    .btn-primary {
      background: #000;
      border: 2px solid #000;
    }

    .form-input {
      border-width: 2px;
    }
  }

  /* Dark mode support (if needed) */
  @media (prefers-color-scheme: dark) {
    :root {
      --gray-50: #1f2937;
      --gray-100: #374151;
      --gray-400: #9ca3af;
      --gray-600: #d1d5db;
      --gray-700: #f3f4f6;
      --gray-800: #f9fafb;
    }
  }
</style>
{% endblock %}

{% block content %}
<!-- Skip link for accessibility -->
<a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-0 focus:left-0 focus:z-50 focus:px-4 focus:py-2 focus:bg-white focus:text-gray-900 focus:outline-offset-0 focus:outline-2 focus:outline-blue-500">
  Skip to main content
</a>

<div id="main-content" class="min-h-screen flex items-center justify-center p-4 relative">
  <!-- Background decorations -->
  <div class="bg-decoration bg-decoration-1" aria-hidden="true"></div>
  <div class="bg-decoration bg-decoration-2" aria-hidden="true"></div>
  <div class="bg-decoration bg-decoration-3" aria-hidden="true"></div>

  <div class="w-full max-w-md animate-scale-in">
    <!-- Main card -->
    <div class="card relative z-10">
      <!-- Header -->
      <div class="header-gradient p-6 text-center relative">
        <div class="flex items-center justify-center gap-3 relative z-10">
          <div class="animate-float" aria-hidden="true">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
            </svg>
          </div>
          <h1 class="text-2xl font-bold text-white diary-font">DiaryVault</h1>
        </div>
      </div>

      <div class="p-8">
        <!-- Welcome section -->
        <div class="text-center mb-6 animate-fade-in-up">
          <h2 class="text-2xl font-bold text-gray-800 mb-2 diary-font">Welcome Back</h2>
          <p class="text-gray-600 text-sm mb-4">Sign in to continue your journaling journey</p>

          <!-- Trust indicators -->
          <div class="flex justify-center gap-2">
            <div class="trust-badge">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
              </svg>
              <span>Secure</span>
            </div>
            <div class="trust-badge">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
              </svg>
              <span>Private</span>
            </div>
          </div>
        </div>

        <!-- Error display -->
        {% if form.errors or form.non_field_errors %}
        <div class="alert alert-error animate-fade-in-up" role="alert">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
          </svg>
          <div>
            <p class="font-medium">Authentication Failed</p>
            {% if form.non_field_errors %}
              {% for error in form.non_field_errors %}
                <p>{{ error }}</p>
              {% endfor %}
            {% else %}
              <p>Please check your login credentials and try again.</p>
            {% endif %}
          </div>
        </div>
        {% endif %}

        <!-- DEBUG: Social Authentication -->
        {% get_providers as socialaccount_providers %}

        <!-- DEBUG INFO (remove in production) -->
        {% if debug %}
        <div class="bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded mb-4">
          <strong>Debug Info:</strong><br>
          Available providers: {{ socialaccount_providers|length }}<br>
          {% for provider in socialaccount_providers %}
            - {{ provider.name }} ({{ provider.id }})<br>
          {% empty %}
            No providers found!<br>
          {% endfor %}
          Context available: {{ socialaccount|yesno:"Yes,No" }}<br>
          Sites framework: {{ site.domain|default:"Not configured" }}
        </div>
        {% endif %}

        {% if socialaccount_providers %}
        <div class="space-y-3 mb-6 animate-fade-in-up delay-100">
          {% for provider in socialaccount_providers %}
            {% if provider.id == "google" %}
              <a href="{% provider_login_url provider.id %}"
                 class="btn btn-social google w-full"
                 aria-label="Continue with Google">
                <svg class="w-5 h-5" viewBox="0 0 24 24" aria-hidden="true">
                  <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                  <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                  <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                  <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                </svg>
                <span>Continue with Google</span>
              </a>
            {% elif provider.id == "apple" %}
              <a href="{% provider_login_url provider.id %}"
                 class="btn btn-social apple w-full"
                 aria-label="Continue with Apple">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"/>
                </svg>
                <span>Continue with Apple</span>
              </a>
            {% elif provider.id == "microsoft" %}
              <a href="{% provider_login_url provider.id %}"
                 class="btn btn-social microsoft w-full"
                 aria-label="Continue with Microsoft">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M11.4 24H0V12.6h11.4V24zM24 24H12.6V12.6H24V24zM11.4 11.4H0V0h11.4v11.4zm12.6 0H12.6V0H24v11.4z"/>
                </svg>
                <span>Continue with Microsoft</span>
              </a>
            {% endif %}
          {% endfor %}
        </div>
        {% endif %}

        <!-- Divider -->
        <div class="divider animate-fade-in-up delay-200">
          <span>or sign in with your account</span>
        </div>

        <!-- Login form -->
        {% url 'account_login' as login_url %}
        <form method="post" action="{{ login_url }}" class="space-y-6 animate-fade-in-up delay-300" id="loginForm" novalidate>
          {% csrf_token %}

          {% for field in form %}
            <div class="form-group">
              <label for="{{ field.id_for_label }}" class="form-label">
                {% if field.name == 'login' %}
                  Username or Email
                {% else %}
                  {{ field.label }}
                {% endif %}
                {% if field.field.required %}
                  <span class="text-red-500" aria-label="required">*</span>
                {% endif %}
              </label>

              <div class="form-input-wrapper">
                {{ field|add_class:"form-input" }}

                <!-- Field icon -->
                {% if field.name == 'login' %}
                  <svg xmlns="http://www.w3.org/2000/svg" class="form-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                  </svg>
                {% elif field.name == 'password' %}
                  <svg xmlns="http://www.w3.org/2000/svg" class="form-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                  </svg>

                  <!-- Password toggle -->
                  <button type="button" class="password-toggle" onclick="togglePassword('{{ field.id_for_label }}')" aria-label="Toggle password visibility">
                    <svg id="eye-closed-{{ field.id_for_label }}" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L8.464 8.464a12.067 12.067 0 01-2.35-1.878m13.832.08L17.45 9.12" />
                    </svg>
                    <svg id="eye-open-{{ field.id_for_label }}" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                      <path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                    </svg>
                  </button>
                {% endif %}
              </div>

              <!-- Field errors -->
              {% if field.errors %}
                <div class="mt-1 text-sm text-red-600" role="alert">
                  {% for error in field.errors %}
                    <p>{{ error }}</p>
                  {% endfor %}
                </div>
              {% endif %}

              <!-- Help text -->
              {% if field.name == 'login' %}
                <div class="mt-1 text-xs text-gray-500">
                  You can use either your username or email address
                </div>
              {% endif %}
            </div>
          {% endfor %}

          <!-- Form options -->
          <div class="flex items-center justify-between">
            <label class="flex items-center cursor-pointer">
              <input id="remember_me" name="remember" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
              <span class="ml-2 text-sm text-gray-700">Keep me signed in</span>
            </label>
            <a href="{% url 'account_reset_password' %}" class="text-sm text-blue-600 hover:text-blue-800 transition-colors">
              Forgot password?
            </a>
          </div>

          <!-- Hidden fields -->
          {% if redirect_field_value %}
            <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}" />
          {% endif %}

          <!-- Submit button -->
          <button type="submit" id="loginButton" class="btn btn-primary w-full" aria-describedby="login-button-description">
            <span id="buttonText">Sign In</span>
            <svg id="buttonIcon" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M14 5l7 7m0 0l-7 7m7-7H3" />
            </svg>
            <svg id="loadingIcon" class="animate-spin h-4 w-4 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" aria-hidden="true">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
          </button>
          <div id="login-button-description" class="sr-only">
            Submits the login form to authenticate your account
          </div>
        </form>

        <!-- Sign up section -->
        <div class="mt-8 text-center animate-fade-in-up delay-400">
          <p class="text-gray-600 text-sm mb-3">Don't have an account yet?</p>
          <a href="{% url 'account_signup' %}" class="text-blue-600 font-medium hover:text-blue-800 text-sm inline-flex items-center gap-2 transition-colors">
            <span>Create your free account</span>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
              <path fill-rule="evenodd" d="M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" />
            </svg>
          </a>

          <!-- Benefits -->
          <div class="mt-4 flex justify-center gap-4 text-xs text-gray-500">
            <div class="flex items-center gap-1">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
              </svg>
              <span>Free forever</span>
            </div>
            <div class="flex items-center gap-1">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
              </svg>
              <span>AI-powered</span>
            </div>
            <div class="flex items-center gap-1">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
              </svg>
              <span>Private & secure</span>
            </div>
          </div>
        </div>

        <!-- Back to home -->
        <div class="mt-8 pt-6 border-t border-gray-200 text-center">
          <a href="{% url 'home' %}" class="text-gray-500 text-sm hover:text-blue-600 inline-flex items-center gap-1 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
            </svg>
            <span>Back to home</span>
          </a>
        </div>
      </div>
    </div>

    <!-- Testimonial -->
    <div class="mt-8 text-center animate-fade-in-up delay-400">
      <div class="card inline-block p-6 max-w-sm">
        <div class="flex items-center justify-center mb-3">
          <div class="flex text-yellow-400" aria-label="5 star rating">
            {% for i in "12345" %}
              <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
              </svg>
            {% endfor %}
          </div>
        </div>
        <blockquote class="handwritten text-gray-700 text-lg leading-relaxed mb-4">
          "DiaryVault helps me reflect on life's journey every day."
        </blockquote>
        <div class="flex items-center justify-center gap-3">
          <div class="w-8 h-8 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full flex items-center justify-center text-white text-sm font-bold">
            S
          </div>
          <div class="text-left">
            <p class="text-sm font-medium text-gray-900">Sarah J.</p>
            <p class="text-xs text-gray-500">Community Member</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Modern JavaScript with better performance and accessibility
class LoginForm {
  constructor() {
    this.form = document.getElementById('loginForm');
    this.submitButton = document.getElementById('loginButton');
    this.init();
  }

  init() {
    if (!this.form || !this.submitButton) return;

    this.setupEventListeners();
    this.setupValidation();
    this.autoFocusFirstField();
  }

  setupEventListeners() {
    // Form submission
    this.form.addEventListener('submit', (e) => {
      this.handleSubmit(e);
    });

    // Input enhancements
    const inputs = this.form.querySelectorAll('.form-input');
    inputs.forEach(input => {
      input.addEventListener('focus', this.handleInputFocus.bind(this));
      input.addEventListener('blur', this.handleInputBlur.bind(this));
      input.addEventListener('input', this.handleInputChange.bind(this));
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', this.handleKeyboardShortcuts.bind(this));
  }

  setupValidation() {
    const loginInput = this.form.querySelector('input[name="login"]');
    const passwordInput = this.form.querySelector('input[name="password"]');

    if (loginInput) {
      loginInput.addEventListener('input', () => this.validateLogin(loginInput));
    }

    if (passwordInput) {
      passwordInput.addEventListener('input', () => this.validatePassword(passwordInput));
    }
  }

  validateLogin(input) {
    const value = input.value.trim();
    this.updateFieldValidation(input, value.length >= 3 || this.isValidEmail(value));
  }

  validatePassword(input) {
    const value = input.value;
    this.updateFieldValidation(input, value.length >= 6);
  }

  updateFieldValidation(input, isValid) {
    input.classList.remove('error', 'success');
    if (input.value.length > 0) {
      input.classList.add(isValid ? 'success' : 'error');
    }
  }

  isValidEmail(email) {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
  }

  handleInputFocus(e) {
    const icon = e.target.parentElement.querySelector('.form-icon');
    if (icon) {
      icon.style.color = 'var(--primary-500)';
    }
  }

  handleInputBlur(e) {
    const icon = e.target.parentElement.querySelector('.form-icon');
    if (icon) {
      icon.style.color = 'var(--gray-400)';
    }
  }

  handleInputChange(e) {
    // Clear previous validation classes if input is empty
    if (!e.target.value.trim()) {
      e.target.classList.remove('error', 'success');
    }
  }

  handleSubmit(e) {
    this.setLoadingState(true);

    // Validate form before submission
    const isValid = this.validateForm();
    if (!isValid) {
      e.preventDefault();
      this.setLoadingState(false);
      this.showValidationErrors();
    }
  }

  validateForm() {
    const loginInput = this.form.querySelector('input[name="login"]');
    const passwordInput = this.form.querySelector('input[name="password"]');

    let isValid = true;

    if (!loginInput.value.trim()) {
      this.updateFieldValidation(loginInput, false);
      isValid = false;
    }

    if (!passwordInput.value) {
      this.updateFieldValidation(passwordInput, false);
      isValid = false;
    }

    return isValid;
  }

  showValidationErrors() {
    const firstErrorField = this.form.querySelector('.form-input.error');
    if (firstErrorField) {
      firstErrorField.focus();
      firstErrorField.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  }

  setLoadingState(loading) {
    const buttonText = document.getElementById('buttonText');
    const buttonIcon = document.getElementById('buttonIcon');
    const loadingIcon = document.getElementById('loadingIcon');

    if (loading) {
      this.submitButton.disabled = true;
      this.submitButton.classList.add('opacity-75');
      buttonText.textContent = 'Signing in';
      buttonIcon.classList.add('hidden');
      loadingIcon.classList.remove('hidden');
    } else {
      this.submitButton.disabled = false;
      this.submitButton.classList.remove('opacity-75');
      buttonText.textContent = 'Sign In';
      buttonIcon.classList.remove('hidden');
      loadingIcon.classList.add('hidden');
    }
  }

  handleKeyboardShortcuts(e) {
    // Alt + L for login focus
    if (e.altKey && e.key === 'l') {
      e.preventDefault();
      const loginInput = this.form.querySelector('input[name="login"]');
      if (loginInput) loginInput.focus();
    }

    // Escape to clear form
    if (e.key === 'Escape') {
      this.form.reset();
      this.form.querySelectorAll('.form-input').forEach(input => {
        input.classList.remove('error', 'success');
      });
    }
  }

  autoFocusFirstField() {
    // Auto-focus first empty field after animations
    setTimeout(() => {
      const loginInput = this.form.querySelector('input[name="login"]');
      if (loginInput && !loginInput.value) {
        loginInput.focus();
      }
    }, 800);
  }
}

// Password toggle functionality
function togglePassword(fieldId) {
  const passwordInput = document.getElementById(fieldId);
  const eyeClosed = document.getElementById(`eye-closed-${fieldId}`);
  const eyeOpen = document.getElementById(`eye-open-${fieldId}`);

  const isPassword = passwordInput.type === 'password';

  passwordInput.type = isPassword ? 'text' : 'password';
  eyeClosed.classList.toggle('hidden', isPassword);
  eyeOpen.classList.toggle('hidden', !isPassword);

  // Maintain focus
  passwordInput.focus();
}

// Initialize when DOM is ready
document.addEventListener('DOMContentLoaded', () => {
  new LoginForm();
});

// Handle page visibility for better UX
document.addEventListener('visibilitychange', () => {
  if (document.visibilityState === 'visible') {
    // Re-focus form if user returns to tab
    const loginInput = document.querySelector('input[name="login"]');
    if (loginInput && !loginInput.value) {
      setTimeout(() => loginInput.focus(), 100);
    }
  }
});
</script>

{% endblock %}
