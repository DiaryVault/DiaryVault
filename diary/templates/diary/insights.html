{% extends 'base.html' %}

{% block title %}DiaryVault - AI Insights{% endblock %}

{% block extra_css %}
<style>
  /* Core branding elements from home.html */
  .diary-font {
    font-family: 'Playfair Display', serif;
    letter-spacing: -0.01em;
    line-height: 1.5;
  }

  .handwritten {
    font-family: 'Satisfy', cursive;
    letter-spacing: 0.01em;
    line-height: 1.7;
  }

  /* Enhanced animations from home.html */
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes scaleIn {
    from { opacity: 0; transform: scale(0.95); }
    to { opacity: 1; transform: scale(1); }
  }

  @keyframes float {
    0% { transform: translateY(0px) translateZ(0); }
    50% { transform: translateY(-8px) translateZ(0); }
    100% { transform: translateY(0px) translateZ(0); }
  }

  @keyframes blob {
    0% { transform: translate(0px, 0px) scale(1) translateZ(0); }
    33% { transform: translate(20px, -15px) scale(1.05) translateZ(0); }
    66% { transform: translate(-15px, 15px) scale(0.95) translateZ(0); }
    100% { transform: translate(0px, 0px) scale(1) translateZ(0); }
  }

  .animate-fade-in {
    animation: fadeIn 0.8s ease forwards;
    opacity: 0;
  }

  .animate-scale-in {
    animation: scaleIn 0.6s ease forwards;
    opacity: 0;
  }

  .animate-float {
    animation: float 6s ease-in-out infinite;
  }

  .animate-blob {
    animation: blob 10s infinite;
  }

  .animation-delay-200 { animation-delay: 200ms; }
  .animation-delay-400 { animation-delay: 400ms; }
  .animation-delay-600 { animation-delay: 600ms; }
  .animation-delay-800 { animation-delay: 800ms; }
  .animation-delay-1000 { animation-delay: 1000ms; }
  .animation-delay-2000 { animation-delay: 2s; }
  .animation-delay-4000 { animation-delay: 4s; }

  /* Enhanced card styling from home.html */
  .insight-card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(12px);
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    transition: all 0.3s cubic-bezier(0.165, 0.84, 0.44, 1);
    position: relative;
    border: 1px solid rgba(255, 255, 255, 0.2);
    will-change: transform;
    transform: translateZ(0);
  }

  .insight-card:hover {
    transform: translateY(-8px) translateZ(0);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
  }

  /* Enhanced gradient backgrounds */
  .gradient-bg {
    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
  }

  .gradient-text {
    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  /* Enhanced button styling */
  .btn-gradient {
    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    transform: translateZ(0);
    border: none;
    outline: none;
  }

  .btn-gradient:hover {
    background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
    transform: translateY(-2px) translateZ(0);
    box-shadow: 0 10px 25px -5px rgba(99, 102, 241, 0.4);
  }

  .btn-gradient:focus {
    outline: 2px solid #6366f1 !important;
    outline-offset: 2px;
  }

  /* Enhanced glass effect */
  .glass-effect {
    background: rgba(255, 255, 255, 0.85);
    backdrop-filter: blur(16px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
  }

  /* Chart container styling */
  .chart-container {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(8px);
    border-radius: 16px;
    padding: 1.5rem;
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.5);
    position: relative;
    overflow: hidden;
  }

  .chart-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.8), transparent);
  }

  /* Enhanced mood distribution cards */
  .mood-card {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(8px);
    border-radius: 12px;
    padding: 1rem;
    text-align: center;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.3);
    transition: all 0.3s ease;
    cursor: pointer;
  }

  .mood-card:hover {
    transform: translateY(-2px) scale(1.02);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
  }

  /* Enhanced topic distribution styling */
  .topic-bar-container {
    background: rgba(255, 255, 255, 0.8);
    border-radius: 12px;
    padding: 1.5rem;
    backdrop-filter: blur(8px);
    border: 1px solid rgba(255, 255, 255, 0.3);
  }

  .topic-bar {
    background: rgba(229, 231, 235, 0.6);
    border-radius: 8px;
    overflow: hidden;
    height: 8px;
    position: relative;
  }

  .topic-bar-fill {
    height: 100%;
    border-radius: 8px;
    background: linear-gradient(90deg, #6366f1, #8b5cf6);
    transition: width 1s ease-out;
    position: relative;
  }

  .topic-bar-fill::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    animation: shimmer 2s infinite;
  }

  @keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }

  /* Enhanced patterns and suggestions cards */
  .pattern-card {
    background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.05) 100%);
    border: 1px solid rgba(16, 185, 129, 0.2);
    border-radius: 16px;
    padding: 1.5rem;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .pattern-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, #10b981, #059669);
  }

  .pattern-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 25px rgba(16, 185, 129, 0.15);
  }

  .suggestion-card {
    background: linear-gradient(135deg, rgba(168, 85, 247, 0.1) 0%, rgba(139, 92, 246, 0.05) 100%);
    border: 1px solid rgba(168, 85, 247, 0.2);
    border-radius: 16px;
    padding: 1.5rem;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .suggestion-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, #a855f7, #8b5cf6);
  }

  .suggestion-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 25px rgba(168, 85, 247, 0.15);
  }

  /* Empty state styling */
  .empty-state {
    text-align: center;
    padding: 3rem 1.5rem;
    background: rgba(255, 255, 255, 0.6);
    backdrop-filter: blur(8px);
    border-radius: 20px;
    border: 2px dashed rgba(156, 163, 175, 0.3);
    position: relative;
    overflow: hidden;
  }

  .empty-state::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
    animation: shine 3s infinite;
  }

  @keyframes shine {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }

  /* Loading state enhancements */
  .loading-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 2rem;
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(8px);
    border-radius: 16px;
    border: 1px solid rgba(255, 255, 255, 0.3);
  }

  .loading-spinner {
    width: 40px;
    height: 40px;
    border: 4px solid rgba(99, 102, 241, 0.2);
    border-top: 4px solid #6366f1;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 1rem;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  /* Mobile optimizations */
  @media (max-width: 640px) {
    .insight-card {
      margin-bottom: 1.5rem;
      border-radius: 16px;
    }

    .chart-container {
      padding: 1rem;
    }

    .mood-card {
      padding: 0.75rem;
    }

    .pattern-card,
    .suggestion-card {
      padding: 1.25rem;
    }
  }

  /* Enhanced focus states for accessibility */
  .insight-card:focus-within {
    outline: 2px solid #6366f1;
    outline-offset: 2px;
  }

  /* Custom scrollbar */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  ::-webkit-scrollbar-track {
    background: rgba(241, 245, 249, 0.5);
    border-radius: 4px;
  }

  ::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, #6366f1, #4f46e5);
    border-radius: 4px;
    transition: background 0.3s ease;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(135deg, #4f46e5, #4338ca);
  }

  /* Enhanced notification styling */
  .notification-badge {
    background: linear-gradient(135deg, #f59e0b, #d97706);
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
    box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.8; }
  }

  /* Enhanced header styling */
  .page-header {
    text-align: center;
    margin-bottom: 3rem;
    position: relative;
  }

  .page-header::after {
    content: '';
    position: absolute;
    bottom: -1rem;
    left: 50%;
    transform: translateX(-50%);
    width: 60px;
    height: 3px;
    background: linear-gradient(90deg, #6366f1, #8b5cf6);
    border-radius: 2px;
  }

  /* Enhanced metric display */
  .metric-value {
    font-size: 2rem;
    font-weight: 700;
    background: linear-gradient(135deg, #6366f1, #8b5cf6);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  /* Chart loading placeholder */
  .chart-loading {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 200px;
    background: linear-gradient(90deg, #f3f4f6 25%, #e5e7eb 50%, #f3f4f6 75%);
    background-size: 200% 100%;
    animation: loading 1.5s infinite;
    border-radius: 12px;
  }

  @keyframes loading {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
  }

  /* Enhanced tag styling */
  .insight-tag {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    background: rgba(99, 102, 241, 0.1);
    color: #4f46e5;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 500;
    margin: 0.125rem;
    border: 1px solid rgba(99, 102, 241, 0.2);
    transition: all 0.2s ease;
  }

  .insight-tag:hover {
    background: rgba(99, 102, 241, 0.2);
    transform: scale(1.05);
  }
</style>

<!-- Chart.js Library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
{% endblock %}

{% block content %}
<!-- Skip link for accessibility -->
<a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-0 focus:left-0 focus:z-50 focus:px-4 focus:py-2 focus:bg-white focus:text-secondary-600 focus:outline-offset-0">Skip to main content</a>

<div id="main-content" class="max-w-7xl mx-auto relative">
  <!-- Enhanced decorative elements -->
  <div class="absolute -top-10 -left-16 h-48 w-48 bg-secondary-300 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-blob"></div>
  <div class="absolute -bottom-32 -right-16 h-48 w-48 bg-primary-300 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-blob animation-delay-2000"></div>
  <div class="absolute top-1/3 left-1/3 h-32 w-32 bg-amber-300 rounded-full mix-blend-multiply filter blur-xl opacity-15 animate-blob animation-delay-4000"></div>

  <!-- Enhanced notifications -->
  {% if messages %}
    <div class="mb-8">
      {% for message in messages %}
        <div class="{% if message.tags == 'error' %}bg-red-50 border-red-200 text-red-800{% elif message.tags == 'success' %}bg-green-50 border-green-200 text-green-800{% else %}bg-blue-50 border-blue-200 text-blue-800{% endif %} px-6 py-4 rounded-2xl border mb-4 glass-effect animate-fade-in" role="alert">
          <div class="flex items-center">
            <div class="flex-shrink-0">
              {% if message.tags == 'error' %}
                <svg class="h-5 w-5 text-red-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                </svg>
              {% elif message.tags == 'success' %}
                <svg class="h-5 w-5 text-green-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                </svg>
              {% else %}
                <svg class="h-5 w-5 text-blue-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                </svg>
              {% endif %}
            </div>
            <div class="ml-3">
              {{ message }}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <!-- Enhanced Header Section -->
  <div class="page-header animate-fade-in">
    <div class="inline-block mb-4">
      <span class="px-4 py-2 bg-white/60 backdrop-blur-sm rounded-full text-sm font-medium text-gray-600 shadow-lg border border-white/50 animate-float">
        🧠 Your Journal Insights
      </span>
    </div>
    <h1 class="text-4xl sm:text-5xl font-bold text-gray-800 diary-font mb-4 animate-scale-in animation-delay-200">
      AI-Powered Insights
    </h1>
    <p class="text-gray-600 text-lg max-w-2xl mx-auto animate-fade-in animation-delay-400">
      Discover patterns, trends, and meaningful insights from your journaling journey
    </p>

    <!-- Enhanced regenerate button -->
    <div class="mt-8 animate-fade-in animation-delay-600">
      <form method="post" class="inline-block">
        {% csrf_token %}
        <input type="hidden" name="regenerate_insights" value="true">
        <button type="submit" class="btn-gradient text-white px-6 py-3 rounded-full hover:shadow-xl transition-all text-sm font-medium flex items-center gap-2 mx-auto">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
          </svg>
          <span>Regenerate Insights</span>
        </button>
      </form>
    </div>
  </div>

  <!-- Enhanced Mood Analysis Section -->
  {% if mood_analysis %}
  <div class="insight-card mb-8 animate-fade-in animation-delay-800">
    <div class="p-6 sm:p-8">
      <h2 class="text-2xl font-semibold gradient-text mb-6 flex items-center gap-3 diary-font">
        <div class="w-10 h-10 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full flex items-center justify-center shadow-lg">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        </div>
        <span>Mood Analysis</span>
        <span class="notification-badge">New Insights</span>
      </h2>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- AI Analysis Content -->
        <div class="lg:col-span-2">
          <div class="glass-effect rounded-2xl p-6 border border-white/30">
            <div class="text-gray-800 handwritten text-xl leading-relaxed">
              {{ mood_analysis.content|linebreaks }}
            </div>
          </div>
        </div>

        <!-- Mood Statistics -->
        <div class="space-y-6">
          <!-- Mood Trends Chart -->
          <div class="chart-container">
            <h3 class="font-semibold text-gray-800 mb-4 flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
              </svg>
              <span>Recent Mood Trends</span>
            </h3>
            <div class="h-48 relative">
              {% if mood_trends %}
                <canvas id="moodTrendChart"></canvas>
              {% else %}
                <div class="chart-loading">
                  <div class="text-center">
                    <div class="loading-spinner"></div>
                    <p class="text-gray-500 text-sm">Building your mood timeline...</p>
                  </div>
                </div>
              {% endif %}
            </div>
          </div>

          <!-- Mood Distribution -->
          <div class="chart-container">
            <h3 class="font-semibold text-gray-800 mb-4 flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z" />
              </svg>
              <span>Mood Distribution</span>
            </h3>
            <div class="grid grid-cols-2 gap-3">
              {% for mood in mood_distribution %}
                <div class="mood-card">
                  <div class="text-2xl mb-2">{{ mood.emoji }}</div>
                  <div class="font-semibold text-gray-800 text-sm">{{ mood.name }}</div>
                  <div class="metric-value text-lg">{{ mood.percentage }}%</div>
                </div>
              {% empty %}
                <div class="col-span-2 empty-state">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto text-gray-300 mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                  <p class="text-gray-500 text-sm">No mood data available yet</p>
                  <p class="text-gray-400 text-xs mt-1">Continue journaling to see your mood patterns</p>
                </div>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% endif %}

  <!-- Enhanced Topic Distribution Section -->
  <div class="insight-card mb-8 animate-fade-in animation-delay-1000">
    <div class="p-6 sm:p-8">
      <h2 class="text-2xl font-semibold gradient-text mb-6 flex items-center gap-3 diary-font">
        <div class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-full flex items-center justify-center shadow-lg">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" />
          </svg>
        </div>
        <span>Topic Distribution</span>
      </h2>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Topic Chart -->
        <div class="chart-container">
          <div class="h-80 relative">
            {% if tag_distribution %}
              <canvas id="topicChart"></canvas>
            {% else %}
              <div class="chart-loading">
                <div class="text-center">
                  <div class="loading-spinner"></div>
                  <p class="text-gray-500 text-sm">Analyzing your topics...</p>
                </div>
              </div>
            {% endif %}
          </div>
        </div>

        <!-- Topic Breakdown -->
        <div class="topic-bar-container">
          <h3 class="font-semibold text-gray-800 mb-6 flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
            </svg>
            <span>Top Topics</span>
          </h3>
          <div class="space-y-4">
            {% for tag in tag_distribution %}
              <div class="group">
                <div class="flex items-center justify-between mb-2">
                  <span class="font-medium text-gray-800">{{ tag.name }}</span>
                  <span class="text-sm text-gray-500 font-semibold">{{ tag.percentage }}%</span>
                </div>
                <div class="topic-bar">
                  <div class="topic-bar-fill" style="width: {{ tag.percentage }}%"></div>
                </div>
              </div>
            {% empty %}
              <div class="empty-state">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto text-gray-300 mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
                </svg>
                <p class="text-gray-500 text-sm">No topic data available yet</p>
                <p class="text-gray-400 text-xs mt-1">Add tags to your entries to see topic analysis</p>
              </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Enhanced Patterns & Suggestions Grid -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
    <!-- Enhanced Patterns Section -->
    <div class="insight-card animate-fade-in animation-delay-200">
      <div class="p-6 sm:p-8">
        <h2 class="text-2xl font-semibold gradient-text mb-6 flex items-center gap-3 diary-font">
          <div class="w-10 h-10 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-full flex items-center justify-center shadow-lg">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
            </svg>
          </div>
          <span>Patterns Detected</span>
        </h2>

        <div class="space-y-4">
          {% for pattern in patterns %}
            <div class="pattern-card">
              <h3 class="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                <span class="w-2 h-2 bg-emerald-500 rounded-full"></span>
                {{ pattern.title }}
              </h3>
              <p class="text-gray-700 handwritten text-lg leading-relaxed">{{ pattern.content }}</p>
            </div>
          {% empty %}
            <div class="empty-state">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto text-gray-300 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
              </svg>
              <h3 class="font-semibold text-gray-700 mb-2">No patterns detected yet</h3>
              <p class="text-gray-500 text-sm">Continue journaling to discover trends in your entries</p>
              <div class="mt-4">
                <span class="insight-tag">💭 Deep thoughts</span>
                <span class="insight-tag">🎯 Goal tracking</span>
                <span class="insight-tag">🌱 Personal growth</span>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- Enhanced Suggestions Section -->
    <div class="insight-card animate-fade-in animation-delay-400">
      <div class="p-6 sm:p-8">
        <h2 class="text-2xl font-semibold gradient-text mb-6 flex items-center gap-3 diary-font">
          <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full flex items-center justify-center shadow-lg">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
            </svg>
          </div>
          <span>Journal Suggestions</span>
        </h2>

        <div class="space-y-4">
          {% for suggestion in suggestions %}
            <div class="suggestion-card">
              <h3 class="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                <span class="w-2 h-2 bg-purple-500 rounded-full"></span>
                {{ suggestion.title }}
              </h3>
              <p class="text-gray-700 handwritten text-lg leading-relaxed">{{ suggestion.content }}</p>
            </div>
          {% empty %}
            <div class="empty-state">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto text-gray-300 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
              </svg>
              <h3 class="font-semibold text-gray-700 mb-2">No suggestions generated yet</h3>
              <p class="text-gray-500 text-sm">Continue journaling to receive personalized recommendations</p>
              <div class="mt-4">
                <span class="insight-tag">✨ Writing prompts</span>
                <span class="insight-tag">🎨 Creative exercises</span>
                <span class="insight-tag">🔄 Reflection topics</span>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>

  <!-- Enhanced Call to Action -->
  <div class="insight-card text-center animate-fade-in animation-delay-600">
    <div class="p-8 sm:p-12">
      <div class="max-w-2xl mx-auto">
        <div class="mb-6">
          <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4 shadow-xl animate-float">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
            </svg>
          </div>
          <h2 class="text-3xl font-bold text-gray-800 diary-font mb-4">Ready to add a new entry?</h2>
          <p class="text-gray-600 text-lg leading-relaxed">The more you journal, the richer your insights become. Each entry adds depth to your personal story.</p>
        </div>

        <div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
          <a href="{% url 'new_entry' %}" class="btn-gradient text-white px-8 py-4 rounded-full inline-flex items-center gap-3 shadow-xl hover:shadow-2xl transition-all text-lg font-medium">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
            </svg>
            <span>Write New Journal Entry</span>
          </a>

          <a href="{% url 'dashboard' %}" class="border-2 border-gray-300 hover:border-gray-400 text-gray-700 hover:text-gray-800 px-6 py-4 rounded-full inline-flex items-center gap-2 transition-all text-lg font-medium bg-white/80 backdrop-blur-sm">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
            </svg>
            <span>View Dashboard</span>
          </a>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Enhanced JavaScript with better performance and UX
document.addEventListener('DOMContentLoaded', function() {
  initializeAnimations();
  initializeCharts();
  setupEnhancedInteractions();
});

function initializeAnimations() {
  // Intersection Observer for progressive loading
  if ('IntersectionObserver' in window) {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.style.opacity = '1';
          entry.target.style.transform = 'translateY(0)';
          observer.unobserve(entry.target);
        }
      });
    }, {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    });

    document.querySelectorAll('.animate-fade-in, .animate-scale-in').forEach(el => {
      observer.observe(el);
    });
  } else {
    // Fallback for browsers without Intersection Observer
    document.querySelectorAll('.animate-fade-in, .animate-scale-in').forEach(el => {
      el.style.opacity = '1';
      el.style.transform = 'translateY(0)';
    });
  }
}

function setupEnhancedInteractions() {
  // Enhanced hover effects for cards
  document.querySelectorAll('.insight-card').forEach(card => {
    card.addEventListener('mouseenter', function() {
      this.style.transform = 'translateY(-8px) translateZ(0)';
    });

    card.addEventListener('mouseleave', function() {
      this.style.transform = 'translateY(0) translateZ(0)';
    });
  });

  // Enhanced mood card interactions
  document.querySelectorAll('.mood-card').forEach(card => {
    card.addEventListener('click', function() {
      // Add a subtle animation on click
      this.style.transform = 'scale(0.95)';
      setTimeout(() => {
        this.style.transform = 'scale(1)';
      }, 150);
    });
  });

  // Add ripple effect to buttons
  document.querySelectorAll('.btn-gradient').forEach(button => {
    button.addEventListener('click', function(e) {
      const ripple = document.createElement('span');
      const rect = this.getBoundingClientRect();
      const size = Math.max(rect.width, rect.height);
      const x = e.clientX - rect.left - size / 2;
      const y = e.clientY - rect.top - size / 2;

      ripple.style.width = ripple.style.height = size + 'px';
      ripple.style.left = x + 'px';
      ripple.style.top = y + 'px';
      ripple.classList.add('ripple');

      this.appendChild(ripple);

      setTimeout(() => {
        ripple.remove();
      }, 600);
    });
  });
}

// Enhanced chart initialization with better styling
function initializeCharts() {
  // Configure Chart.js defaults
  Chart.defaults.font.family = "'Poppins', sans-serif";
  Chart.defaults.color = '#374151';
  Chart.defaults.plugins.legend.labels.usePointStyle = true;
  Chart.defaults.plugins.legend.labels.padding = 20;

  initializeTopicChart();
  initializeMoodChart();
}

function getColorCode(colorClass) {
  const colorMap = {
    'indigo-600': '#4f46e5',
    'indigo-500': '#6366f1',
    'blue-500': '#3b82f6',
    'sky-500': '#0ea5e9',
    'cyan-500': '#06b6d4',
    'teal-500': '#14b8a6',
    'emerald-500': '#10b981',
    'green-500': '#22c55e',
    'lime-500': '#84cc16',
    'yellow-500': '#eab308',
    'amber-500': '#f59e0b',
    'orange-500': '#f97316',
    'red-500': '#ef4444',
    'rose-500': '#f43f5e',
    'fuchsia-500': '#d946ef',
    'purple-500': '#a855f7',
    'violet-500': '#8b5cf6',
    'secondary-500': '#6366f1',
    'primary-500': '#8b5cf6'
  };
  return colorMap[colorClass] || '#9ca3af';
}

function initializeTopicChart() {
  const topicChartElement = document.getElementById('topicChart');
  if (!topicChartElement) return;

  {% if tag_distribution %}
  try {
    const ctx = topicChartElement.getContext('2d');

    const labels = [
      {% for tag in tag_distribution %}
        '{{ tag.name }}',
      {% endfor %}
    ];

    const data = [
      {% for tag in tag_distribution %}
        {{ tag.percentage }},
      {% endfor %}
    ];

    const colors = [
      {% for tag in tag_distribution %}
        getColorCode('{{ tag.color }}'),
      {% endfor %}
    ];

    // Create gradient colors for better visual appeal
    const gradientColors = colors.map((color, index) => {
      const gradient = ctx.createLinearGradient(0, 0, 0, 400);
      gradient.addColorStop(0, color);
      gradient.addColorStop(1, color + '80'); // Add transparency
      return gradient;
    });

    new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: labels,
        datasets: [{
          data: data,
          backgroundColor: gradientColors,
          borderWidth: 3,
          borderColor: '#ffffff',
          hoverBorderWidth: 4,
          hoverOffset: 8
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        cutout: '65%',
        plugins: {
          legend: {
            position: 'bottom',
            labels: {
              boxWidth: 15,
              boxHeight: 15,
              padding: 20,
              font: {
                size: 13,
                weight: '500'
              }
            }
          },
          tooltip: {
            backgroundColor: 'rgba(255, 255, 255, 0.95)',
            titleColor: '#1f2937',
            bodyColor: '#374151',
            borderColor: '#e5e7eb',
            borderWidth: 1,
            cornerRadius: 12,
            padding: 16,
            displayColors: true,
            callbacks: {
              label: function(context) {
                return `${context.label}: ${context.parsed}%`;
              }
            }
          }
        },
        animation: {
          animateRotate: true,
          animateScale: true,
          duration: 1500,
          easing: 'easeOutQuart'
        }
      }
    });
  } catch (error) {
    console.error('Error initializing topic chart:', error);
    showChartError(topicChartElement, 'Unable to load topic chart');
  }
  {% else %}
  showChartPlaceholder(topicChartElement, 'No topic data available yet');
  {% endif %}
}

function initializeMoodChart() {
  const moodChartElement = document.getElementById('moodTrendChart');
  if (!moodChartElement) return;

  {% if mood_trends %}
  try {
    const ctx = moodChartElement.getContext('2d');

    // Create beautiful gradient
    const gradient = ctx.createLinearGradient(0, 0, 0, 400);
    gradient.addColorStop(0, 'rgba(99, 102, 241, 0.4)');
    gradient.addColorStop(0.5, 'rgba(139, 92, 246, 0.2)');
    gradient.addColorStop(1, 'rgba(139, 92, 246, 0)');

    const lineGradient = ctx.createLinearGradient(0, 0, 0, 400);
    lineGradient.addColorStop(0, '#6366f1');
    lineGradient.addColorStop(1, '#8b5cf6');

    const labels = [
      {% for item in mood_trends %}
        '{{ item.date }}',
      {% endfor %}
    ];

    const data = [
      {% for item in mood_trends %}
        {{ item.mood }},
      {% endfor %}
    ];

    new Chart(ctx, {
      type: 'line',
      data: {
        labels: labels,
        datasets: [{
          label: 'Mood Level',
          data: data,
          borderColor: lineGradient,
          backgroundColor: gradient,
          borderWidth: 4,
          tension: 0.4,
          fill: true,
          pointBackgroundColor: '#ffffff',
          pointBorderColor: '#6366f1',
          pointBorderWidth: 3,
          pointRadius: 6,
          pointHoverRadius: 8,
          pointHoverBorderWidth: 4,
          pointHoverBackgroundColor: '#6366f1',
          pointHoverBorderColor: '#ffffff'
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        interaction: {
          intersect: false,
          mode: 'index'
        },
        scales: {
          y: {
            min: 0,
            max: 10,
            ticks: {
              stepSize: 2,
              font: {
                size: 12,
                weight: '500'
              },
              color: '#6b7280',
              callback: function(value) {
                return value + '/10';
              }
            },
            grid: {
              color: 'rgba(0, 0, 0, 0.05)',
              lineWidth: 1
            },
            border: {
              display: false
            }
          },
          x: {
            ticks: {
              maxRotation: 45,
              font: {
                size: 11,
                weight: '500'
              },
              color: '#6b7280'
            },
            grid: {
              display: false
            },
            border: {
              display: false
            }
          }
        },
        plugins: {
          legend: {
            display: false
          },
          tooltip: {
            backgroundColor: 'rgba(255, 255, 255, 0.95)',
            titleColor: '#1f2937',
            bodyColor: '#374151',
            borderColor: '#e5e7eb',
            borderWidth: 1,
            cornerRadius: 12,
            padding: 16,
            displayColors: false,
            callbacks: {
              title: function(context) {
                return context[0].label;
              },
              label: function(context) {
                return `Mood: ${context.parsed.y}/10`;
              }
            }
          }
        },
        animation: {
          duration: 2000,
          easing: 'easeOutQuart'
        }
      }
    });
  } catch (error) {
    console.error('Error initializing mood chart:', error);
    showChartError(moodChartElement, 'Unable to load mood chart');
  }
  {% else %}
  showChartPlaceholder(moodChartElement, 'No mood data available yet');
  {% endif %}
}

function showChartError(element, message) {
  element.parentElement.innerHTML = `
    <div class="flex items-center justify-center h-48 text-gray-400">
      <div class="text-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.464 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z" />
        </svg>
        <p class="text-sm">${message}</p>
      </div>
    </div>
  `;
}

function showChartPlaceholder(element, message) {
  element.parentElement.innerHTML = `
    <div class="flex items-center justify-center h-48 text-gray-400">
      <div class="text-center">
        <div class="loading-spinner mb-3"></div>
        <p class="text-sm">${message}</p>
        <p class="text-xs mt-1 text-gray-300">Continue journaling to see your data</p>
      </div>
    </div>
  `;
}

// Add CSS for ripple effect
const style = document.createElement('style');
style.textContent = `
  .ripple {
    position: absolute;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.6);
    transform: scale(0);
    animation: ripple-animation 0.6s linear;
    pointer-events: none;
  }

  @keyframes ripple-animation {
    to {
      transform: scale(4);
      opacity: 0;
    }
  }
`;
document.head.appendChild(style);
</script>
{% endblock %}
