{% extends "base.html" %}

{% block title %}DiaryVault{% endblock %}

{% block extra_css %}
<style>
  /* CRITICAL: Remove all scrollbar conflicts and use base.html scrolling only */
  
  #journalInput {
    resize: none !important;
    width: 100% !important;
    max-width: 100% !important;
    border: none !important;
    outline: none !important;
    min-height: 150px;
    box-sizing: border-box !important;
    overflow-wrap: break-word;
    /* MOBILE: Prevent zoom on iOS */
    font-size: 16px !important;
  }

  #journalContainer {
    width: 100% !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
    transition: all 0.2s ease;
    border-color: rgba(99, 102, 241, 0.3);
    position: relative;
  }

  #journalContainer:focus-within {
    border-color: rgba(99, 102, 241, 0.8) !important;
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2) !important;
    background-color: white;
  }

  /* CRITICAL: Main content works with base.html scrolling ONLY */
  #main-content {
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
    padding-left: 1rem;
    padding-right: 1rem;
  }

  /* Core branding elements */
  .diary-font {
    font-family: 'Playfair Display', serif;
    letter-spacing: -0.01em;
    line-height: 1.5;
  }

  .handwritten {
    font-family: 'Satisfy', cursive;
    letter-spacing: 0.01em;
    line-height: 1.7;
  }

  /* Enhanced animations - OPTIMIZED with animation delays */
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes scaleIn {
    from { opacity: 0; transform: scale(0.98); }
    to { opacity: 1; transform: scale(1); }
  }

  @keyframes float {
    0% { transform: translateY(0px) translateZ(0); }
    50% { transform: translateY(-8px) translateZ(0); }
    100% { transform: translateY(0px) translateZ(0); }
  }

  .animate-fade-in {
    animation: fadeIn 0.6s ease forwards;
    will-change: transform, opacity;
  }

  .animate-scale-in {
    animation: scaleIn 0.4s ease forwards;
    will-change: transform, opacity;
  }

  .animate-float {
    animation: float 4s ease-in-out infinite;
    will-change: transform;
  }

  /* OPTIMIZED: Animation delay classes */
  .animation-delay-100 { animation-delay: 100ms; }
  .animation-delay-200 { animation-delay: 200ms; }
  .animation-delay-300 { animation-delay: 300ms; }
  .animation-delay-400 { animation-delay: 400ms; }
  .animation-delay-500 { animation-delay: 500ms; }
  .animation-delay-600 { animation-delay: 600ms; }

  /* Enhanced buttons and interactions */
  .btn-gradient {
    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    transform: translateZ(0);
  }

  .btn-gradient:hover {
    background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
    transform: translateY(-2px) translateZ(0);
    box-shadow: 0 8px 20px -5px rgba(99, 102, 241, 0.4);
  }

  .card-hover {
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    transform: translateZ(0);
  }

  .card-hover:hover {
    transform: translateY(-4px) translateZ(0);
    box-shadow: 0 15px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -5px rgba(0, 0, 0, 0.04);
  }

  /* Mobile-first badges and status indicators */
  .mobile-badge {
    font-size: 0.625rem;
    padding: 0.125rem 0.5rem;
    border-radius: 9999px;
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    font-weight: 600;
  }

  /* Enhanced gradients */
  .gradient-bg {
    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
  }

  /* Loading spinner improvements */
  @keyframes pulse-ring {
    0% {
      transform: scale(0.8);
      opacity: 0;
    }
    50% {
      opacity: 0.5;
    }
    100% {
      transform: scale(1.3);
      opacity: 0;
    }
  }

  /* Mobile-first wallet section */
  .wallet-prompt-mobile {
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.05), rgba(139, 92, 246, 0.05));
    border: 1px solid rgba(99, 102, 241, 0.2);
    border-radius: 0.75rem;
    padding: 0.875rem;
    margin-bottom: 1rem;
  }

  .wallet-connected-mobile {
    background: linear-gradient(135deg, rgba(34, 197, 94, 0.05), rgba(16, 185, 129, 0.05));
    border: 1px solid rgba(34, 197, 94, 0.2);
    border-radius: 0.75rem;
    padding: 0.75rem;
    margin-bottom: 1rem;
  }

  /* Mobile action buttons */
  .mobile-action-btn {
    min-height: 44px;
    min-width: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    border-radius: 9999px;
    font-weight: 500;
    transition: all 0.2s;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
  }

  /* ENHANCED MOBILE OPTIMIZATIONS */
  @media (max-width: 640px) {
    /* Reduce padding and margins throughout */
    #main-content {
      padding-left: 0.75rem;
      padding-right: 0.75rem;
    }

    /* Mobile-optimized hero section */
    .hero-mobile {
      margin-bottom: 1.5rem;
    }

    .hero-mobile h1 {
      font-size: 1.75rem;
      line-height: 1.2;
      margin-bottom: 0.75rem;
    }

    .hero-mobile p {
      font-size: 0.875rem;
      line-height: 1.5;
      margin-bottom: 0.5rem;
    }

    /* Compact wallet section */
    .wallet-prompt-mobile h3 {
      font-size: 0.875rem;
      margin-bottom: 0.5rem;
    }

    .wallet-prompt-mobile p {
      font-size: 0.75rem;
      margin-bottom: 0.75rem;
    }

    /* Mobile-optimized benefit pills */
    .benefit-pill {
      font-size: 0.625rem;
      padding: 0.25rem 0.5rem;
      white-space: nowrap;
    }

    /* Streamlined input container */
    #journalContainer {
      min-height: 120px;
      border-radius: 0.75rem;
      margin-bottom: 0.75rem;
    }

    #journalInput {
      padding: 0.875rem;
      font-size: 16px !important; /* Prevent zoom */
      line-height: 1.5;
    }

    /* Mobile-friendly suggestions */
    .suggestions-container {
      margin-top: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .suggestions-pill {
      font-size: 0.6875rem;
      padding: 0.375rem 0.75rem;
      min-height: 32px;
      margin-bottom: 0.375rem;
      margin-right: 0.375rem;
    }

    /* Compact personalization toggle */
    .personalization-section {
      border-top: 1px solid #e5e7eb;
      padding-top: 0.75rem;
      margin-top: 0.75rem;
    }

    /* Mobile action area */
    .mobile-action-area {
      background: linear-gradient(to right, rgba(99, 102, 241, 0.05), rgba(139, 92, 246, 0.05));
      padding: 0.875rem;
      border-top: 1px solid white;
      border-radius: 0 0 0.75rem 0.75rem;
    }

    /* Floating action button for mobile */
    .fab-mobile {
      position: fixed;
      bottom: 1.5rem;
      right: 1rem;
      width: 56px;
      height: 56px;
      border-radius: 28px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      z-index: 40;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Compact loading state */
    #loadingIndicator .loading-content {
      padding: 1.5rem;
      border-radius: 0.75rem;
    }

    #loadingIndicator .loading-spinner {
      width: 40px;
      height: 40px;
    }

    #loadingIndicator p {
      font-size: 0.875rem;
      margin-top: 0.75rem;
    }

    /* Mobile-optimized result preview */
    #resultPreview {
      margin-top: 1.5rem;
      border-radius: 0.75rem;
    }

    #resultPreview .result-header {
      padding: 0.875rem;
      border-bottom: 1px solid #f3f4f6;
    }

    #resultPreview .result-content {
      padding: 1rem;
      font-size: 0.9375rem;
      line-height: 1.6;
    }

    #resultPreview .result-actions {
      padding: 0.875rem;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    /* Touch-friendly spacing */
    button,
    .suggestions-pill,
    input[type="checkbox"] + label,
    .mobile-action-btn {
      min-height: 44px;
      min-width: 44px;
    }

    /* Remove decorative elements on mobile */
    .absolute.bg-secondary-300,
    .absolute.bg-primary-300,
    .absolute.bg-amber-300 {
      display: none;
    }

    /* Simplified animations on mobile */
    .animate-blob,
    .animate-float {
      animation: none;
    }

    /* Bottom sheet style for modals */
    .mobile-modal {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      border-radius: 1rem 1rem 0 0;
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
      padding: 1.5rem;
      z-index: 50;
      transform: translateY(100%);
      transition: transform 0.3s ease;
    }

    .mobile-modal.show {
      transform: translateY(0);
    }

    /* Swipe-to-dismiss indicator */
    .swipe-indicator {
      width: 40px;
      height: 4px;
      background: #d1d5db;
      border-radius: 2px;
      margin: 0 auto 1rem;
    }

    /* Mobile-specific form styling */
    .form-group {
      margin-bottom: 1rem;
    }

    /* Improved photo preview for mobile */
    #photoPreviewContainer {
      padding: 0.75rem;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(8px);
    }

    #photoPreview {
      width: 60px;
      height: 60px;
      border-radius: 0.5rem;
    }

    /* Mobile toast positioning */
    .feedback-toast {
      bottom: 5rem;
      right: 1rem;
      left: 1rem;
      max-width: none;
      border-radius: 0.75rem;
    }

    /* Compact character counter */
    .char-counter-mobile {
      font-size: 0.625rem;
      padding: 0.125rem 0.375rem;
      background: rgba(99, 102, 241, 0.1);
      border-radius: 9999px;
      color: #6366f1;
    }

    /* Mobile-friendly spacing utilities */
    .space-y-mobile-2 > * + * {
      margin-top: 0.5rem;
    }

    .space-y-mobile-3 > * + * {
      margin-top: 0.75rem;
    }

    .space-y-mobile-4 > * + * {
      margin-top: 1rem;
    }
  }

  /* Additional touch optimizations */
  @media (pointer: coarse) {
    /* Larger touch targets */
    .suggestions-pill,
    .mobile-action-btn {
      padding: 0.5rem 1rem;
    }

    /* Better hover states for touch */
    .btn-gradient:active {
      transform: scale(0.98);
    }

    .card-hover:active {
      transform: scale(0.99);
    }
  }

  /* Dark mode support for mobile */
  @media (prefers-color-scheme: dark) and (max-width: 640px) {
    .wallet-prompt-mobile,
    .wallet-connected-mobile {
      background: rgba(0, 0, 0, 0.2);
      border-color: rgba(255, 255, 255, 0.1);
    }
  }

  /* Performance optimizations */
  .will-change-transform {
    will-change: transform;
  }

  .backface-hidden {
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
  }

  /* Prevent text selection on buttons */
  .mobile-action-btn,
  .suggestions-pill {
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
  }
</style>
{% endblock %}

{% block content %}
<!-- Skip link for accessibility -->
<a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-0 focus:left-0 focus:z-50 focus:px-4 focus:py-2 focus:bg-white focus:text-secondary-600 focus:outline-offset-0">Skip to main content</a>

<!-- MOBILE-OPTIMIZED main container -->
<div id="main-content" class="max-w-4xl w-full mx-auto relative">
  <!-- Simplified decorative elements for mobile -->
  <div class="hidden sm:block absolute -top-10 -left-16 h-48 w-48 bg-secondary-300 rounded-full mix-blend-multiply filter blur-xl opacity-15 animate-blob"></div>
  <div class="hidden sm:block absolute -bottom-32 -right-16 h-48 w-48 bg-primary-300 rounded-full mix-blend-multiply filter blur-xl opacity-15 animate-blob animation-delay-2000"></div>

  <!-- MOBILE-FIRST hero section -->
  <div class="text-center mb-4 sm:mb-6 relative z-10 hero-mobile">
    <!-- Compact date badge -->
    <div class="inline-block mb-2 sm:mb-3">
      <span class="mobile-badge sm:px-4 sm:py-2 bg-white/80 backdrop-blur-sm text-primary-600 shadow-sm border border-primary-200/50">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
        </svg>
        {{ current_date|default:"Today" }}
      </span>
    </div>
    
    <!-- Mobile-optimized headline -->
    <h1 class="text-2xl sm:text-4xl lg:text-5xl font-bold text-gray-900 diary-font mb-3 sm:mb-4 animate-fade-in">
      <span class="block">Your thoughts.</span>
      <span class="block text-primary-600">Encrypted.</span>
      <span class="block text-gradient bg-gradient-to-r from-primary-600 to-purple-600 bg-clip-text text-transparent">Rewarded.</span>
    </h1>
    
    <!-- Condensed tagline -->
    <p class="text-sm sm:text-lg text-gray-600 max-w-2xl mx-auto mb-2 sm:mb-3 animate-fade-in animation-delay-300">
      Connect wallet. Write privately. Earn rewards.
    </p>
    
    <!-- Mobile benefit pills -->
    <div class="flex items-center justify-center gap-2 sm:gap-4 text-xs">
      <span class="benefit-pill flex items-center gap-1 bg-green-50 text-green-700 border border-green-200">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
        </svg>
        No emails
      </span>
      <span class="benefit-pill flex items-center gap-1 bg-blue-50 text-blue-700 border border-blue-200">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
        </svg>
        Private
      </span>
      <span class="benefit-pill flex items-center gap-1 bg-purple-50 text-purple-700 border border-purple-200">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
        </svg>
        Earn tokens
      </span>
    </div>
  </div>

  <!-- MOBILE-OPTIMIZED Wallet Connection Section -->
  <div id="walletStatusSection" class="mb-4 sm:mb-6 animate-fade-in">
    <!-- Not Connected State - Mobile optimized -->
    <div id="walletNotConnected" class="wallet-prompt-mobile sm:p-4">
      <h3 class="font-semibold text-gray-800 text-sm sm:text-base mb-1 sm:mb-2 flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 text-primary-500 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
        </svg>
        Connect Wallet to Start
      </h3>
      <p class="text-xs sm:text-sm text-gray-600 mb-2 sm:mb-3">Enable encryption & earn rewards for journaling.</p>
      
      <!-- Mobile-friendly action buttons -->
      <div class="flex flex-col sm:flex-row gap-2 w-full">
        <button onclick="connectWallet()" class="mobile-action-btn btn-gradient text-white flex-1 text-sm sm:text-base">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
          </svg>
          Connect
        </button>
        <button onclick="tryWithoutWallet()" class="mobile-action-btn bg-gray-100 text-gray-700 flex-1 text-sm">
          Try First
        </button>
      </div>
    </div>

    <!-- Connected State - Mobile optimized -->
    <div id="walletConnected" class="wallet-connected-mobile hidden">
      <div class="flex items-center justify-between gap-2">
        <div class="flex items-center gap-2 flex-1 min-w-0">
          <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse flex-shrink-0"></div>
          <span class="text-xs font-medium text-gray-700 truncate">
            <span id="connectedWalletAddress">0x1234...5678</span>
          </span>
          <span class="text-xs text-green-600" id="networkStatus">✓ Base</span>
        </div>
        <button onclick="disconnectWallet()" class="text-xs text-gray-500 hover:text-gray-700 px-2 py-1">
          Disconnect
        </button>
      </div>
    </div>
  </div>

  <!-- MOBILE-OPTIMIZED Main input form -->
  <form id="demoForm" class="w-full relative z-10 animate-scale-in" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="bg-white rounded-xl shadow-lg sm:shadow-xl border border-white transition-all hover:shadow-xl sm:hover:shadow-2xl card-hover">
      <div class="p-3 sm:p-6 space-y-mobile-3 sm:space-y-4">
        <!-- Mobile-friendly header -->
        <div class="flex items-center justify-between">
          <h3 class="font-semibold text-gray-800 text-sm sm:text-base flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 text-primary-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
            </svg>
            <span id="writeHeaderText">Write freely</span>
          </h3>
          <div class="char-counter-mobile sm:text-xs sm:px-3 sm:py-1">
            <span id="charCount">0</span> <span class="hidden sm:inline">chars</span>
          </div>
        </div>

        <!-- Optimized input container -->
        <div id="journalContainer" class="relative border border-gray-200 rounded-lg sm:rounded-xl focus-within:border-secondary-400 transition bg-gray-50/50 shadow-inner">
          <textarea
            id="journalInput"
            name="journal_content"
            class="input-area w-full p-3 sm:p-4 border-0 focus:ring-0 focus:outline-none diary-font bg-transparent resize-none"
            placeholder="What's on your mind today?"
            oninput="countChars()"
            data-dropzone="true"
            aria-label="Journal content"
            autocomplete="off"
            spellcheck="true"></textarea>

          <!-- Mobile-friendly photo button -->
          <div class="absolute bottom-2 right-2 sm:right-3">
            <input id="journalPhoto" name="journal_photo" type="file" accept="image/*" class="hidden" onchange="previewPhoto(event)">
            <label for="journalPhoto" class="cursor-pointer p-2 hover:bg-gray-100 rounded-full transition-colors flex items-center justify-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd" />
              </svg>
            </label>
          </div>

          <!-- Photo preview - mobile optimized -->
          <div id="photoPreviewContainer" class="hidden p-2 sm:p-3 border-t border-gray-200">
            <div class="flex items-center gap-2 sm:gap-3">
              <div class="relative">
                <img id="photoPreview" class="h-14 w-14 sm:h-20 sm:w-20 object-cover rounded-lg border-2 border-secondary-200 shadow-sm" src="" alt="Your photo">
                <button type="button" onclick="removePhoto()" class="absolute -top-1 -right-1 bg-white rounded-full p-0.5 shadow-md border border-gray-200">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 text-gray-600" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                  </svg>
                </button>
              </div>
              <div class="text-xs sm:text-sm text-gray-600">
                <div class="font-medium">Photo added</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Mobile privacy notice -->
        <div class="text-xs text-gray-500 flex items-start gap-1">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mt-0.5 text-green-500 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
          </svg>
          <span id="privacyMessage">Connect wallet for encryption & rewards</span>
        </div>

        <!-- Mobile-optimized suggestions -->
        <div class="suggestions-container">
          <div class="text-xs font-medium text-gray-600 mb-2 flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1 text-primary-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
            </svg>
            Quick starts:
          </div>
          <div class="flex flex-wrap gap-1">
            <button type="button" onclick="addSuggestion('Today I\'m feeling')" class="suggestions-pill bg-primary-50 hover:bg-primary-100 text-primary-700 transition shadow-sm border border-primary-200/50">Today I'm feeling</button>
            <button type="button" onclick="addSuggestion('I accomplished')" class="suggestions-pill bg-emerald-50 hover:bg-emerald-100 text-emerald-700 transition shadow-sm border border-emerald-200/50">I accomplished</button>
            <button type="button" onclick="addSuggestion('Grateful for')" class="suggestions-pill bg-amber-50 hover:bg-amber-100 text-amber-700 transition shadow-sm border border-amber-200/50">Grateful for</button>
          </div>
        </div>

        <!-- Simplified personalization toggle for mobile -->
        <div class="personalization-section">
          <label class="flex items-center gap-2">
            <input type="checkbox" id="personalizationToggle" class="h-4 w-4 text-secondary-600 focus:ring-secondary-400 border-gray-300 rounded">
            <span class="text-sm font-medium text-gray-700">Use AI insights</span>
          </label>
        </div>
      </div>

      <!-- Mobile-optimized action area -->
      <div class="mobile-action-area sm:px-6 sm:py-5">
        <button type="button" id="demoButton" onclick="generateDemo()" class="mobile-action-btn btn-gradient text-white w-full">
          <span>Transform into Journal</span>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
          </svg>
        </button>
      </div>
    </div>
  </form>

  <!-- Mobile-optimized loading indicator -->
  <div id="loadingIndicator" class="mt-4 sm:mt-12 hidden animate-fade-in">
    <div class="loading-content flex flex-col items-center justify-center bg-white/90 backdrop-blur-sm shadow-lg border border-white">
      <div class="relative">
        <div class="loading-spinner border-4 border-secondary-200 border-t-secondary-600 rounded-full animate-spin mb-3"></div>
      </div>
      <p class="text-center text-gray-600 handwritten">Crafting your journal<span class="loading-dots"></span></p>
    </div>
  </div>

  <!-- Mobile-optimized results preview -->
  <div id="resultPreview" class="bg-white shadow-lg sm:shadow-xl border border-white card-hover hidden animate-scale-in">
    <div class="result-header flex items-center justify-between">
      <div>
        <h3 class="font-bold text-gray-800 text-sm sm:text-lg diary-font">Your Journal Entry</h3>
        <p class="text-gray-600 text-xs sm:text-sm">Generated from your thoughts</p>
      </div>
      <button onclick="editJournalEntry()" class="p-2 rounded-full hover:bg-gray-100 transition">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
        </svg>
      </button>
    </div>

    <div class="result-content bg-gradient-to-br from-white to-gray-50">
      <div id="journalPhotoDisplay" class="hidden mb-3 sm:mb-4">
        <img id="journalPhotoImage" class="w-full object-cover max-h-60 sm:max-h-80 rounded-lg" src="" alt="Journal photo">
      </div>
      <div id="journalEntry" class="handwritten text-gray-800 leading-relaxed"></div>
    </div>

    <div class="result-actions bg-gradient-to-r from-secondary-50 to-primary-50 flex flex-col sm:flex-row gap-2">
      <button type="button" onclick="editJournalEntry()" class="mobile-action-btn border border-gray-300 bg-white text-gray-700 hover:bg-gray-100 flex-1">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
        </svg>
        Edit
      </button>
      
      <div id="walletConnectedActions" class="hidden flex-1">
        <button type="button" onclick="saveToBlockchain()" class="mobile-action-btn btn-gradient text-white w-full">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
          </svg>
          Save & Earn
        </button>
      </div>
      
      <div id="walletNotConnectedActions" class="flex-1">
        <button type="button" onclick="connectWallet()" class="mobile-action-btn bg-amber-500 hover:bg-amber-600 text-white w-full">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
          </svg>
          Connect to Save
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Mobile-specific bottom sheet modal structure (hidden by default) -->
<div id="mobileWalletModal" class="mobile-modal hidden">
  <div class="swipe-indicator"></div>
  <h3 class="text-lg font-semibold mb-3">What's a Crypto Wallet?</h3>
  <p class="text-sm text-gray-600 mb-4">A crypto wallet is like a digital keychain that lets you:</p>
  <ul class="space-y-2 text-sm text-gray-600 mb-4">
    <li class="flex items-start gap-2">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-green-500 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
      </svg>
      <span>Sign in without emails or passwords</span>
    </li>
    <li class="flex items-start gap-2">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-green-500 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
      </svg>
      <span>Keep your journal entries fully encrypted</span>
    </li>
    <li class="flex items-start gap-2">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-green-500 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
      </svg>
      <span>Earn tokens as rewards for writing</span>
    </li>
  </ul>
  <div class="flex gap-2">
    <button onclick="closeMobileModal()" class="mobile-action-btn bg-gray-100 text-gray-700 flex-1">
      Maybe later
    </button>
    <button onclick="getWalletFromModal()" class="mobile-action-btn btn-gradient text-white flex-1">
      Get a wallet
    </button>
  </div>
</div>

<!-- Enhanced JavaScript with mobile optimizations -->
<script>
// All existing JavaScript remains the same, with these additions:

// Mobile-specific functions
function tryWithoutWallet() {
  // Hide wallet prompt temporarily
  const walletSection = document.getElementById('walletStatusSection');
  if (walletSection) {
    walletSection.style.display = 'none';
  }
  
  // Focus on input
  const journalInput = document.getElementById('journalInput');
  if (journalInput) {
    journalInput.focus();
  }
  
  // Show toast
  if (window.showToast) {
    window.showToast('You can try it out! Connect wallet anytime for rewards.', 'info');
  }
}

function showWalletOptions() {
  const modal = document.getElementById('mobileWalletModal');
  if (modal) {
    modal.classList.remove('hidden');
    setTimeout(() => {
      modal.classList.add('show');
    }, 10);
  }
}

function closeMobileModal() {
  const modal = document.getElementById('mobileWalletModal');
  if (modal) {
    modal.classList.remove('show');
    setTimeout(() => {
      modal.classList.add('hidden');
    }, 300);
  }
}

function getWalletFromModal() {
  // Redirect to wallet setup guide or open wallet provider
  window.open('https://metamask.io/download/', '_blank');
  closeMobileModal();
}

// Enhanced mobile touch handling
function setupMobileInteractions() {
  // Swipe to dismiss modal
  const modal = document.getElementById('mobileWalletModal');
  if (modal) {
    let startY = 0;
    let currentY = 0;
    let isDragging = false;

    modal.addEventListener('touchstart', (e) => {
      startY = e.touches[0].clientY;
      isDragging = true;
    });

    modal.addEventListener('touchmove', (e) => {
      if (!isDragging) return;
      currentY = e.touches[0].clientY;
      const diff = currentY - startY;
      if (diff > 0) {
        modal.style.transform = `translateY(${diff}px)`;
      }
    });

    modal.addEventListener('touchend', () => {
      isDragging = false;
      const diff = currentY - startY;
      if (diff > 100) {
        closeMobileModal();
      } else {
        modal.style.transform = '';
      }
    });
  }

  // Prevent pull-to-refresh on input
  const journalInput = document.getElementById('journalInput');
  if (journalInput) {
    let startY = 0;

    journalInput.addEventListener('touchstart', (e) => {
      startY = e.touches[0].clientY;
    });

    journalInput.addEventListener('touchmove', (e) => {
      const y = e.touches[0].clientY;
      const diff = y - startY;
      
      if (journalInput.scrollTop === 0 && diff > 0) {
        e.preventDefault();
      }
    }, { passive: false });
  }
}

// Initialize mobile-specific features
document.addEventListener('DOMContentLoaded', function() {
  // Existing initialization code...
  journalCache.init();
  initializeJournalForm();
  initializeAnimations();
  setupOptimizedScrollHandling();
  setupEnhancedUX();
  initializeWalletAwareHome();
  
  // Add mobile-specific initializations
  setupMobileInteractions();
  
  // Detect if mobile and adjust accordingly
  if (window.innerWidth <= 640) {
    document.body.classList.add('is-mobile');
  }
  
  // Handle orientation changes
  window.addEventListener('orientationchange', function() {
    setTimeout(() => {
      window.scrollTo(0, 0);
    }, 100);
  });
});

// Improved mobile keyboard handling
let viewportHeight = window.innerHeight;

window.addEventListener('resize', () => {
  const currentHeight = window.innerHeight;
  const keyboardVisible = currentHeight < viewportHeight * 0.75;
  
  if (keyboardVisible) {
    document.body.classList.add('keyboard-visible');
  } else {
    document.body.classList.remove('keyboard-visible');
  }
});

// All other existing JavaScript functions remain the same...
</script>

{% endblock %}