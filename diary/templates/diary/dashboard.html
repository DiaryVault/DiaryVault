{% extends "base.html" %}

{% block title %}DiaryVault - Dashboard{% endblock %}

{% block extra_css %}
<style>
  /* Base mobile-first styles */
  .container {
    padding: 1rem;
    max-width: 100%;
  }

  /* Book styling - simplified for mobile */
  .book {
    transition: transform 0.2s ease;
    position: relative;
  }

  .book-spine {
    position: absolute;
    top: 0;
    bottom: 0;
    left: 0;
    width: 20px;
    background: linear-gradient(to right, rgba(0,0,0,0.15), rgba(0,0,0,0));
    border-radius: 0.5rem 0 0 0.5rem;
  }

  /* Enhanced photo memory styles */
  .memory-card {
    background-color: white;
    border-radius: 1rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    overflow: hidden;
    transition: all 0.3s ease;
    position: relative;
    transform: translateY(0);
    cursor: pointer;
  }

  .memory-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
  }

  .memory-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
  }

  .memory-card:hover .memory-image {
    transform: scale(1.05);
  }

  .memory-content {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 1rem;
    background: linear-gradient(to top, rgba(0,0,0,0.7) 0%, transparent 100%);
    color: white;
  }

  .memory-title {
    font-size: 0.875rem;
    font-weight: 600;
    margin-bottom: 0.25rem;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
  }

  .memory-date {
    font-size: 0.75rem;
    opacity: 0.9;
  }

  /* Mobile-first responsive text */
  .text-mobile-lg { font-size: 1.125rem; line-height: 1.75rem; }
  .text-mobile-xl { font-size: 1.25rem; line-height: 1.75rem; }
  .text-mobile-2xl { font-size: 1.5rem; line-height: 2rem; }
  .text-mobile-3xl { font-size: 1.875rem; line-height: 2.25rem; }

  /* Mobile spacing */
  .space-mobile-y-3 > * + * { margin-top: 0.75rem; }
  .space-mobile-y-4 > * + * { margin-top: 1rem; }
  .space-mobile-y-6 > * + * { margin-top: 1.5rem; }

  /* Mobile padding */
  .p-mobile-3 { padding: 0.75rem; }
  .p-mobile-4 { padding: 1rem; }
  .p-mobile-5 { padding: 1.25rem; }

  /* Mobile margins */
  .mb-mobile-4 { margin-bottom: 1rem; }
  .mb-mobile-6 { margin-bottom: 1.5rem; }
  .mb-mobile-8 { margin-bottom: 2rem; }

  /* Touch targets */
  .touch-target {
    min-height: 44px;
    min-width: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
  }

  /* Mobile button styles */
  .btn-mobile {
    padding: 0.875rem 1.5rem;
    border-radius: 0.75rem;
    font-size: 1rem;
    font-weight: 600;
    text-align: center;
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    transition: all 0.2s ease;
  }

  .btn-mobile-sm {
    padding: 0.625rem 1rem;
    font-size: 0.875rem;
  }

  /* Mobile card styles */
  .card-mobile {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 1rem;
    padding: 1rem;
    margin-bottom: 1rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
  }

  .card-mobile-lg {
    padding: 1.25rem;
    border-radius: 1.25rem;
  }

  /* Mobile form styles */
  .form-mobile {
    width: 100%;
  }

  .input-mobile {
    width: 100%;
    padding: 1rem;
    border: 1px solid #e5e7eb;
    border-radius: 0.75rem;
    font-size: 1rem; /* Prevents zoom on iOS */
    background: #fafafa;
    transition: all 0.2s ease;
  }

  .input-mobile:focus {
    outline: none;
    border-color: #6366f1;
    background: white;
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
  }

  .textarea-mobile {
    min-height: 120px;
    resize: vertical;
    font-family: inherit;
    line-height: 1.6;
  }

  /* Mobile grid systems */
  .grid-mobile-1 { display: grid; grid-template-columns: 1fr; gap: 1rem; }
  .grid-mobile-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem; }
  .grid-mobile-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem; }

  /* Photo memory grid for mobile */
  .photo-memories-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.75rem;
  }

  .photo-memory-large {
    grid-column: span 2;
    height: 200px;
  }

  .photo-memory-small {
    height: 120px;
  }

  /* Mobile flexbox utilities */
  .flex-mobile-col { display: flex; flex-direction: column; }
  .flex-mobile-row { display: flex; flex-direction: row; align-items: center; }
  .flex-mobile-between { display: flex; justify-content: space-between; align-items: center; }
  .flex-mobile-center { display: flex; justify-content: center; align-items: center; }
  .flex-mobile-wrap { flex-wrap: wrap; gap: 0.5rem; }

  /* Mobile-specific animations */
  .loading-dots::after {
    content: '';
    animation: loading-dots 1.5s infinite;
  }

  @keyframes loading-dots {
    0%, 20% { content: ''; }
    40% { content: '.'; }
    60% { content: '..'; }
    80%, 100% { content: '...'; }
  }

  .scale-in {
    animation: scaleIn 0.3s ease-out;
  }

  @keyframes scaleIn {
    from { opacity: 0; transform: scale(0.95); }
    to { opacity: 1; transform: scale(1); }
  }

  /* Mobile active states */
  .active-mobile:active {
    transform: scale(0.98);
    background-color: rgba(0, 0, 0, 0.05);
  }

  /* Tablet and up styles */
  @media (min-width: 768px) {
    .container {
      padding: 1.5rem;
      max-width: 768px;
      margin: 0 auto;
    }

    .text-mobile-lg { font-size: 1.25rem; }
    .text-mobile-xl { font-size: 1.5rem; }
    .text-mobile-2xl { font-size: 1.875rem; }
    .text-mobile-3xl { font-size: 2.25rem; }

    .grid-mobile-2 { grid-template-columns: repeat(3, 1fr); gap: 1rem; }
    .grid-mobile-3 { grid-template-columns: repeat(4, 1fr); gap: 1rem; }

    .btn-mobile {
      width: auto;
      padding: 0.75rem 1.5rem;
    }

    .card-mobile {
      padding: 1.5rem;
    }

    .flex-mobile-col {
      flex-direction: row;
      align-items: center;
      gap: 1rem;
    }

    .book:hover {
      transform: rotateY(-10deg) translateY(-5px);
    }

    /* Tablet photo memories grid */
    .photo-memories-grid {
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
    }

    .photo-memory-large {
      grid-column: span 2;
      grid-row: span 2;
      height: 250px;
    }

    .photo-memory-small {
      height: 120px;
    }
  }

  /* Desktop styles */
  @media (min-width: 1024px) {
    .container {
      max-width: 1200px;
      padding: 2rem;
    }

    .grid-mobile-2 { grid-template-columns: repeat(4, 1fr); }
    .grid-mobile-3 { grid-template-columns: repeat(5, 1fr); }

    .book:hover {
      transform: rotateY(-15deg) translateY(-10px);
      z-index: 10;
    }

    /* Desktop photo memories grid */
    .photo-memories-grid {
      grid-template-columns: repeat(4, 1fr);
      gap: 1.5rem;
    }

    .photo-memory-large {
      grid-column: span 2;
      grid-row: span 2;
      height: 300px;
    }

    .photo-memory-small {
      height: 140px;
    }

    /* Desktop layout improvements */
    .dashboard-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 2rem;
    }

    .main-content {
      grid-column: 1;
    }

    .sidebar-content {
      grid-column: 2;
    }
  }

  /* Hide/show utilities */
  .mobile-only { display: block; }
  .desktop-only { display: none; }

  @media (min-width: 768px) {
    .mobile-only { display: none; }
    .desktop-only { display: block; }
  }

  /* Specific component styles */
  .quick-action {
    background: rgba(255, 255, 255, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.2);
    padding: 1rem;
    border-radius: 1rem;
    text-decoration: none;
    color: inherit;
    transition: all 0.2s ease;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    min-height: 100px;
  }

  .quick-action:active {
    transform: scale(0.98);
    background: rgba(255, 255, 255, 1);
  }

  .suggestion-btn {
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    padding: 0.75rem 1rem;
    border-radius: 2rem;
    font-size: 0.875rem;
    font-weight: 500;
    color: #475569;
    cursor: pointer;
    transition: all 0.2s ease;
    white-space: nowrap;
    flex-shrink: 0;
  }

  .suggestion-btn:active {
    background: #e2e8f0;
    transform: scale(0.98);
  }

  .entry-item {
    background: white;
    border-radius: 0.75rem;
    padding: 1rem;
    margin-bottom: 0.5rem;
    border: 1px solid #f3f4f6;
    transition: all 0.2s ease;
  }

  .entry-item:active {
    background: #f9fafb;
    transform: scale(0.99);
  }

  .book-item {
    background: linear-gradient(135deg, #6366f1, #8b5cf6);
    border-radius: 1rem;
    padding: 1rem;
    color: white;
    text-decoration: none;
    height: 160px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    position: relative;
    overflow: hidden;
  }

  .book-content {
    background: rgba(255, 255, 255, 0.95);
    color: #374151;
    border-radius: 0.75rem;
    padding: 0.75rem;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }

  .add-book {
    background: #f3f4f6;
    border: 2px dashed #d1d5db;
    border-radius: 1rem;
    height: 160px;
    display: flex;
    align-items: center;
    justify-content: center;
    text-decoration: none;
    color: #6b7280;
    transition: all 0.2s ease;
  }

  .add-book:active {
    background: #e5e7eb;
    transform: scale(0.98);
  }

  /* Loading spinner */
  .spinner {
    width: 40px;
    height: 40px;
    border: 4px solid #f3f4f6;
    border-top: 4px solid #6366f1;
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  /* Progress bar */
  .progress-bar {
    width: 100%;
    height: 8px;
    background: rgba(255, 255, 255, 0.5);
    border-radius: 4px;
    overflow: hidden;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #6366f1, #8b5cf6);
    border-radius: 4px;
    transition: width 0.5s ease;
  }

  /* Enhanced photo styles */
  .gradient-bg-1 { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
  .gradient-bg-2 { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
  .gradient-bg-3 { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
  .gradient-bg-4 { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
  .gradient-bg-5 { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
  .gradient-bg-6 { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }

  /* Photo overlay improvements */
  .photo-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.3);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .memory-card:hover .photo-overlay {
    opacity: 1;
  }

  .overlay-icon {
    color: white;
    background: rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(10px);
    border-radius: 50%;
    padding: 0.75rem;
    border: 1px solid rgba(255, 255, 255, 0.3);
  }
</style>
{% endblock %}

{% block content %}
<div class="container">
  <!-- Success Message -->
  <div id="entrySuccess" class="mb-mobile-4 hidden">
    <div class="card-mobile" style="background: #f0fdf4; border: 1px solid #bbf7d0; color: #15803d;">
      <div class="flex-mobile-between">
        <div class="flex-mobile-row" style="gap: 0.75rem;">
          <svg class="w-5 h-5 text-green-500 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
          </svg>
          <div>
            <div class="font-semibold text-mobile-lg">Entry Saved!</div>
            <div class="text-sm opacity-75">Your journal entry has been added to your collection.</div>
          </div>
        </div>
        <button class="touch-target" onclick="document.getElementById('entrySuccess').classList.add('hidden')">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Desktop grid layout -->
  <div class="dashboard-grid">
    <div class="main-content">
      <!-- Welcome & Stats Section -->
      <div class="card-mobile-lg mb-mobile-6">
        <div class="space-mobile-y-4">
          <div class="text-center lg:text-left">
            <h1 class="text-mobile-3xl font-bold mb-2" style="background: linear-gradient(135deg, #6366f1, #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Welcome back, {{ request.user.username }}</h1>
            <p class="text-gray-600">Continue your journey or explore past memories</p>
          </div>

          <div class="grid-mobile-3">
            <div class="text-center bg-white p-mobile-3 rounded-xl border border-gray-100">
              <div class="text-mobile-2xl font-bold text-blue-600">{{ total_entries }}</div>
              <div class="text-sm text-gray-500">Entries</div>
            </div>
            <div class="text-center bg-white p-mobile-3 rounded-xl border border-gray-100">
              <div class="text-mobile-2xl font-bold text-green-600">{{ streak }}</div>
              <div class="text-sm text-gray-500">Streak</div>
            </div>
            <div class="text-center bg-white p-mobile-3 rounded-xl border border-gray-100">
              <div class="text-mobile-2xl font-bold text-purple-600">{{ completion_percentage }}%</div>
              <div class="text-sm text-gray-500">Biography</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="grid-mobile-3 mb-mobile-6">
        <a href="{% url 'new_entry' %}" class="quick-action active-mobile">
          <div class="w-12 h-12 bg-blue-100 rounded-xl flex-mobile-center mb-2">
            <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
            </svg>
          </div>
          <div class="text-sm font-semibold text-gray-800">New Entry</div>
          <div class="text-xs text-gray-500">Record today</div>
        </a>

        <a href="{% url 'biography' %}" class="quick-action active-mobile">
          <div class="w-12 h-12 bg-purple-100 rounded-xl flex-mobile-center mb-2">
            <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
          </div>
          <div class="text-sm font-semibold text-gray-800">Biography</div>
          <div class="text-xs text-gray-500">Life story</div>
        </a>

        <a href="{% url 'insights' %}" class="quick-action active-mobile">
          <div class="w-12 h-12 bg-green-100 rounded-xl flex-mobile-center mb-2">
            <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
            </svg>
          </div>
          <div class="text-sm font-semibold text-gray-800">Insights</div>
          <div class="text-xs text-gray-500">Analytics</div>
        </a>
      </div>

      <!-- Photo Memories Section -->
      <div class="card-mobile mb-mobile-6">
        <div class="flex-mobile-between mb-4">
          <h2 class="text-mobile-xl font-bold text-gray-800">Recent Memories</h2>
          <a href="{% url 'library' %}" class="text-sm text-blue-600 hover:underline flex items-center gap-1">
            <span>View all</span>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </a>
        </div>

        {% if recent_entries %}
        <div class="photo-memories-grid">
          {% for entry in recent_entries|slice:":6" %}
          <a href="{% url 'entry_detail' entry.id %}" class="memory-card {% cycle 'photo-memory-large' 'photo-memory-small' 'photo-memory-small' 'photo-memory-small' 'photo-memory-small' 'photo-memory-large' %}">
            {% if entry.photos.first %}
              <img src="{{ entry.photos.first.photo.url }}" alt="Entry photo" class="memory-image" />
            {% elif entry.photo.url|default:'' %}
              <img src="{{ entry.photo.url }}" alt="Entry photo" class="memory-image" />
            {% else %}
              <div class="memory-image gradient-bg-{{ forloop.counter|add:1 }} flex items-center justify-center">
                <div class="text-white text-center p-4">
                  <div class="text-2xl mb-2">üìù</div>
                  <div class="font-medium text-sm opacity-90">{{ entry.title|default:"Untitled" }}</div>
                </div>
              </div>
            {% endif %}
            <div class="photo-overlay">
              <div class="overlay-icon">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
              </div>
            </div>
            <div class="memory-content">
              <div class="memory-title">{{ entry.title|default:"Untitled Memory" }}</div>
              <div class="memory-date">{{ entry.created_at|date:"M j" }}</div>
            </div>
          </a>
          {% endfor %}
        </div>
        {% else %}
        <div class="text-center py-8">
          <div class="w-16 h-16 bg-gray-100 rounded-2xl flex-mobile-center mx-auto mb-4">
            <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
          </div>
          <h3 class="text-mobile-lg font-semibold text-gray-800 mb-2">No memories yet</h3>
          <p class="text-gray-600 mb-4">Start journaling to see your memories here.</p>
          <a href="{% url 'new_entry' %}" class="btn-mobile" style="background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white;">Create Your First Memory</a>
        </div>
        {% endif %}
      </div>

      <!-- Journal Entry Form -->
      <div class="card-mobile mb-mobile-8">
        <div class="mb-4 pb-4 border-b border-gray-100">
          <h2 class="text-mobile-xl font-bold text-gray-800 flex items-center gap-2 mb-1">
            <svg class="w-5 h-5 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 100-2 1 1 0 000 2zm7-1a1 1 0 11-2 0 1 1 0 012 0zm-.464 5.535a1 1 0 10-1.415-1.414 3 3 0 01-4.242 0 1 1 0 00-1.415 1.414 5 5 0 007.072 0z" clip-rule="evenodd" />
            </svg>
            Quick Journal Entry
          </h2>
          <p class="text-sm text-gray-600">Share your thoughts directly from your dashboard</p>
        </div>

        <form id="dashboardJournalForm" class="form-mobile">
          {% csrf_token %}

          <!-- Character counter -->
          <div class="flex-mobile-between mb-3">
            <div class="text-sm bg-gray-100 px-3 py-1 rounded-full text-gray-600">
              <span id="charCount">0</span> characters
            </div>
          </div>

          <!-- Text area -->
          <textarea
            id="journalInput"
            name="journal_content"
            class="input-mobile textarea-mobile mb-4"
            placeholder="I had breakfast at 8am, went for a run, had a meeting with my team at 11am..."
            oninput="countChars()"></textarea>

          <!-- Suggestions -->
          <div class="mb-4">
            <div class="text-sm font-medium text-gray-700 mb-3">Suggested topics:</div>
            <div class="flex flex-wrap gap-2">
              <button type="button" onclick="addSuggestion('Today I accomplished')" class="suggestion-btn">Today I accomplished</button>
              <button type="button" onclick="addSuggestion('I felt happy when')" class="suggestion-btn">I felt happy when</button>
              <button type="button" onclick="addSuggestion('I learned that')" class="suggestion-btn">I learned that</button>
              <button type="button" onclick="addSuggestion('I met with')" class="suggestion-btn">I met with</button>
              <button type="button" onclick="addSuggestion('I\\'m grateful for')" class="suggestion-btn">I'm grateful for</button>
            </div>
          </div>

          <!-- Personalization -->
          <div class="mb-4 p-3 bg-gray-50 rounded-lg">
            <label class="flex items-start gap-3">
              <input type="checkbox" id="personalizationToggle" class="mt-1 w-4 h-4 text-blue-600 border-gray-300 rounded">
              <div class="text-sm">
                <div class="font-medium text-gray-700">Use personalized style</div>
                <div class="text-gray-500">Based on your preferences</div>
                <a href="{% url 'preferences' %}" class="text-blue-600 hover:underline">Edit preferences</a>
              </div>
            </label>
          </div>

          <!-- Action buttons -->
          <div class="space-mobile-y-3">
            <div class="flex-mobile-row text-sm text-gray-600 justify-center gap-2">
              <div class="w-6 h-6 bg-blue-100 rounded-full flex-mobile-center">
                <svg class="w-4 h-4 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd" />
                </svg>
              </div>
              <span>AI-powered journal generation</span>
            </div>
            <button type="button" id="generateButton" onclick="generateEntry()" class="btn-mobile" style="background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white;">
              <span>Generate Entry</span>
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
              </svg>
            </button>
          </div>
        </form>

        <!-- Loading indicator -->
        <div id="loadingIndicator" class="p-6 text-center hidden">
          <div class="spinner mx-auto mb-4"></div>
          <p class="text-gray-600 text-mobile-lg font-medium">Crafting your journal entry<span class="loading-dots"></span></p>
          <p class="text-sm text-gray-500 mt-2">This takes just a moment</p>
        </div>

        <!-- Results preview -->
        <div id="resultPreview" class="hidden scale-in">
          <div class="border-t border-gray-100 pt-4 mt-4">
            <div class="flex-mobile-between mb-4">
              <div>
                <h3 class="text-mobile-lg font-bold text-gray-800">Your Journal Entry</h3>
                <p class="text-sm text-gray-600">Generated based on your day</p>
              </div>
              <button class="touch-target bg-gray-100 rounded-full" onclick="editJournalEntry()">
                <svg class="w-5 h-5 text-gray-600" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                </svg>
              </button>
            </div>

            <div class="bg-gray-50 p-4 rounded-lg mb-4">
              <div id="journalEntry" class="text-gray-800 leading-relaxed" style="font-family: 'Georgia', serif;">
                <!-- AI-generated entry will appear here -->
              </div>
            </div>

            <div class="mb-4 text-center">
              <div class="text-sm text-gray-600">
                <span class="font-medium">Title:</span>
                <span id="entryTitle">My Day - {{ current_date|default:"Today" }}</span>
              </div>
            </div>

            <div class="space-mobile-y-3">
              <div class="grid-mobile-2" style="gap: 0.75rem;">
                <button type="button" onclick="editJournalEntry()" class="btn-mobile-sm bg-white border border-gray-300 text-gray-700">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
                  </svg>
                  Edit
                </button>
                <button type="button" onclick="restartEntry()" class="btn-mobile-sm bg-white border border-gray-300 text-gray-700">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                  </svg>
                  Try Again
                </button>
              </div>
              <a href="{% url 'dashboard' %}?entry_saved=true" id="saveDashboardButton" class="btn-mobile" style="background: linear-gradient(135deg, #10b981, #059669); color: white;">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                Save Entry
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Sidebar Content (Desktop only) -->
    <div class="sidebar-content desktop-only">
      <!-- Biography Preview -->
      <div class="card-mobile-lg mb-mobile-6" style="background: linear-gradient(135deg, #f8fafc, #e2e8f0);">
        <div class="flex-mobile-between mb-4">
          <h2 class="text-mobile-xl font-bold text-gray-800 flex items-center gap-2">
            <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
            Biography Preview
          </h2>
          <div class="text-sm text-gray-500">Updated today</div>
        </div>

        <div class="mb-4">
          <div class="flex-mobile-between text-sm text-gray-600 mb-2">
            <span>{{ total_entries }} entries processed</span>
            <span>{{ completion_percentage }}% complete</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" style="width: {{ completion_percentage }}%"></div>
          </div>
        </div>

        <div class="bg-white p-4 rounded-xl">
          <div class="text-gray-800 leading-relaxed" style="font-family: 'Georgia', serif;">
            {% if biography_preview %}
              {{ biography_preview }}
            {% else %}
              As you add more entries, your AI-generated biography will appear here. Start journaling to see your life story unfold.
            {% endif %}
          </div>
          <div class="mt-4 text-center">
            <a href="{% url 'biography' %}" class="text-purple-600 hover:underline flex items-center justify-center gap-1">
              <span>Continue reading</span>
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
            </a>
          </div>
        </div>
      </div>

      <!-- AI Insights Preview -->
      <div class="card-mobile mb-mobile-6" style="background: linear-gradient(135deg, #eff6ff, #dbeafe);">
        <div class="flex-mobile-between mb-4">
          <h2 class="text-mobile-lg font-bold text-gray-800 flex items-center gap-2">
            <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
            </svg>
            AI Insights
          </h2>
          <a href="{% url 'insights' %}" class="text-sm text-blue-600 hover:underline">View all</a>
        </div>

        <!-- Quick Mood Overview -->
        <div class="bg-white p-3 rounded-lg mb-3">
          <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-medium text-gray-700">Recent Mood</span>
            <span class="text-xl">üòä</span>
          </div>
          <div class="text-xs text-gray-500">Trending positive this week</div>
        </div>

        <!-- Top Topics Mini -->
        <div class="bg-white p-3 rounded-lg mb-3">
          <div class="text-sm font-medium text-gray-700 mb-2">Top Topics</div>
          <div class="space-y-1">
            <div class="flex items-center justify-between">
              <span class="text-xs text-gray-600">Work</span>
              <div class="w-16 h-1 bg-gray-200 rounded">
                <div class="w-3/4 h-full bg-blue-500 rounded"></div>
              </div>
            </div>
            <div class="flex items-center justify-between">
              <span class="text-xs text-gray-600">Family</span>
              <div class="w-16 h-1 bg-gray-200 rounded">
                <div class="w-1/2 h-full bg-green-500 rounded"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Writing Streak -->
        <div class="bg-white p-3 rounded-lg">
          <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-medium text-gray-700">Writing Streak</span>
            <span class="text-lg">üî•</span>
          </div>
          <div class="text-xs text-gray-500">{{ streak }} days and counting!</div>
        </div>
      </div>

      <!-- Time Periods -->
      <div class="card-mobile">
        <div class="flex-mobile-between mb-4">
          <h2 class="text-mobile-lg font-bold text-gray-800">Time Periods</h2>
          <a href="{% url 'library' %}" class="text-sm text-blue-600 hover:underline flex items-center gap-1">
            <span>View all</span>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </a>
        </div>

        <div class="space-y-3">
          {% for period in time_periods|slice:":3" %}
          <a href="{% url 'library' %}" class="block p-3 bg-white rounded-lg border border-gray-200 hover:border-purple-300 transition-colors">
            <div class="flex items-center justify-between">
              <div>
                <div class="font-semibold text-gray-800 text-sm">{{ period.period }}</div>
                <div class="text-xs text-gray-500">{{ period.count }} entries</div>
              </div>
              <div class="w-6 h-6 bg-purple-100 rounded-lg flex items-center justify-center">
                <svg class="w-3 h-3 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                </svg>
              </div>
            </div>
          </a>
          {% empty %}
          <div class="text-center py-4">
            <div class="text-gray-500 text-sm">No time periods yet</div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>

  <!-- Recent Entries Section (Mobile Only) -->
  <div class="mobile-only mb-mobile-8">
    <div class="flex-mobile-between mb-4">
      <h2 class="text-mobile-xl font-bold text-gray-800">Recent Entries</h2>
      <a href="{% url 'library' %}" class="text-sm text-blue-600 hover:underline flex items-center gap-1">
        <span>View all</span>
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </a>
    </div>

    <div class="card-mobile">
      {% for entry in recent_entries|slice:":3" %}
      <div class="entry-item active-mobile">
        <div class="flex-mobile-between mb-2">
          <h3 class="font-semibold text-gray-800 text-sm">{{ entry.title }}</h3>
          <div class="text-xs text-gray-500">{{ entry.created_at|date:"M j" }}</div>
        </div>

        <p class="text-sm text-gray-600 mb-3 leading-relaxed">{{ entry.content|truncatechars:120 }}</p>

        <div class="flex-mobile-between">
          <div class="flex-mobile-wrap">
            {% if entry.mood %}
              <span class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full">{{ entry.mood }}</span>
            {% endif %}
            {% for tag in entry.tags.all %}
              <span class="text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded-full">{{ tag.name }}</span>
            {% endfor %}
          </div>
          <a href="{% url 'entry_detail' entry.id %}" class="text-sm text-blue-600 hover:underline">Read more</a>
        </div>
      </div>
      {% empty %}
      <div class="text-center py-8">
        <div class="w-16 h-16 bg-gray-100 rounded-2xl flex-mobile-center mx-auto mb-4">
          <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
          </svg>
        </div>
        <h3 class="text-mobile-lg font-semibold text-gray-800 mb-2">No entries yet</h3>
        <p class="text-gray-600 mb-4">Start journaling to see your recent entries here.</p>
        <a href="{% url 'new_entry' %}" class="btn-mobile" style="background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white;">Create Your First Entry</a>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- Biography Preview (Mobile Only) -->
  <div class="mobile-only card-mobile-lg mb-mobile-8" style="background: linear-gradient(135deg, #f8fafc, #e2e8f0);">
    <div class="flex-mobile-between mb-4">
      <h2 class="text-mobile-xl font-bold text-gray-800 flex items-center gap-2">
        <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
        Biography Preview
      </h2>
      <div class="text-sm text-gray-500">Updated today</div>
    </div>

    <div class="mb-4">
      <div class="flex-mobile-between text-sm text-gray-600 mb-2">
        <span>{{ total_entries }} entries processed</span>
        <span>{{ completion_percentage }}% complete</span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" style="width: {{ completion_percentage }}%"></div>
      </div>
    </div>

    <div class="bg-white p-4 rounded-xl">
      <div class="text-gray-800 leading-relaxed" style="font-family: 'Georgia', serif;">
        {% if biography_preview %}
          {{ biography_preview }}
        {% else %}
          As you add more entries, your AI-generated biography will appear here. Start journaling to see your life story unfold.
        {% endif %}
      </div>
      <div class="mt-4 text-center">
        <a href="{% url 'biography' %}" class="text-purple-600 hover:underline flex items-center justify-center gap-1">
          <span>Continue reading</span>
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
        </a>
      </div>
    </div>
  </div>

  <!-- Time Periods Collection (Mobile Only) -->
  <div class="mobile-only mb-mobile-8">
    <div class="flex-mobile-between mb-4">
      <h2 class="text-mobile-xl font-bold text-gray-800">Time Periods</h2>
      <a href="{% url 'library' %}" class="text-sm text-blue-600 hover:underline flex items-center gap-1">
        <span>View all</span>
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </a>
    </div>

    <div class="grid-mobile-2">
      {% for period in time_periods %}
      <a href="{% url 'library' %}" class="book-item active-mobile">
        <div class="book-spine"></div>
        <div class="book-content">
          <div>
            <div class="font-bold text-sm text-center mb-1">{{ period.period }}</div>
            <div class="text-xs text-center text-gray-500 mb-2">
              {% if 'Q1' in period.period %}Jan - Mar{% endif %}
              {% if 'Q2' in period.period %}Apr - Jun{% endif %}
              {% if 'Q3' in period.period %}Jul - Sep{% endif %}
              {% if 'Q4' in period.period %}Oct - Dec{% endif %}
            </div>
            <div class="text-xs text-gray-600 leading-relaxed overflow-hidden" style="height: 60px;">
              {% if period.first_entry %}
                {{ period.first_entry.content|truncatechars:80 }}
              {% else %}
                Start adding entries to this time period...
              {% endif %}
            </div>
          </div>
          <div class="text-xs text-center font-medium">{{ period.count }} entries</div>
        </div>
      </a>
      {% empty %}
      <div class="col-span-full text-center py-8">
        <div class="w-16 h-16 bg-gray-100 rounded-2xl flex-mobile-center mx-auto mb-4">
          <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
          </svg>
        </div>
        <h3 class="text-mobile-lg font-semibold text-gray-800 mb-2">No entries yet</h3>
        <p class="text-gray-600 mb-4">Start journaling to build your library of memories.</p>
        <a href="{% url 'new_entry' %}" class="btn-mobile" style="background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white;">Create Your First Entry</a>
      </div>
      {% endfor %}

      <!-- Add New -->
      <a href="{% url 'new_entry' %}" class="add-book active-mobile">
        <div class="text-center">
          <div class="w-12 h-12 bg-white rounded-full flex-mobile-center mx-auto mb-2">
            <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
            </svg>
          </div>
          <div class="text-sm font-medium">Create New</div>
        </div>
      </a>
    </div>
  </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
  // Entry success notification check
  document.addEventListener('DOMContentLoaded', function() {
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('entry_saved') === 'true') {
      document.getElementById('entrySuccess').classList.remove('hidden');
      // Update URL without the parameter
      history.replaceState(null, '', window.location.pathname);
    }

    // Initialize character counter
    countChars();

    // Initialize photo memory interactions
    initPhotoMemories();
  });

  // Photo memory interactions
  function initPhotoMemories() {
    const memoryCards = document.querySelectorAll('.memory-card');

    memoryCards.forEach(card => {
      // Add click handler for mobile
      card.addEventListener('click', function(e) {
        // Prevent default link behavior temporarily
        e.preventDefault();

        // Add a slight scale effect
        this.style.transform = 'scale(0.98)';

        // Navigate after brief delay for visual feedback
        setTimeout(() => {
          this.style.transform = '';
          window.location.href = this.href;
        }, 150);
      });

      // Add touch feedback
      card.addEventListener('touchstart', function() {
        this.style.transform = 'scale(0.98)';
      });

      card.addEventListener('touchend', function() {
        this.style.transform = '';
      });
    });
  }

  // Character counter for journal input
  function countChars() {
    const input = document.getElementById('journalInput');
    const count = document.getElementById('charCount');
    if (input && count) {
      count.textContent = input.value.length;
    }
  }

  // Add suggestion to the journal input
  function addSuggestion(text) {
    const input = document.getElementById('journalInput');
    if (input.value && !input.value.endsWith(' ')) {
      input.value += ' ';
    }
    input.value += text + ' ';
    input.focus();
    countChars();
  }

  // Generate journal entry
  function generateEntry() {
    const journalInput = document.getElementById('journalInput');
    const inputText = journalInput.value.trim();

    if (!inputText) {
      alert('Please enter some notes about your day first.');
      return;
    }

    // Show loading
    document.getElementById('dashboardJournalForm').classList.add('hidden');
    document.getElementById('loadingIndicator').classList.remove('hidden');

    // Simulate API call
    setTimeout(() => {
      generateJournalContent(inputText).then(generatedText => {
        document.getElementById('loadingIndicator').classList.add('hidden');
        document.getElementById('resultPreview').classList.remove('hidden');
        document.getElementById('journalEntry').textContent = generatedText;

        const today = new Date();
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        document.getElementById('entryTitle').textContent = "My Day - " + today.toLocaleDateString(undefined, options);
      });
    }, 1500);
  }

  // Generate journal content
  async function generateJournalContent(input) {
    const usePersonalizedStyle = document.getElementById('personalizationToggle').checked;

    try {
      return generateSampleEntry(input, usePersonalizedStyle);
    } catch (error) {
      console.error('Error generating journal entry:', error);
      return "There was an error generating your journal entry. Please try again.";
    }
  }

  // Generate sample entry
  function generateSampleEntry(input, usePersonalizedStyle) {
    const introductions = [
      "Dear Diary,",
      "Today was quite a day.",
      "As I reflect on today,",
      "Another day has passed, and I'm taking a moment to record my thoughts."
    ];

    const conclusions = [
      "Looking forward to what tomorrow brings.",
      "That's all for today.",
      "Until tomorrow,",
      "I'm grateful for the experiences of today."
    ];

    const intro = introductions[Math.floor(Math.random() * introductions.length)];
    const conclusion = conclusions[Math.floor(Math.random() * conclusions.length)];

    const points = input.split(/[.,;]/).filter(point => point.trim().length > 0);

    const expandedPoints = points.map(point => {
      const trimmed = point.trim();
      if (trimmed.toLowerCase().includes('breakfast')) {
        return `I started my day with ${trimmed.replace('breakfast', '').trim() || 'a nice breakfast'}.`;
      } else if (trimmed.toLowerCase().includes('meeting')) {
        return `I attended a meeting ${trimmed.includes('with') ? trimmed : 'about work matters'}. It was productive, and we covered several important topics.`;
      } else if (trimmed.toLowerCase().includes('run') || trimmed.toLowerCase().includes('exercise')) {
        return `I made time for physical activity today - ${trimmed}. It felt great to get moving.`;
      } else if (trimmed.length > 0) {
        return `${trimmed.charAt(0).toUpperCase() + trimmed.slice(1)}.`;
      }
      return '';
    }).filter(point => point.length > 0);

    let style = usePersonalizedStyle ?
      "I'm noticing patterns in my daily routine that bring me joy. " :
      "";

    return `${intro}\n\n${expandedPoints.join(' ')}\n\n${style}${conclusion}`;
  }

  // Edit journal entry
  function editJournalEntry() {
    const journalEntry = document.getElementById('journalEntry').textContent;
    const journalInput = document.getElementById('journalInput');

    journalInput.value = journalEntry;
    document.getElementById('dashboardJournalForm').classList.remove('hidden');
    document.getElementById('resultPreview').classList.add('hidden');

    countChars();
    journalInput.focus();
  }

  // Restart entry
  function restartEntry() {
    document.getElementById('journalInput').value = '';
    document.getElementById('dashboardJournalForm').classList.remove('hidden');
    document.getElementById('resultPreview').classList.add('hidden');

    countChars();
    document.getElementById('journalInput').focus();
  }
</script>
{% endblock %}
