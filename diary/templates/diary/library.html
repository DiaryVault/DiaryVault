{% extends 'base.html' %}

{% block title %}DiaryVault - Your Journal Collection{% endblock %}

{% block extra_css %}
<style>
  /* HARMONIZED DESIGN SYSTEM - Consistent with Dashboard, Journal & Insights */
  
  /* Core Variables - Matching other pages */
  :root {
    --primary-gradient: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
    --secondary-gradient: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
    --success-gradient: linear-gradient(135deg, #10b981 0%, #059669 100%);
    --card-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    --card-hover-shadow: 0 15px 35px rgba(0, 0, 0, 0.12);
    --border-radius-lg: 20px;
    --border-radius-md: 16px;
    --border-radius-sm: 12px;
  }

  /* Typography - Consistent with other pages */
  .diary-font {
    font-family: 'Playfair Display', serif;
    letter-spacing: -0.01em;
    line-height: 1.5;
  }

  .handwritten {
    font-family: 'Satisfy', cursive;
    letter-spacing: 0.01em;
    line-height: 1.7;
  }

  /* Smooth scrolling - Matching insights.html */
  html {
    scroll-behavior: smooth;
    overflow-y: auto;
    overflow-x: hidden;
  }

  /* Minimal scrollbar styling - Consistent across pages */
  * {
    scrollbar-width: thin;
    scrollbar-color: rgba(0, 0, 0, 0.2) rgba(0, 0, 0, 0.05);
  }

  *::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }

  *::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.05);
    border-radius: 3px;
  }

  *::-webkit-scrollbar-thumb {
    background: rgba(0, 0, 0, 0.2);
    border-radius: 3px;
    transition: background 0.2s ease;
  }

  *::-webkit-scrollbar-thumb:hover {
    background: rgba(0, 0, 0, 0.3);
  }

  /* Enhanced animations - Matching journal.html */
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes scaleIn {
    from { opacity: 0; transform: scale(0.96); }
    to { opacity: 1; transform: scale(1); }
  }

  @keyframes floatIn {
    0% { opacity: 0; transform: translateY(10px); }
    100% { opacity: 1; transform: translateY(0); }
  }

  .animate-fade-in {
    animation: fadeIn 0.5s ease-out forwards;
  }

  .animate-scale-in {
    animation: scaleIn 0.4s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
  }

  .animate-float-in {
    animation: floatIn 0.6s ease-out forwards;
  }

  .animation-delay-100 { animation-delay: 100ms; }
  .animation-delay-200 { animation-delay: 200ms; }
  .animation-delay-300 { animation-delay: 300ms; }
  .animation-delay-400 { animation-delay: 400ms; }
  .animation-delay-500 { animation-delay: 500ms; }

  /* Card styling - Consistent with insights.html */
  .card-base {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(12px);
    border-radius: var(--border-radius-lg);
    box-shadow: var(--card-shadow);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    border: 1px solid rgba(255, 255, 255, 0.2);
  }

  .card-base:hover {
    transform: translateY(-4px);
    box-shadow: var(--card-hover-shadow);
  }

  /* Header styling - Consistent with dashboard */
  .page-header {
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(10px);
    border-radius: var(--border-radius-lg);
    padding: 1.5rem;
    box-shadow: var(--card-shadow);
    border: 1px solid rgba(255, 255, 255, 0.3);
    margin-bottom: 2rem;
  }

  @media (min-width: 640px) {
    .page-header {
      padding: 2rem;
    }
  }

  /* Gradient text - Consistent across pages */
  .gradient-text {
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  /* Button styles - Matching journal.html */
  .btn-primary {
    background: var(--primary-gradient);
    color: white;
    padding: 0.75rem 1.5rem;
    border-radius: 9999px;
    font-weight: 500;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  }

  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
  }

  /* Search container - Enhanced from original */
  .search-container {
    position: relative;
    transition: all 0.3s ease;
  }

  .search-container:focus-within {
    transform: scale(1.02);
  }

  .search-input {
    width: 100%;
    padding: 0.75rem 1rem 0.75rem 2.5rem;
    border-radius: var(--border-radius-sm);
    border: 1px solid rgba(255, 255, 255, 0.5);
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(8px);
    transition: all 0.3s ease;
    font-size: 0.875rem;
  }

  .search-input:focus {
    border-color: #6366f1;
    background: white;
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    outline: none;
  }

  /* Stats grid - Matching dashboard style */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.75rem;
    margin-bottom: 2rem;
  }

  @media (min-width: 640px) {
    .stats-grid {
      grid-template-columns: repeat(4, 1fr);
      gap: 1rem;
    }
  }

  .stat-card {
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(8px);
    border-radius: var(--border-radius-md);
    padding: 1rem;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.3);
    display: flex;
    align-items: center;
    gap: 0.75rem;
    transition: all 0.3s ease;
  }

  .stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  }

  .stat-icon {
    width: 3rem;
    height: 3rem;
    border-radius: var(--border-radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  /* Modern tabs - Enhanced for consistency */
  .modern-tabs {
    display: flex;
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(8px);
    padding: 0.375rem;
    border-radius: var(--border-radius-sm);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    position: relative;
    border: 1px solid rgba(255, 255, 255, 0.5);
    margin-bottom: 2rem;
  }

  .tab-selector {
    position: absolute;
    height: calc(100% - 0.75rem);
    top: 0.375rem;
    left: 0.375rem;
    background: white;
    border-radius: 0.5rem;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.08);
    z-index: 0;
  }

  .modern-tab {
    padding: 0.625rem 1.25rem;
    font-size: 0.875rem;
    font-weight: 500;
    color: #6b7280;
    border-radius: 0.5rem;
    position: relative;
    z-index: 1;
    transition: all 0.3s ease;
    flex: 1;
    text-align: center;
    white-space: nowrap;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    cursor: pointer;
    background: none;
    border: none;
  }

  .modern-tab:hover {
    color: #4b5563;
  }

  .modern-tab.active {
    color: #6366f1;
    font-weight: 600;
  }

  /* Journal Collection - Enhanced */
  .journal-collection {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1.5rem;
  }

  @media (max-width: 768px) {
    .journal-collection {
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 1rem;
    }
  }

  .journal-card {
    position: relative;
    transition: all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
    transform-style: preserve-3d;
    perspective: 1000px;
    overflow: hidden;
  }

  .journal-card:hover {
    transform: translateY(-8px);
    box-shadow: var(--card-hover-shadow);
  }

  .journal-cover {
    position: relative;
    height: 280px;
    background-size: cover;
    background-position: center;
    border-radius: var(--border-radius-md);
    overflow: hidden;
    transition: all 0.3s ease;
    box-shadow: var(--card-shadow);
    border: 1px solid rgba(255, 255, 255, 0.2);
  }

  @media (max-width: 768px) {
    .journal-cover {
      height: 220px;
    }
  }

  .journal-info {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 1.25rem;
    background: linear-gradient(to top, rgba(0, 0, 0, 0.7), transparent);
    color: white;
    transform: translateY(0);
    transition: all 0.3s ease;
  }

  .journal-card:hover .journal-info {
    transform: translateY(-5px);
  }

  .journal-title {
    font-size: 1.2rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
  }

  .journal-meta {
    display: flex;
    justify-content: space-between;
    font-size: 0.75rem;
    opacity: 0.9;
  }

  .journal-meta-item {
    display: flex;
    align-items: center;
    gap: 0.375rem;
  }

  /* Journal preview content */
  .journal-preview {
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.85));
    backdrop-filter: blur(4px);
    padding: 1.5rem;
    opacity: 0;
    transform: translateY(10px);
    transition: all 0.3s ease;
    overflow: auto;
    display: flex;
    flex-direction: column;
  }

  .journal-card:hover .journal-preview,
  .journal-card.touch-active .journal-preview {
    opacity: 1;
    transform: translateY(0);
  }

  .preview-content {
    font-family: 'Satisfy', cursive;
    font-size: 0.95rem;
    line-height: 1.6;
    color: #4b5563;
    flex-grow: 1;
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 8;
    -webkit-box-orient: vertical;
  }

  .preview-actions {
    margin-top: auto;
    display: flex;
    justify-content: space-between;
  }

  /* Memory grid - Enhanced to match insights sections */
  .memory-grid {
    display: grid;
    grid-template-columns: repeat(12, 1fr);
    grid-auto-rows: minmax(180px, auto);
    gap: 1rem;
  }

  @media (max-width: 768px) {
    .memory-grid {
      display: flex;
      flex-direction: column;
    }
  }

  .memory-card {
    background-color: white;
    border-radius: var(--border-radius-md);
    box-shadow: var(--card-shadow);
    overflow: hidden;
    transition: all 0.3s ease;
    position: relative;
    transform: translateY(0);
  }

  .memory-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--card-hover-shadow);
  }

  .memory-card.featured {
    grid-column: span 8;
    grid-row: span 2;
  }

  .memory-card.normal {
    grid-column: span 4;
    grid-row: span 1;
  }

  .memory-card.tall {
    grid-column: span 4;
    grid-row: span 2;
  }

  .memory-card.wide {
    grid-column: span 8;
    grid-row: span 1;
  }

  @media (max-width: 768px) {
    .memory-card.featured,
    .memory-card.normal,
    .memory-card.tall,
    .memory-card.wide {
      grid-column: 1 / -1;
      grid-row: auto;
      min-height: 200px;
      margin-bottom: 1rem;
    }
  }

  .memory-content {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 1.5rem;
    background: linear-gradient(to top, rgba(0,0,0,0.7) 0%, transparent 100%);
    color: white;
  }

  .memory-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
  }

  .memory-card:hover .memory-image {
    transform: scale(1.05);
  }

  /* Timeline view - Enhanced */
  .timeline-container {
    position: relative;
    padding-left: 2rem;
  }

  @media (max-width: 768px) {
    .timeline-container {
      padding-left: 1.5rem;
    }
  }

  .timeline-line {
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 2px;
    background: var(--primary-gradient);
    opacity: 0.5;
  }

  .timeline-entry {
    position: relative;
    margin-bottom: 2rem;
    opacity: 0;
    animation: fadeIn 0.5s ease-out forwards;
  }

  .timeline-entry::before {
    content: '';
    position: absolute;
    left: -2rem;
    top: 0;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: var(--primary-gradient);
    border: 2px solid white;
    z-index: 1;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }

  @media (max-width: 768px) {
    .timeline-entry::before {
      left: -1.5rem;
      width: 10px;
      height: 10px;
    }
  }

  /* Calendar view - Enhanced */
  .calendar-view {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 0.5rem;
  }

  @media (max-width: 768px) {
    .calendar-view {
      gap: 0.25rem;
    }
  }

  .calendar-day {
    aspect-ratio: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 0.5rem;
    border-radius: 0.5rem;
    transition: all 0.2s ease;
    border: 1px solid transparent;
    cursor: pointer;
  }

  .calendar-day.has-entry {
    background-color: rgba(99, 102, 241, 0.1);
    border-color: rgba(99, 102, 241, 0.2);
    color: #4f46e5;
    font-weight: 500;
  }

  .calendar-day.weekend {
    color: #6b7280;
    background-color: rgba(107, 114, 128, 0.05);
  }

  .calendar-day:hover {
    transform: scale(1.05);
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    z-index: 1;
  }

  .calendar-day-number {
    font-size: 0.875rem;
  }

  .calendar-day-indicator {
    height: 5px;
    width: 5px;
    border-radius: 50%;
    background-color: #4f46e5;
    margin-top: 0.25rem;
  }

  /* Mood pills - Consistent with insights */
  .mood-pill {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    border-radius: 9999px;
    padding: 0.375rem 0.75rem;
    font-size: 0.75rem;
    font-weight: 500;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    transition: all 0.2s ease;
  }

  .mood-pill.happy {
    background-color: #ecfdf5;
    color: #059669;
    border: 1px solid rgba(5, 150, 105, 0.2);
  }

  .mood-pill.content {
    background-color: #eff6ff;
    color: #3b82f6;
    border: 1px solid rgba(59, 130, 246, 0.2);
  }

  .mood-pill.excited {
    background-color: #f5f3ff;
    color: #8b5cf6;
    border: 1px solid rgba(139, 92, 246, 0.2);
  }

  .mood-pill.neutral {
    background-color: #f3f4f6;
    color: #6b7280;
    border: 1px solid rgba(107, 114, 128, 0.2);
  }

  .mood-pill.anxious {
    background-color: #fffbeb;
    color: #d97706;
    border: 1px solid rgba(217, 119, 6, 0.2);
  }

  .mood-pill.sad {
    background-color: #fee2e2;
    color: #dc2626;
    border: 1px solid rgba(220, 38, 38, 0.2);
  }

  /* Filters - Enhanced */
  .filters-container {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    padding: 0.75rem;
    background: rgba(255, 255, 255, 0.6);
    backdrop-filter: blur(8px);
    border-radius: var(--border-radius-sm);
    border: 1px solid rgba(255, 255, 255, 0.8);
    overflow-x: auto;
    margin-bottom: 1rem;
  }

  .filter-chip {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.375rem 0.75rem;
    background-color: white;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 500;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    border: 1px solid #e5e7eb;
    color: #4b5563;
    transition: all 0.2s ease;
    cursor: pointer;
    white-space: nowrap;
  }

  .filter-chip:hover {
    background-color: #f9fafb;
    border-color: #d1d5db;
    transform: translateY(-1px);
  }

  .filter-chip.active {
    background-color: #4f46e5;
    border-color: #4338ca;
    color: white;
  }

  /* Empty states - Consistent with insights */
  .empty-state {
    text-align: center;
    padding: 3rem 2rem;
    background: rgba(255, 255, 255, 0.6);
    border-radius: var(--border-radius-lg);
    border: 2px dashed rgba(156, 163, 175, 0.3);
  }

  .empty-icon {
    width: 4rem;
    height: 4rem;
    margin: 0 auto 1rem;
    color: #d1d5db;
  }

  /* Loading states */
  .loading-shimmer {
    background: linear-gradient(to right, #f6f7f8 8%, #edeef1 18%, #f6f7f8 33%);
    background-size: 1000px 100%;
    animation: shimmer 2s infinite linear;
  }

  @keyframes shimmer {
    0% { background-position: -1000px 0; }
    100% { background-position: 1000px 0; }
  }

  /* Floating action button - Enhanced */
  .floating-action-button {
    position: fixed;
    bottom: 1.5rem;
    right: 1.5rem;
    z-index: 50;
    background: var(--primary-gradient);
    color: white;
    padding: 1rem;
    border-radius: 50%;
    box-shadow: 0 10px 25px rgba(99, 102, 241, 0.3);
    transition: all 0.3s ease;
  }

  .floating-action-button:hover {
    transform: scale(1.05) translateY(-2px);
    box-shadow: 0 15px 35px rgba(99, 102, 241, 0.4);
  }

  /* Mobile bottom navigation - Enhanced */
  @media (max-width: 768px) {
    .mobile-bottom-nav {
      display: flex;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border-top: 1px solid rgba(229, 231, 235, 0.8);
      z-index: 50;
      padding: 0.5rem 0.25rem;
      justify-content: space-around;
    }

    .mobile-nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 0.5rem;
      border-radius: 0.5rem;
      min-width: 4rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .mobile-nav-item.active {
      background-color: rgba(99, 102, 241, 0.1);
      color: #4f46e5;
    }

    .mobile-nav-icon {
      margin-bottom: 0.25rem;
    }

    .mobile-nav-label {
      font-size: 0.625rem;
      font-weight: 500;
    }

    .page-content {
      padding-bottom: 4.5rem;
    }

    .floating-action-button {
      bottom: 5rem;
    }
  }

  /* Journal patterns - Enhanced */
  .pattern-dots {
    background-image: radial-gradient(#6366f1 0.5px, transparent 0.5px);
    background-size: 10px 10px;
  }

  .pattern-lines {
    background-image: linear-gradient(rgba(99, 102, 241, 0.2) 1px, transparent 1px);
    background-size: 100% 15px;
  }

  .pattern-grid {
    background: linear-gradient(rgba(99, 102, 241, 0.1) 1px, transparent 1px),
                linear-gradient(to right, rgba(99, 102, 241, 0.1) 1px, transparent 1px);
    background-size: 20px 20px;
  }

  /* Journal colors */
  .journal-color-blue { background-color: #3b82f6; }
  .journal-color-purple { background-color: #8b5cf6; }
  .journal-color-pink { background-color: #ec4899; }
  .journal-color-green { background-color: #10b981; }
  .journal-color-yellow { background-color: #f59e0b; }
  .journal-color-red { background-color: #ef4444; }
  .journal-color-gray { background-color: #6b7280; }

  /* Section headers - Consistent with insights */
  .section-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
  }

  .section-icon {
    width: 2.5rem;
    height: 2.5rem;
    border-radius: var(--border-radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  .section-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: #374151;
  }

  /* Accessibility improvements */
  .journal-card:focus,
  .memory-card:focus,
  .calendar-day:focus,
  .filter-chip:focus {
    outline: 2px solid #6366f1;
    outline-offset: 2px;
  }

  /* Keyboard navigation styles */
  .keyboard-navigation *:focus {
    outline: 2px solid #6366f1 !important;
    outline-offset: 2px !important;
    transition: outline 0.2s ease !important;
  }

  /* Responsive improvements for very small screens */
  @media (max-width: 480px) {
    .modern-tab {
      padding: 0.375rem;
      font-size: 0.675rem;
    }

    .modern-tab svg {
      height: 0.875rem;
      width: 0.875rem;
    }

    .journal-cover {
      height: 180px;
    }

    .stat-card {
      padding: 0.75rem;
    }

    .stat-icon {
      width: 2.5rem;
      height: 2.5rem;
    }

    .calendar-day {
      padding: 0.125rem;
    }

    .calendar-day-number {
      font-size: 0.675rem;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-6 pb-12 page-content">
  <!-- Decorative elements (matching other pages) -->
  <div class="hidden sm:block absolute -top-10 -left-16 h-48 w-48 bg-secondary-300 rounded-full mix-blend-multiply filter blur-xl opacity-20"></div>
  <div class="hidden sm:block absolute -bottom-32 -right-16 h-48 w-48 bg-primary-300 rounded-full mix-blend-multiply filter blur-xl opacity-20"></div>

  <!-- Page Header - Enhanced to match other pages -->
  <div class="page-header animate-fade-in">
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-3 sm:gap-5">
      <div>
        <h1 class="text-2xl sm:text-4xl font-bold gradient-text mb-2 diary-font">
          Your Memory Collection
        </h1>
        <p class="text-sm sm:text-base text-gray-600 max-w-2xl">
          Explore your personal collection of thoughts, memories, and reflections.
          {% if entries|length > 0 %}You have <span class="font-medium text-indigo-600">{{ entries|length }}</span> entries so far.{% endif %}
        </p>

        <!-- Active filter badge -->
        {% if active_filter %}
        <div class="inline-flex items-center px-3 py-1 mt-3 bg-indigo-50 text-indigo-700 rounded-full text-sm font-medium border border-indigo-200">
          <span>
            {% if active_tab == 'tags' %}Tag:{% elif active_tab == 'moods' %}Mood:{% else %}Period:{% endif %}
            {{ active_filter }}
          </span>
          <a href="{% url 'library' %}" class="ml-2 flex items-center text-gray-500 hover:text-red-500 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </a>
        </div>
        {% endif %}
      </div>

      <!-- Search and New Entry - Enhanced -->
      <div class="flex flex-col sm:flex-row items-center gap-3 w-full md:w-auto">
        <div class="search-container flex-grow w-full md:w-72">
          <input type="text" 
                 placeholder="Search your memories..." 
                 class="search-input"
                 id="searchInput"
                 aria-label="Search journal entries">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 absolute left-3 top-1/2 transform -translate-y-1/2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
        </div>

        <a href="{% url 'new_entry' %}" class="btn-primary w-full sm:w-auto justify-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
          </svg>
          New Entry
        </a>
      </div>
    </div>
  </div>

  <!-- Quick Stats Cards - Enhanced with consistent styling -->
  <div class="stats-grid">
    <div class="stat-card animate-scale-in animation-delay-100">
      <div class="stat-icon bg-gradient-to-br from-indigo-400 to-indigo-600">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
        </svg>
      </div>
      <div>
        <div class="text-xl sm:text-2xl font-bold text-gray-800">{{ entries|length }}</div>
        <div class="text-xs text-gray-500">Total Entries</div>
      </div>
    </div>

    <div class="stat-card animate-scale-in animation-delay-200">
      <div class="stat-icon bg-gradient-to-br from-purple-400 to-purple-600">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
      </div>
      <div>
        <div class="text-xl sm:text-2xl font-bold text-gray-800">{{ time_periods|length }}</div>
        <div class="text-xs text-gray-500">Time Periods</div>
      </div>
    </div>

    <div class="stat-card animate-scale-in animation-delay-300">
      <div class="stat-icon bg-gradient-to-br from-pink-400 to-pink-600">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
        </svg>
      </div>
      <div>
        <div class="text-xl sm:text-2xl font-bold text-gray-800">{{ tags|length }}</div>
        <div class="text-xs text-gray-500">Unique Tags</div>
      </div>
    </div>

    <div class="stat-card animate-scale-in animation-delay-400">
      <div class="stat-icon bg-gradient-to-br from-green-400 to-green-600">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
      </div>
      <div>
        <div class="text-xl sm:text-2xl font-bold text-gray-800">{{ moods|length }}</div>
        <div class="text-xs text-gray-500">Mood States</div>
      </div>
    </div>
  </div>

  <!-- Modern Tabs -->
  <div class="relative animate-fade-in animation-delay-500">
    <div class="modern-tabs">
      <div id="tabSelector" class="tab-selector" style="width: 25%;"></div>
      <button onclick="switchTab('memories')" class="modern-tab active" data-tab-width="25%" data-tab-offset="0%">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
        <span>Memories</span>
      </button>
      <button onclick="switchTab('journals')" class="modern-tab" data-tab-width="25%" data-tab-offset="25%">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
        </svg>
        <span>Journals</span>
      </button>
      <button onclick="switchTab('timeline')" class="modern-tab" data-tab-width="25%" data-tab-offset="50%">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
        </svg>
        <span>Timeline</span>
      </button>
      <button onclick="switchTab('calendar')" class="modern-tab" data-tab-width="25%" data-tab-offset="75%">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
        <span>Calendar</span>
      </button>
    </div>
  </div>

  <!-- Tab Contents -->
  <div id="tabContents">
    <!-- Memories Tab -->
    <div id="memories-tab" class="tab-content animate-fade-in">
      <!-- Scrollable filters -->
      <div class="filters-container">
        <div class="filter-chip active">
          <span>All Memories</span>
        </div>
        <div class="filter-chip">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
          </svg>
          <span>Has Photos</span>
        </div>
        <div class="filter-chip">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
          </svg>
          <span>With AI Insights</span>
        </div>
        <div class="filter-chip">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
          </svg>
          <span>Favorites</span>
        </div>
        <div class="filter-chip">
          <span>Last 30 Days</span>
        </div>
      </div>

      {% if entries|length > 0 %}
      <!-- Memory Collection -->
      <div class="memory-grid mb-6 sm:mb-10">
        {% for entry in entries|slice:":10" %}
          <div class="memory-card {% cycle 'featured' 'normal' 'tall' 'wide' 'normal' 'normal' 'wide' 'normal' 'tall' 'featured' %} animate-scale-in" style="animation-delay: {{ forloop.counter0|add:1 }}00ms;">
            <a href="{% url 'entry_detail' entry.id %}">
              {% if entry.photos.first %}
                <img src="{{ entry.photos.first.photo.url }}" alt="Entry photo" class="memory-image" />
              {% elif entry.photo.url|default:'' %}
                <img src="{{ entry.photo.url }}" alt="Entry photo" class="memory-image" />
              {% else %}
                <div class="memory-image bg-gradient-to-br {{ forloop.counter0|divisibleby:6|yesno:'from-indigo-400 to-purple-500,from-pink-400 to-rose-500,from-cyan-400 to-blue-500,from-green-400 to-emerald-500,from-amber-400 to-orange-500,from-red-400 to-rose-500' }} p-4 flex items-center justify-center">
                  <div class="handwritten text-white text-center opacity-80 font-medium text-sm">
                    {{ entry.content|truncatechars:150 }}
                  </div>
                </div>
              {% endif %}
              <div class="memory-content">
                <h3 class="font-bold text-base sm:text-lg text-white mb-1">{{ entry.title|default:"Untitled Memory" }}</h3>
                <div class="flex justify-between items-center">
                  <div class="text-xs text-white/80">{{ entry.created_at|date:"F j, Y" }}</div>
                  {% if entry.mood %}
                  <div class="text-xs py-1 px-2 rounded-full bg-white/20 text-white">
                    {% if entry.mood == 'happy' %}😊
                    {% elif entry.mood == 'content' %}😌
                    {% elif entry.mood == 'excited' %}🤩
                    {% elif entry.mood == 'neutral' %}😐
                    {% elif entry.mood == 'anxious' %}😰
                    {% elif entry.mood == 'sad' %}😢
                    {% else %}✨
                    {% endif %}
                    {{ entry.mood|title }}
                  </div>
                  {% endif %}
                </div>
              </div>
            </a>
          </div>
        {% endfor %}
      </div>
      {% else %}
      <!-- Empty state -->
      <div class="empty-state card-base">
        <div class="empty-icon mx-auto">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
          </svg>
        </div>
        <h3 class="text-lg sm:text-xl font-bold text-gray-800 mb-2">Start Your Memory Collection</h3>
        <p class="text-sm text-gray-600 mb-4 sm:mb-6 max-w-md mx-auto">Begin capturing your thoughts, experiences, and reflections with your first journal entry.</p>
        <a href="{% url 'new_entry' %}" class="btn-primary">
          Create Your First Memory
        </a>
      </div>
      {% endif %}

      {% if entries|length > 10 %}
      <!-- Load More Button -->
      <div class="text-center mb-6">
        <button id="loadMoreMemories" class="px-4 py-2 sm:py-2.5 bg-white rounded-xl shadow border border-gray-200 text-gray-700 font-medium hover:bg-gray-50 transition-colors flex items-center mx-auto">
          <span>Load More Memories</span>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </button>
      </div>
      {% endif %}
    </div>

    <!-- Journals Tab -->
    <div id="journals-tab" class="tab-content hidden animate-fade-in">
      <!-- Journal collection -->
      <div class="journal-collection">
        {% for period in time_periods %}
          <div class="journal-card animate-scale-in" style="animation-delay: {{ forloop.counter0|add:1 }}00ms;">
            <div class="journal-cover journal-color-{{ forloop.counter0|divisibleby:7|yesno:'blue,purple,pink,green,yellow,red,gray' }} {{ forloop.counter0|divisibleby:3|yesno:'pattern-dots,pattern-lines,pattern-grid,' }}">
              <div class="journal-info">
                <h3 class="journal-title">{{ period.period }}</h3>
                <div class="journal-meta">
                  <div class="journal-meta-item">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    <span>
                      {% if 'Q1' in period.period %}Jan - Mar{% endif %}
                      {% if 'Q2' in period.period %}Apr - Jun{% endif %}
                      {% if 'Q3' in period.period %}Jul - Sep{% endif %}
                      {% if 'Q4' in period.period %}Oct - Dec{% endif %}
                    </span>
                  </div>
                  <div class="journal-meta-item">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                    </svg>
                    <span>{{ period.count }} entries</span>
                  </div>
                </div>
              </div>
              <div class="journal-preview">
                <h4 class="text-base sm:text-lg font-bold text-gray-800 mb-3 diary-font border-b border-gray-200 pb-2">{{ period.period }}</h4>
                <div class="preview-content">
                  {% if period.first_entry %}
                    {{ period.first_entry.content|truncatechars:300 }}
                  {% else %}
                    This journal is empty. Start adding entries to capture your memories from this time period.
                  {% endif %}
                </div>
                <div class="preview-actions mt-3 pt-2 border-t border-gray-100">
                  <span class="text-xs text-gray-500">{{ period.count }} entries total</span>
                  <a href="{% url 'time_period' period.period %}" class="inline-flex items-center text-sm text-indigo-600 hover:text-indigo-700">
                    <span>Open Journal</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                    </svg>
                  </a>
                </div>
              </div>
            </div>
          </div>
        {% empty %}
          <div class="col-span-full empty-state card-base">
            <div class="empty-icon mx-auto">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
              </svg>
            </div>
            <h3 class="text-lg sm:text-xl font-bold text-gray-800 mb-2">Your Journal Collection Is Empty</h3>
            <p class="text-sm text-gray-600 mb-4 sm:mb-6 max-w-md mx-auto">Start writing entries to automatically create journals organized by time periods.</p>
            <a href="{% url 'new_entry' %}" class="btn-primary">
              Create Your First Entry
            </a>
          </div>
        {% endfor %}
      </div>

      <!-- Recent Entries By Tag Section -->
      <div class="mt-6 sm:mt-10 mb-4 sm:mb-6">
        <div class="section-header">
          <div class="section-icon bg-gradient-to-br from-indigo-500 to-purple-600">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
            </svg>
          </div>
          <h3 class="section-title diary-font">Browse by Tags</h3>
        </div>

        <div class="filters-container">
          <div class="filter-chip active">
            <span>All Tags</span>
          </div>
          {% for tag in tags %}
            <a href="{% url 'library' %}?tag={{ tag.name }}" class="filter-chip {% if tag.active %}active{% endif %}">
              <span>{{ tag.name }}</span>
              <span class="ml-1 px-1.5 py-0.5 rounded-full bg-white/80 text-xs text-gray-600">{{ tag.count }}</span>
            </a>
          {% empty %}
            <span class="text-sm text-gray-500 px-2">No tags found</span>
          {% endfor %}
        </div>
      </div>

      <!-- Recent Entries By Mood Section -->
      <div class="mt-6 sm:mt-10 mb-4 sm:mb-6">
        <div class="section-header">
          <div class="section-icon bg-gradient-to-br from-yellow-400 to-orange-500">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
          <h3 class="section-title diary-font">Browse by Moods</h3>
        </div>

        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-2 sm:gap-3">
          {% for mood in moods %}
            <a href="{% url 'library' %}?mood={{ mood.name }}" class="card-base p-3 text-center group {% if mood.active %}ring-2 ring-indigo-400{% endif %} animate-scale-in" style="animation-delay: {{ forloop.counter0 }}00ms;">
              <div class="text-2xl sm:text-3xl mb-1">{{ mood.emoji }}</div>
              <div class="font-medium text-gray-800 mb-1 text-xs sm:text-sm group-hover:text-indigo-600 capitalize">{{ mood.name }}</div>
              <div class="text-xs text-gray-500">{{ mood.count }} entries</div>
            </a>
          {% empty %}
            <div class="col-span-full card-base p-4 text-center">
              <p class="text-gray-600 text-sm">No mood data available yet</p>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- Timeline Tab -->
    <div id="timeline-tab" class="tab-content hidden animate-fade-in">
      <div class="timeline-container">
        <div class="timeline-line"></div>

        {% for entry in entries %}
          <div class="timeline-entry" style="animation-delay: {{ forloop.counter0 }}00ms;">
            <div class="card-base overflow-hidden {% if entry.mood %}border-l-4 border-{% if entry.mood == 'happy' %}green-400{% elif entry.mood == 'content' %}blue-400{% elif entry.mood == 'excited' %}purple-400{% elif entry.mood == 'anxious' %}amber-400{% elif entry.mood == 'sad' %}red-400{% else %}gray-400{% endif %}{% endif %}">
              <div class="p-3 sm:p-4">
                <div class="flex flex-col sm:flex-row sm:justify-between sm:items-start mb-2 sm:mb-3">
                  <h3 class="font-bold diary-font text-gray-800 text-base mb-1 sm:mb-0">{{ entry.title|default:"Untitled Entry" }}</h3>
                  <div class="text-xs text-gray-500 flex items-center gap-1 sm:gap-2 bg-white/50 px-2 py-1 rounded-full self-start">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    {{ entry.created_at|date:"F j, Y" }}
                  </div>
                </div>

                <div class="flex flex-col sm:flex-row sm:items-start gap-2 sm:gap-4">
                  {% if entry.photos.first %}
                    <div class="w-full sm:w-24 h-24 shrink-0 rounded-lg overflow-hidden shadow-sm">
                      <img src="{{ entry.photos.first.photo.url }}" alt="Entry photo" class="w-full h-full object-cover" />
                    </div>
                  {% elif entry.photo.url|default:'' %}
                    <div class="w-full sm:w-24 h-24 shrink-0 rounded-lg overflow-hidden shadow-sm">
                      <img src="{{ entry.photo.url }}" alt="Entry photo" class="w-full h-full object-cover" />
                    </div>
                  {% endif %}

                  <div class="flex-grow">
                    <p class="text-gray-700 handwritten text-xs sm:text-sm mb-3">{{ entry.content|truncatechars:150 }}</p>

                    <div class="flex flex-wrap gap-2 items-center">
                      {% if entry.mood %}
                        <span class="mood-pill {{ entry.mood }}">
                          {% if entry.mood == 'happy' %}😊
                          {% elif entry.mood == 'content' %}😌
                          {% elif entry.mood == 'excited' %}🤩
                          {% elif entry.mood == 'neutral' %}😐
                          {% elif entry.mood == 'anxious' %}😰
                          {% elif entry.mood == 'sad' %}😢
                          {% else %}😐
                          {% endif %}
                          {{ entry.mood|title }}
                        </span>
                      {% endif %}

                      {% for tag in entry.tags.all %}
                        <a href="{% url 'library' %}?tag={{ tag.name }}" class="bg-white text-xs px-2 py-1 rounded-full border border-gray-200 hover:border-indigo-200 hover:bg-indigo-50 transition-colors">
                          #{{ tag.name }}
                        </a>
                      {% endfor %}

                      <div class="w-full sm:w-auto sm:ml-auto mt-2 sm:mt-0">
                        <a href="{% url 'entry_detail' entry.id %}" class="text-indigo-600 text-xs hover:text-indigo-800 flex items-center gap-1 bg-white/50 px-3 py-1 rounded-full shadow-sm hover:bg-white/80 transition-colors w-full sm:w-auto justify-center sm:justify-start">
                          <span>Read more</span>
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                          </svg>
                        </a>
                      </div>
                    </div>
                  </div>
                </div>

                {% if entry.summary %}
                <div class="border-t border-gray-100 bg-gradient-to-r from-indigo-50/50 to-purple-50/50 px-3 sm:px-4 py-2 sm:py-3 mt-3">
                  <div class="flex items-center text-xs sm:text-sm text-indigo-700 mb-1">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                    </svg>
                    <span class="font-medium">AI Insight</span>
                  </div>
                  <p class="text-xs text-gray-600 handwritten">{{ entry.summary|truncatechars:100 }}</p>
                </div>
                {% endif %}
              </div>
            </div>
          </div>
        {% empty %}
          <div class="empty-state card-base">
            <div class="empty-icon mx-auto">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
              </svg>
            </div>
            <h3 class="text-lg sm:text-xl font-bold text-gray-800 mb-2">Your Timeline Is Empty</h3>
            <p class="text-sm text-gray-600 mb-4 sm:mb-6 max-w-md mx-auto">Start journaling to build your personal timeline of memories.</p>
            <a href="{% url 'new_entry' %}" class="btn-primary">
              Create Your First Entry
            </a>
          </div>
        {% endfor %}

        {% if entries|length > 10 %}
        <!-- Load More Button -->
        <div class="text-center mt-6 mb-4">
          <button id="loadMoreTimeline" class="px-4 py-2 bg-white rounded-xl shadow border border-gray-200 text-gray-700 font-medium hover:bg-gray-50 transition-colors flex items-center mx-auto">
            <span>Load More Entries</span>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- Calendar Tab -->
    <div id="calendar-tab" class="tab-content hidden animate-fade-in">
      <div class="card-base p-3 sm:p-5 mb-4 sm:mb-6">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-3 sm:mb-4">
          <h3 class="text-lg sm:text-xl font-bold text-gray-800 diary-font">{{ current_month|default:"April" }} {{ current_year|default:"2025" }}</h3>
          <div class="flex items-center gap-2 mt-2 sm:mt-0">
            <button class="p-1.5 sm:p-2 rounded-lg bg-white/70 hover:bg-indigo-50 transition-colors border border-gray-200 shadow-sm">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
              </svg>
            </button>
            <button class="px-2 sm:px-3 py-1 sm:py-1.5 rounded-lg bg-white/70 hover:bg-gray-50 transition-colors border border-gray-200 shadow-sm text-xs sm:text-sm font-medium text-gray-700">
              Today
            </button>
            <button class="p-1.5 sm:p-2 rounded-lg bg-white/70 hover:bg-indigo-50 transition-colors border border-gray-200 shadow-sm">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
            </button>
          </div>
        </div>

        <!-- Calendar header -->
        <div class="grid grid-cols-7 gap-0.5 mb-1 sm:mb-2 text-center">
          <div class="text-xs font-medium text-gray-500 py-1">S</div>
          <div class="text-xs font-medium text-gray-500 py-1">M</div>
          <div class="text-xs font-medium text-gray-500 py-1">T</div>
          <div class="text-xs font-medium text-gray-500 py-1">W</div>
          <div class="text-xs font-medium text-gray-500 py-1">T</div>
          <div class="text-xs font-medium text-gray-500 py-1">F</div>
          <div class="text-xs font-medium text-gray-500 py-1">S</div>
        </div>

        <!-- Calendar grid - Simplified example -->
        <div class="calendar-view">
          {% for day in calendar_days|default:"1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30"|make_list %}
            <div class="calendar-day {% if day in entries_dates %}has-entry{% endif %} {% if day|divisibleby:7 %}weekend{% endif %}">
              <span class="calendar-day-number">{{ day }}</span>
              {% if day in entries_dates %}
                <div class="calendar-day-indicator"></div>
              {% endif %}
            </div>
          {% endfor %}
        </div>
      </div>

      <!-- Entries for selected day -->
      <div class="section-header">
        <div class="section-icon bg-gradient-to-br from-blue-500 to-indigo-600">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
          </svg>
        </div>
        <h3 class="section-title diary-font">Entries for Selected Day</h3>
      </div>

      <!-- Entries for the day -->
      <div class="space-y-3 sm:space-y-4">
        {% for entry in selected_day_entries|default:entries|slice:":2" %}
        <div class="card-base p-3 sm:p-4 animate-scale-in">
          <div class="flex justify-between items-start mb-2">
            <h4 class="font-bold text-gray-800 text-base sm:text-lg">{{ entry.title|default:"Untitled Entry" }}</h4>
            {% if entry.mood %}
            <div class="mood-pill {{ entry.mood }}">
              <span>
                {% if entry.mood == 'happy' %}😊 Happy
                {% elif entry.mood == 'content' %}😌 Content
                {% elif entry.mood == 'excited' %}🤩 Excited
                {% elif entry.mood == 'neutral' %}😐 Neutral
                {% elif entry.mood == 'anxious' %}😰 Anxious
                {% elif entry.mood == 'sad' %}😢 Sad
                {% else %}✨ {{ entry.mood|title }}
                {% endif %}
              </span>
            </div>
            {% endif %}
          </div>
          <p class="text-gray-700 handwritten text-xs sm:text-sm mb-2">{{ entry.content|truncatechars:200 }}</p>
          <div class="flex justify-end">
            <a href="{% url 'entry_detail' entry.id %}" class="text-indigo-600 text-xs sm:text-sm hover:text-indigo-800 flex items-center gap-1 bg-white/50 px-3 py-1 rounded-full shadow-sm hover:bg-white/80 transition-colors">
              <span>Read full entry</span>
              <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
              </svg>
            </a>
          </div>
        </div>
        {% empty %}
        <div class="empty-state card-base">
          <p class="text-gray-500 text-sm">No entries for this day. Click on a day with entries to view them.</p>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- Mobile Bottom Navigation -->
  <div class="mobile-bottom-nav hidden">
    <button onclick="switchTab('memories')" class="mobile-nav-item active">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mobile-nav-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
      </svg>
      <span class="mobile-nav-label">Memories</span>
    </button>
    <button onclick="switchTab('journals')" class="mobile-nav-item">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mobile-nav-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
      </svg>
      <span class="mobile-nav-label">Journals</span>
    </button>
    <button onclick="switchTab('timeline')" class="mobile-nav-item">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mobile-nav-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
      </svg>
      <span class="mobile-nav-label">Timeline</span>
    </button>
    <button onclick="switchTab('calendar')" class="mobile-nav-item">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mobile-nav-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
      </svg>
      <span class="mobile-nav-label">Calendar</span>
    </button>
  </div>

  <!-- Floating Action Button -->
  <a href="{% url 'new_entry' %}" class="floating-action-button">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
    </svg>
  </a>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Enable smooth scrolling
  document.documentElement.style.scrollBehavior = 'smooth';

  // Initialize all features
  initTabs();
  initLoadMore();
  initMemoryGrid();
  initSearch();
  initMobileFeatures();
  initKeyboardNavigation();
  initAnimations();
  preloadImages();
});

// Tab switching functionality
function switchTab(tabName) {
  // Hide all tabs
  const allTabs = ['memories', 'journals', 'timeline', 'calendar'];
  allTabs.forEach(tab => {
    const tabElement = document.getElementById(tab + '-tab');
    if (tabElement) {
      tabElement.classList.add('hidden');
    }
  });

  // Show selected tab
  const selectedTab = document.getElementById(tabName + '-tab');
  if (selectedTab) {
    selectedTab.classList.remove('hidden');
  }

  // Update active state on buttons
  const buttons = document.querySelectorAll('.modern-tab');
  buttons.forEach(btn => {
    btn.classList.remove('active');
    if (btn.getAttribute('onclick') && btn.getAttribute('onclick').includes(tabName)) {
      btn.classList.add('active');
    }
  });

  // Update mobile navigation
  const mobileNavItems = document.querySelectorAll('.mobile-nav-item');
  mobileNavItems.forEach(item => {
    item.classList.remove('active');
    if (item.getAttribute('onclick') && item.getAttribute('onclick').includes(tabName)) {
      item.classList.add('active');
    }
  });

  // Animate tab selector
  const activeTab = document.querySelector(`.modern-tab[onclick*="${tabName}"]`);
  const tabSelector = document.getElementById('tabSelector');

  if (activeTab && tabSelector) {
    const width = activeTab.getAttribute('data-tab-width');
    const offset = activeTab.getAttribute('data-tab-offset');

    if (width && offset) {
      tabSelector.style.width = width;
      tabSelector.style.transform = `translateX(${offset})`;
    }
  }

  // Update URL without page reload
  const url = new URL(window.location);
  url.searchParams.set('tab', tabName);
  window.history.pushState({}, '', url);

  // Save to localStorage
  localStorage.setItem('selectedTab', tabName);
}

// Initialize tabs
function initTabs() {
  const urlParams = new URLSearchParams(window.location.search);
  const tabParam = urlParams.get('tab');
  const savedTab = localStorage.getItem('selectedTab');

  if (tabParam && ['memories', 'journals', 'timeline', 'calendar'].includes(tabParam)) {
    switchTab(tabParam);
  } else if (savedTab) {
    switchTab(savedTab);
  } else {
    switchTab('memories');
  }
}

// Load more functionality
function initLoadMore() {
  const loadMoreButtons = [
    document.getElementById('loadMoreMemories'),
    document.getElementById('loadMoreTimeline')
  ];

  loadMoreButtons.forEach(btn => {
    if (btn) {
      btn.addEventListener('click', function() {
        const originalText = this.innerHTML;
        this.innerHTML = `
          <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-gray-700 inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          Loading...
        `;

        // Simulate loading more entries
        setTimeout(() => {
          this.innerHTML = originalText;
          this.style.display = 'none';
          showToast('All entries loaded');
        }, 1000);
      });
    }
  });
}

// Memory grid interactions
function initMemoryGrid() {
  const memoryCards = document.querySelectorAll('.memory-card');

  memoryCards.forEach(card => {
    card.addEventListener('mouseenter', function() {
      const img = this.querySelector('.memory-image');
      if (img) {
        img.style.transform = 'scale(1.05)';
      }
    });

    card.addEventListener('mouseleave', function() {
      const img = this.querySelector('.memory-image');
      if (img) {
        img.style.transform = '';
      }
    });
  });
}

// Search functionality
function initSearch() {
  const searchInput = document.getElementById('searchInput');
  if (!searchInput) return;

  let searchTimeout;
  searchInput.addEventListener('input', function(e) {
    clearTimeout(searchTimeout);
    const query = e.target.value.toLowerCase();

    searchTimeout = setTimeout(() => {
      // Filter entries based on search
      const entries = document.querySelectorAll('.memory-card, .timeline-entry, .journal-card');
      
      entries.forEach(entry => {
        const text = entry.textContent.toLowerCase();
        if (text.includes(query) || query === '') {
          entry.style.display = '';
          entry.classList.add('animate-fade-in');
        } else {
          entry.style.display = 'none';
        }
      });

      // Show no results message if needed
      const visibleEntries = document.querySelectorAll('.memory-card:not([style*="display: none"]), .timeline-entry:not([style*="display: none"]), .journal-card:not([style*="display: none"])');
      if (visibleEntries.length === 0 && query !== '') {
        showToast('No entries found matching your search');
      }
    }, 300);
  });

  // Clear search on escape
  searchInput.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      this.value = '';
      this.dispatchEvent(new Event('input'));
    }
  });
}

// Mobile features
function initMobileFeatures() {
  // Show bottom navigation on mobile
  if (window.innerWidth <= 768) {
    document.querySelector('.mobile-bottom-nav').classList.remove('hidden');
  }

  // Touch support for journal previews
  const journalCards = document.querySelectorAll('.journal-card');
  journalCards.forEach(card => {
    card.addEventListener('touchstart', function() {
      journalCards.forEach(c => c.classList.remove('touch-active'));
      this.classList.toggle('touch-active');
    });
  });

  // Handle resize
  window.addEventListener('resize', function() {
    const mobileNav = document.querySelector('.mobile-bottom-nav');
    if (window.innerWidth <= 768) {
      mobileNav.classList.remove('hidden');
    } else {
      mobileNav.classList.add('hidden');
    }
  });
}

// Keyboard navigation
function initKeyboardNavigation() {
  document.addEventListener('keydown', function(e) {
    // Tab navigation with arrow keys
    if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
      const tabs = ['memories', 'journals', 'timeline', 'calendar'];
      const currentTab = tabs.find(tab => !document.getElementById(tab + '-tab').classList.contains('hidden'));
      const currentIndex = tabs.indexOf(currentTab);

      if (e.key === 'ArrowLeft' && currentIndex > 0) {
        switchTab(tabs[currentIndex - 1]);
      } else if (e.key === 'ArrowRight' && currentIndex < tabs.length - 1) {
        switchTab(tabs[currentIndex + 1]);
      }
    }

    // Focus search with Ctrl/Cmd + K
    if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
      e.preventDefault();
      const searchInput = document.getElementById('searchInput');
      if (searchInput) {
        searchInput.focus();
      }
    }

    // New entry with Ctrl/Cmd + N
    if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
      e.preventDefault();
      window.location.href = document.querySelector('.floating-action-button').href;
    }
  });

  // Show focus styles on tab navigation
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Tab') {
      document.body.classList.add('keyboard-navigation');
    }
  });

  document.addEventListener('mousedown', function() {
    document.body.classList.remove('keyboard-navigation');
  });
}

// Initialize animations
function initAnimations() {
  if ('IntersectionObserver' in window) {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
          observer.unobserve(entry.target);
        }
      });
    }, { threshold: 0.1 });

    document.querySelectorAll('.animate-fade-in, .animate-scale-in').forEach(el => {
      observer.observe(el);
    });
  }
}

// Preload images
function preloadImages() {
  const images = document.querySelectorAll('.memory-image, .journal-cover');

  images.forEach(img => {
    if (img.src && !img.complete) {
      img.classList.add('loading-shimmer');
      img.onload = function() {
        img.classList.remove('loading-shimmer');
      };
    }
  });
}

// Toast notification
function showToast(message, type = 'info') {
  const toast = document.createElement('div');
  toast.className = `fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-fade-in text-sm ${type === 'error' ? 'bg-red-600' : ''}`;
  toast.textContent = message;

  document.body.appendChild(toast);

  setTimeout(() => {
    toast.style.opacity = '0';
    toast.style.transform = 'translate(-50%, 10px)';
    toast.style.transition = 'opacity 0.5s ease, transform 0.5s ease';

    setTimeout(() => {
      document.body.removeChild(toast);
    }, 500);
  }, 3000);
}

// Filter chip functionality
document.querySelectorAll('.filter-chip').forEach(chip => {
  if (!chip.classList.contains('active') && chip.tagName.toLowerCase() !== 'a') {
    chip.addEventListener('click', function() {
      const currentActive = this.parentNode.querySelector('.filter-chip.active');
      if (currentActive) {
        currentActive.classList.remove('active');
      }
      this.classList.add('active');
    });
  }
});

// Calendar day selection
document.querySelectorAll('.calendar-day').forEach(day => {
  day.addEventListener('click', function() {
    if (!this.classList.contains('opacity-40')) {
      // Remove previous selection
      document.querySelectorAll('.calendar-day').forEach(d => {
        d.style.backgroundColor = '';
        d.style.borderColor = '';
        const num = d.querySelector('.calendar-day-number');
        if (num) {
          num.classList.remove('font-bold', 'text-indigo-600');
        }
      });

      // Add selection to clicked day
      this.style.backgroundColor = 'rgba(99, 102, 241, 0.15)';
      this.style.borderColor = 'rgba(99, 102, 241, 0.3)';
      const num = this.querySelector('.calendar-day-number');
      if (num) {
        num.classList.add('font-bold', 'text-indigo-600');
      }

      // Load entries for selected day (in real implementation)
      showToast(`Loading entries for day ${num.textContent}`);
    }
  });
});
</script>
{% endblock %}