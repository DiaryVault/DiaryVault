{% extends 'base.html' %}

{% block title %}DiaryVault - Your Journal Collection{% endblock %}

{% block extra_css %}
<style>
  /* Core styling - Aligned with other pages */
  .diary-font {
    font-family: 'Playfair Display', serif;
    letter-spacing: -0.01em;
  }

  .handwritten {
    font-family: 'Caveat', cursive;
    letter-spacing: 0.01em;
    line-height: 1.7;
  }

  /* Glass card styling from base template */
  .glass-card {
    background: rgba(255, 255, 255, 0.85);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    transition: all 0.4s cubic-bezier(0.23, 1, 0.320, 1);
  }

  .glass-card:hover {
    background: rgba(255, 255, 255, 0.95);
    transform: translateY(-4px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
    border-color: rgba(99, 102, 241, 0.2);
  }

  /* Enhanced animations - Consistent with other pages */
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes scaleIn {
    from { opacity: 0; transform: scale(0.95); }
    to { opacity: 1; transform: scale(1); }
  }

  @keyframes floatIn {
    0% { opacity: 0; transform: translateY(10px); }
    100% { opacity: 1; transform: translateY(0); }
  }

  .animate-fade-in {
    animation: fadeIn 0.6s ease forwards;
  }

  .animate-scale-in {
    animation: scaleIn 0.4s ease forwards;
  }

  .animate-float-in {
    animation: floatIn 0.6s ease forwards;
  }

  .animation-delay-100 { animation-delay: 100ms; }
  .animation-delay-200 { animation-delay: 200ms; }
  .animation-delay-300 { animation-delay: 300ms; }
  .animation-delay-400 { animation-delay: 400ms; }
  .animation-delay-500 { animation-delay: 500ms; }

  /* Button styles - Consistent with base template */
  .btn-gradient {
    background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
    transition: all 0.3s cubic-bezier(0.23, 1, 0.320, 1);
    position: relative;
    overflow: hidden;
  }

  .btn-gradient::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s;
  }

  .btn-gradient:hover::before {
    left: 100%;
  }

  .btn-gradient:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px -5px rgba(99, 102, 241, 0.4);
  }

  /* Journal Collection Redesign */
  .journal-collection {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    gap: 1.5rem;
  }

  .journal-card {
    position: relative;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    transform-style: preserve-3d;
    perspective: 1000px;
    overflow: hidden;
  }

  .journal-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
  }

  .journal-cover {
    position: relative;
    height: 280px;
    background-size: cover;
    background-position: center;
    border-radius: 1rem;
    overflow: hidden;
    transition: all 0.3s ease;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.2);
  }

  .journal-info {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 1.25rem;
    background: linear-gradient(to top, rgba(0, 0, 0, 0.7), transparent);
    color: white;
    transform: translateY(0);
    transition: all 0.3s ease;
  }

  .journal-card:hover .journal-info {
    transform: translateY(-5px);
  }

  .journal-title {
    font-size: 1.2rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
  }

  .journal-meta {
    display: flex;
    justify-content: space-between;
    font-size: 0.75rem;
    opacity: 0.9;
  }

  .journal-meta-item {
    display: flex;
    align-items: center;
    gap: 0.375rem;
  }

  /* Journal preview content */
  .journal-preview {
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.85));
    backdrop-filter: blur(4px);
    padding: 1.5rem;
    opacity: 0;
    transform: translateY(10px);
    transition: all 0.3s ease;
    overflow: auto;
    display: flex;
    flex-direction: column;
  }

  .journal-card:hover .journal-preview {
    opacity: 1;
    transform: translateY(0);
  }

  /* Memory card styles - Consistent with dashboard */
  .memory-card {
    background-color: white;
    border-radius: 1rem;
    overflow: hidden;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    cursor: pointer;
  }

  .memory-card:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.2);
  }

  .memory-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .memory-card:hover .memory-image {
    transform: scale(1.1);
  }

  .memory-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.4) 50%, transparent 100%);
    color: white;
    padding: 1.5rem;
    transform: translateY(100%);
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .memory-card:hover .memory-overlay {
    transform: translateY(0);
  }

  /* Modern tabs - Consistent with base template */
  .modern-tabs {
    display: flex;
    border-radius: 0.75rem;
    overflow: hidden;
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(8px);
    padding: 0.375rem;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    position: relative;
    border: 1px solid rgba(255, 255, 255, 0.5);
  }

  .tab-selector {
    position: absolute;
    height: calc(100% - 0.75rem);
    top: 0.375rem;
    left: 0.375rem;
    background: white;
    border-radius: 0.5rem;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.08);
    z-index: 0;
  }

  .modern-tab {
    padding: 0.625rem 1.25rem;
    font-size: 0.875rem;
    font-weight: 500;
    color: #6b7280;
    border-radius: 0.5rem;
    position: relative;
    z-index: 1;
    transition: all 0.3s ease;
    flex: 1;
    text-align: center;
    white-space: nowrap;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    min-height: 44px;
  }

  /* Memory collection - Grid layout from dashboard */
  .memory-grid {
    display: grid;
    grid-template-columns: repeat(12, 1fr);
    grid-auto-rows: minmax(180px, auto);
    gap: 1rem;
  }

  .memory-card.featured {
    grid-column: span 8;
    grid-row: span 2;
  }

  .memory-card.normal {
    grid-column: span 4;
    grid-row: span 1;
  }

  .memory-card.tall {
    grid-column: span 4;
    grid-row: span 2;
  }

  .memory-card.wide {
    grid-column: span 8;
    grid-row: span 1;
  }

  /* Enhanced filters - Consistent with insights page */
  .filters-container {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    padding: 0.75rem;
    background: rgba(255, 255, 255, 0.6);
    backdrop-filter: blur(8px);
    border-radius: 0.75rem;
    border: 1px solid rgba(255, 255, 255, 0.8);
    overflow-x: auto;
  }

  .filter-chip {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.375rem 0.75rem;
    background-color: white;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 500;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    border: 1px solid #e5e7eb;
    color: #4b5563;
    transition: all 0.2s ease;
    cursor: pointer;
    white-space: nowrap;
    min-height: 36px;
    display: flex;
    align-items: center;
  }

  .filter-chip:hover {
    background-color: #f9fafb;
    border-color: #d1d5db;
    transform: translateY(-1px);
  }

  .filter-chip.active {
    background-color: #4f46e5;
    border-color: #4338ca;
    color: white;
  }

  /* Mood indicators - Consistent with dashboard */
  .mood-pill {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    border-radius: 9999px;
    padding: 0.375rem 0.75rem;
    font-size: 0.75rem;
    font-weight: 500;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    transition: all 0.2s ease;
  }

  .mood-pill.happy {
    background-color: #ecfdf5;
    color: #059669;
    border: 1px solid rgba(5, 150, 105, 0.2);
  }

  .mood-pill.content {
    background-color: #eff6ff;
    color: #3b82f6;
    border: 1px solid rgba(59, 130, 246, 0.2);
  }

  .mood-pill.excited {
    background-color: #f5f3ff;
    color: #8b5cf6;
    border: 1px solid rgba(139, 92, 246, 0.2);
  }

  .mood-pill.neutral {
    background-color: #f3f4f6;
    color: #6b7280;
    border: 1px solid rgba(107, 114, 128, 0.2);
  }

  .mood-pill.anxious {
    background-color: #fffbeb;
    color: #d97706;
    border: 1px solid rgba(217, 119, 6, 0.2);
  }

  .mood-pill.sad {
    background-color: #fee2e2;
    color: #dc2626;
    border: 1px solid rgba(220, 38, 38, 0.2);
  }

  /* Timeline view - Enhanced with glass morphism */
  .timeline-container {
    position: relative;
    padding-left: 2rem;
  }

  .timeline-line {
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 2px;
    background: linear-gradient(to bottom, #6366f1 0%, #8b5cf6 100%);
    opacity: 0.5;
  }

  .timeline-entry {
    position: relative;
    margin-bottom: 2rem;
    opacity: 0;
    animation: fadeIn 0.5s ease-out forwards;
  }

  .timeline-entry::before {
    content: '';
    position: absolute;
    left: -2rem;
    top: 0;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
    border: 2px solid white;
    z-index: 1;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }

  /* Calendar view - Enhanced */
  .calendar-view {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 0.5rem;
  }

  .calendar-day {
    aspect-ratio: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 0.5rem;
    border-radius: 0.5rem;
    transition: all 0.2s ease;
    border: 1px solid transparent;
    min-height: 44px;
  }

  .calendar-day.has-entry {
    background-color: rgba(99, 102, 241, 0.1);
    border-color: rgba(99, 102, 241, 0.2);
    color: #4f46e5;
    font-weight: 500;
  }

  .calendar-day:hover {
    transform: scale(1.05);
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    z-index: 1;
  }

  /* Section containers - Consistent glass styling */
  .section-container {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 1.5rem;
    padding: 1.5rem;
    border: 1px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    margin-bottom: 1.5rem;
  }

  /* Loading states - Consistent with dashboard */
  .loading-shimmer {
    background: linear-gradient(to right, #f6f7f8 8%, #edeef1 18%, #f6f7f8 33%);
    background-size: 1000px 100%;
    animation: shimmer 2s infinite linear;
  }

  @keyframes shimmer {
    0% { background-position: -1000px 0; }
    100% { background-position: 1000px 0; }
  }

  /* Empty states - Consistent styling */
  .empty-state {
    text-align: center;
    padding: 3rem 2rem;
    background: rgba(255, 255, 255, 0.6);
    border-radius: 20px;
    border: 2px dashed rgba(156, 163, 175, 0.3);
  }

  .empty-state-icon {
    width: 5rem;
    height: 5rem;
    margin: 0 auto 1.5rem;
    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
    border-radius: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 15px rgba(99, 102, 241, 0.2);
  }

  .empty-state-icon svg {
    width: 2.5rem;
    height: 2.5rem;
    color: white;
  }

  /* MOBILE OPTIMIZATIONS - Enhanced from original */
  @media (max-width: 768px) {
    /* Touch-friendly buttons and interactive elements */
    .filter-chip,
    .mood-pill,
    .calendar-day,
    .modern-tab {
      min-height: 44px;
    }

    /* Journal card optimizations */
    .journal-card {
      touch-action: manipulation;
    }

    /* Better header layout */
    .header-container {
      flex-direction: column;
      gap: 0.75rem;
    }

    /* Memory grid becomes a column */
    .memory-grid {
      display: flex;
      flex-direction: column;
    }

    .memory-card {
      min-height: 200px;
      margin-bottom: 1rem;
    }

    .memory-card.featured,
    .memory-card.normal,
    .memory-card.tall,
    .memory-card.wide {
      grid-column: 1 / -1;
      grid-row: auto;
    }

    /* Timeline optimizations */
    .timeline-container {
      padding-left: 1.5rem;
    }

    /* Journal collection mobile layout */
    .journal-collection {
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 1rem;
    }

    .journal-cover {
      height: 220px;
    }
  }

  /* Very small devices */
  @media (max-width: 480px) {
    .modern-tab {
      padding: 0.375rem;
      font-size: 0.675rem;
    }

    .modern-tab svg {
      height: 0.875rem;
      width: 0.875rem;
    }

    /* Stats grid optimization */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.5rem;
    }

    /* Calendar optimizations */
    .calendar-day {
      padding: 0.25rem;
    }

    .calendar-day-number {
      font-size: 0.675rem;
    }
  }

  /* Bottom navigation for mobile */
  @media (max-width: 768px) {
    .mobile-bottom-nav {
      display: flex;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-top: 1px solid rgba(229, 231, 235, 0.8);
      z-index: 50;
      padding: 0.5rem 0.25rem;
      justify-content: space-around;
      box-shadow: 0 -4px 32px rgba(0, 0, 0, 0.08);
    }

    .mobile-nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 0.5rem;
      border-radius: 0.5rem;
      min-width: 4rem;
      min-height: 56px;
      justify-content: center;
    }

    .mobile-nav-item.active {
      background-color: rgba(99, 102, 241, 0.1);
      color: #4f46e5;
    }

    /* FIXED: Remove page-content padding-bottom that causes overflow */
    /* The main-content-wrapper in base.html already handles scrolling */
  }

  /* Floating action button */
  .floating-action-button {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    width: 56px;
    height: 56px;
    background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 8px 32px rgba(99, 102, 241, 0.3);
    transition: all 0.3s cubic-bezier(0.23, 1, 0.320, 1);
    z-index: 40;
  }

  .floating-action-button:hover {
    transform: scale(1.05);
    box-shadow: 0 12px 40px rgba(99, 102, 241, 0.4);
  }

  @media (max-width: 768px) {
    .floating-action-button {
      bottom: 5rem;
    }
  }

  /* Blob animations from base template */
  @keyframes blob {
    0% { transform: translate(0px, 0px) scale(1); }
    33% { transform: translate(20px, -20px) scale(1.1); }
    66% { transform: translate(-10px, 10px) scale(0.9); }
    100% { transform: translate(0px, 0px) scale(1); }
  }

  .blob {
    position: absolute;
    filter: blur(40px);
    opacity: 0.7;
    animation: blob 7s infinite;
    pointer-events: none;
  }

  .blob-1 { background: #6366f1; top: 0; left: 0; width: 200px; height: 200px; }
  .blob-2 { background: #8b5cf6; bottom: 0; right: 0; width: 250px; height: 250px; animation-delay: 2s; }
  .blob-3 { background: #ec4899; top: 50%; left: 50%; width: 150px; height: 150px; animation-delay: 4s; }

  /* Custom journal pattern classes */
  .pattern-dots {
    background-image: radial-gradient(#6366f1 0.5px, transparent 0.5px);
    background-size: 10px 10px;
  }

  .pattern-lines {
    background-image: linear-gradient(rgba(99, 102, 241, 0.2) 1px, transparent 1px);
    background-size: 100% 15px;
  }

  .pattern-grid {
    background: linear-gradient(rgba(99, 102, 241, 0.1) 1px, transparent 1px),
                linear-gradient(to right, rgba(99, 102, 241, 0.1) 1px, transparent 1px);
    background-size: 20px 20px;
  }

  .journal-color-blue { background-color: #3b82f6; }
  .journal-color-purple { background-color: #8b5cf6; }
  .journal-color-pink { background-color: #ec4899; }
  .journal-color-green { background-color: #10b981; }
  .journal-color-yellow { background-color: #f59e0b; }
  .journal-color-red { background-color: #ef4444; }
  .journal-color-gray { background-color: #6b7280; }
</style>
{% endblock %}

{% block content %}
<!-- FIXED: Removed max-w-7xl and custom padding/margin that interferes with base layout -->
<div class="w-full">
  <!-- Breadcrumb Navigation -->
  <nav class="mb-4 animate-fade-in" aria-label="Breadcrumb">
    <ol class="flex items-center space-x-2 text-sm">
      <li>
        <a href="{% url 'dashboard' %}" class="text-gray-500 hover:text-indigo-600 transition-colors flex items-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
          </svg>
          Dashboard
        </a>
      </li>
      <li>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </li>
      <li>
        <span class="text-gray-700 font-medium">Library</span>
      </li>
    </ol>
  </nav>

  <!-- Decorative blobs -->
  <div class="hidden sm:block absolute -top-10 -left-16 h-48 w-48 bg-secondary-300 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-blob"></div>
  <div class="hidden sm:block absolute -bottom-32 -right-16 h-48 w-48 bg-primary-300 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-blob animation-delay-200"></div>
  <div class="absolute top-1/3 left-1/3 h-32 w-32 bg-amber-300 rounded-full mix-blend-multiply filter blur-xl opacity-10 animate-blob animation-delay-400"></div>

  <!-- Page Header - Consistent with dashboard -->
  <div class="glass-card rounded-2xl p-3 sm:p-6 mb-4 sm:mb-8 animate-fade-in">
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-3 sm:gap-5 header-container">
      <div>
        <h1 class="text-2xl sm:text-3xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent mb-2 diary-font">
          Your Memory Collection
        </h1>
        <p class="text-sm text-gray-600 max-w-2xl">
          Explore your personal collection of thoughts, memories, and reflections.
          {% if entries|length > 0 %}You have <span class="font-medium text-indigo-600">{{ entries|length }}</span> entries so far.{% endif %}
        </p>

        <!-- Quick Navigation Pills -->
        <div class="flex flex-wrap gap-2 mt-3">
          <a href="{% url 'dashboard' %}" class="inline-flex items-center px-3 py-1 bg-white/70 hover:bg-white border border-gray-200 rounded-full text-xs font-medium text-gray-600 hover:text-indigo-600 transition-all">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
            </svg>
            Dashboard
          </a>
          <a href="{% url 'insights' %}" class="inline-flex items-center px-3 py-1 bg-white/70 hover:bg-white border border-gray-200 rounded-full text-xs font-medium text-gray-600 hover:text-indigo-600 transition-all">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
            </svg>
            Insights
          </a>
        </div>

        <!-- Active filter badge -->
        {% if active_filter %}
        <div class="inline-flex items-center px-3 py-1 mt-3 bg-indigo-50 text-indigo-700 rounded-full text-sm font-medium border border-indigo-200">
          <span>
            {% if active_tab == 'tags' %}Tag:{% elif active_tab == 'moods' %}Mood:{% else %}Period:{% endif %}
            {{ active_filter }}
          </span>
          <a href="{% url 'library' %}" class="ml-2 flex items-center text-gray-500 hover:text-red-500 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </a>
        </div>
        {% endif %}
      </div>

      <!-- Search and new entry - Consistent with dashboard -->
      <div class="flex flex-col sm:flex-row items-center gap-3 w-full md:w-auto">
        <div class="search-container flex-grow w-full md:w-72 relative">
          <input type="text" placeholder="Search your memories..." 
                 class="search-input w-full pl-10 pr-4 py-2.5 rounded-xl bg-white/80 backdrop-filter backdrop-blur-sm border border-white/50 focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 text-gray-700 transition-all" />
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 absolute left-3 top-1/2 transform -translate-y-1/2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
        </div>

        <a href="{% url 'new_entry' %}" class="btn-gradient inline-flex items-center px-5 py-2.5 rounded-xl text-white font-medium shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all w-full sm:w-auto justify-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
          </svg>
          New Entry
        </a>
      </div>
    </div>
  </div>

  <!-- Quick Stats Cards - Consistent with dashboard -->
  <div class="grid grid-cols-2 sm:grid-cols-4 gap-2 sm:gap-4 mb-4 sm:mb-8 stats-grid">
    <div class="glass-card rounded-xl p-3 sm:p-4 flex items-center animate-scale-in animation-delay-100">
      <div class="bg-gradient-to-br from-indigo-500 to-indigo-600 p-2 sm:p-3 rounded-lg mr-2 sm:mr-4">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14-10v2m-14 4h14m-14 4h14m-14 4h14" />
        </svg>
      </div>
      <div>
        <div class="text-xl sm:text-2xl font-bold text-gray-800">{{ entries|length }}</div>
        <div class="text-xs text-gray-500">Total Entries</div>
      </div>
    </div>

    <div class="glass-card rounded-xl p-3 sm:p-4 flex items-center animate-scale-in animation-delay-200">
      <div class="bg-gradient-to-br from-purple-500 to-purple-600 p-2 sm:p-3 rounded-lg mr-2 sm:mr-4">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
      </div>
      <div>
        <div class="text-xl sm:text-2xl font-bold text-gray-800">{{ time_periods|length }}</div>
        <div class="text-xs text-gray-500">Time Periods</div>
      </div>
    </div>

    <div class="glass-card rounded-xl p-3 sm:p-4 flex items-center animate-scale-in animation-delay-300">
      <div class="bg-gradient-to-br from-pink-500 to-pink-600 p-2 sm:p-3 rounded-lg mr-2 sm:mr-4">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
        </svg>
      </div>
      <div>
        <div class="text-xl sm:text-2xl font-bold text-gray-800">{{ tags|length }}</div>
        <div class="text-xs text-gray-500">Unique Tags</div>
      </div>
    </div>

    <div class="glass-card rounded-xl p-3 sm:p-4 flex items-center animate-scale-in animation-delay-400">
      <div class="bg-gradient-to-br from-green-500 to-green-600 p-2 sm:p-3 rounded-lg mr-2 sm:mr-4">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
      </div>
      <div>
        <div class="text-xl sm:text-2xl font-bold text-gray-800">{{ moods|length }}</div>
        <div class="text-xs text-gray-500">Mood States</div>
      </div>
    </div>
  </div>

  <!-- Modern Tabs -->
  <div class="relative mb-6 animate-fade-in animation-delay-500">
    <div class="modern-tabs">
      <div id="tabSelector" class="tab-selector" style="width: 25%;"></div>
      <button onclick="switchTab('memories')" class="modern-tab active" data-tab-width="25%" data-tab-offset="0%">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
        <span>Memories</span>
      </button>
      <button onclick="switchTab('journals')" class="modern-tab" data-tab-width="25%" data-tab-offset="25%">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
        </svg>
        <span>Journals</span>
      </button>
      <button onclick="switchTab('timeline')" class="modern-tab" data-tab-width="25%" data-tab-offset="50%">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14-10v2m-2 4h10m-10 4h10m-10 4h10" />
        </svg>
        <span>Timeline</span>
      </button>
      <button onclick="switchTab('calendar')" class="modern-tab" data-tab-width="25%" data-tab-offset="75%">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
        <span>Calendar</span>
      </button>
    </div>
  </div>

  <!-- Tab Contents -->
  <div id="tabContents">
    <!-- Memories Tab -->
    <div id="memories-tab" class="tab-content animate-fade-in">
      <!-- Filters -->
      <div class="filters-container mb-4">
        <div class="filter-chip active">
          <span>All Memories</span>
        </div>
        <div class="filter-chip">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
          </svg>
          <span>Has Photos</span>
        </div>
        <div class="filter-chip">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
          </svg>
          <span>With AI Insights</span>
        </div>
        <div class="filter-chip">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
          </svg>
          <span>Favorites</span>
        </div>
        <div class="filter-chip">
          <span>Last 30 Days</span>
        </div>
      </div>

      {% if entries|length > 0 %}
      <!-- Memory Collection -->
      <div class="memory-grid mb-6 sm:mb-10">
        {% for entry in entries|slice:":10" %}
          <div class="memory-card {% cycle 'featured' 'normal' 'tall' 'wide' 'normal' 'normal' 'wide' 'normal' 'tall' 'featured' %} animate-scale-in" style="animation-delay: {{ forloop.counter0|add:1 }}00ms;">
            <a href="{% url 'entry_detail' entry.id %}">
              {% if entry.photos.first %}
                <img src="{{ entry.photos.first.photo.url }}" alt="Entry photo" class="memory-image" />
              {% elif entry.photo.url|default:'' %}
                <img src="{{ entry.photo.url }}" alt="Entry photo" class="memory-image" />
              {% else %}
                <div class="memory-image bg-gradient-to-br {{ forloop.counter0|divisibleby:6|yesno:'from-indigo-400 to-purple-500,from-pink-400 to-rose-500,from-cyan-400 to-blue-500,from-green-400 to-emerald-500,from-amber-400 to-orange-500,from-red-400 to-rose-500' }} p-4 flex items-center justify-center">
                  <div class="handwritten text-white text-center opacity-80 font-medium text-sm">
                    {{ entry.content|truncatechars:150 }}
                  </div>
                </div>
              {% endif %}
              <div class="memory-overlay">
                <h3 class="font-bold text-base sm:text-lg text-white mb-1">{{ entry.title|default:"Untitled Memory" }}</h3>
                <div class="flex justify-between items-center">
                  <div class="text-xs text-white/80">{{ entry.created_at|date:"F j, Y" }}</div>
                  {% if entry.mood %}
                  <div class="text-xs py-1 px-2 rounded-full bg-white/20 text-white">
                    {% if entry.mood == 'happy' %}üòä
                    {% elif entry.mood == 'content' %}üòå
                    {% elif entry.mood == 'excited' %}ü§©
                    {% elif entry.mood == 'neutral' %}üòê
                    {% elif entry.mood == 'anxious' %}üò∞
                    {% elif entry.mood == 'sad' %}üò¢
                    {% else %}‚ú®
                    {% endif %}
                    {{ entry.mood|title }}
                  </div>
                  {% endif %}
                </div>
              </div>
            </a>
          </div>
        {% endfor %}
      </div>
      {% else %}
      <!-- Empty state -->
      <div class="empty-state">
        <div class="empty-state-icon">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
          </svg>
        </div>
        <h3 class="text-lg sm:text-xl font-bold text-gray-800 mb-2">Start Your Memory Collection</h3>
        <p class="text-sm text-gray-600 mb-4 sm:mb-6 max-w-md mx-auto">Begin capturing your thoughts, experiences, and reflections with your first journal entry.</p>
        <a href="{% url 'new_entry' %}" class="btn-gradient inline-flex items-center px-4 py-2 rounded-xl text-white font-medium shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all">
          Create Your First Memory
        </a>
      </div>
      {% endif %}

      {% if entries|length > 10 %}
      <!-- Load More Button -->
      <div class="text-center mb-6">
        <button id="loadMoreMemories" class="px-4 py-2.5 bg-white rounded-xl shadow border border-gray-200 text-gray-700 font-medium hover:bg-gray-50 transition-colors flex items-center mx-auto">
          <span>Load More Memories</span>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </button>
      </div>
      {% endif %}
    </div>

    <!-- Journals Tab -->
    <div id="journals-tab" class="tab-content hidden animate-fade-in">
      <!-- Journal collection -->
      <div class="journal-collection">
        {% for period in time_periods %}
          <div class="journal-card animate-scale-in" style="animation-delay: {{ forloop.counter0|add:1 }}00ms;">
            <div class="journal-cover journal-color-{{ forloop.counter0|divisibleby:7|yesno:'blue,purple,pink,green,yellow,red,gray' }} {{ forloop.counter0|divisibleby:3|yesno:'pattern-dots,pattern-lines,pattern-grid,' }}">
              <div class="journal-info">
                <h3 class="journal-title">{{ period.period }}</h3>
                <div class="journal-meta">
                  <div class="journal-meta-item">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    <span>
                      {% if 'Q1' in period.period %}Jan - Mar{% endif %}
                      {% if 'Q2' in period.period %}Apr - Jun{% endif %}
                      {% if 'Q3' in period.period %}Jul - Sep{% endif %}
                      {% if 'Q4' in period.period %}Oct - Dec{% endif %}
                    </span>
                  </div>
                  <div class="journal-meta-item">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14-10v2m-2 4h10m-10 4h10m-10 4h10" />
                    </svg>
                    <span>{{ period.count }} entries</span>
                  </div>
                </div>
              </div>
              <div class="journal-preview">
                <h4 class="text-base sm:text-lg font-bold text-gray-800 mb-3 dairy-font border-b border-gray-200 pb-2">{{ period.period }}</h4>
                <div class="preview-content handwritten">
                  {% if period.first_entry %}
                    {{ period.first_entry.content|truncatechars:300 }}
                  {% else %}
                    This journal is empty. Start adding entries to capture your memories from this time period.
                  {% endif %}
                </div>
                <div class="preview-actions mt-3 pt-2 border-t border-gray-100">
                  <span class="text-xs text-gray-500">{{ period.count }} entries total</span>
                  <a href="{% url 'time_period' period.period %}" class="inline-flex items-center text-sm text-indigo-600 hover:text-indigo-700">
                    <span>Open Journal</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                    </svg>
                  </a>
                </div>
              </div>
            </div>
          </div>
        {% empty %}
          <div class="col-span-full empty-state">
            <div class="empty-state-icon">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
              </svg>
            </div>
            <h3 class="text-lg sm:text-xl font-bold text-gray-800 mb-2">Your Journal Collection Is Empty</h3>
            <p class="text-sm text-gray-600 mb-4 sm:mb-6 max-w-md mx-auto">Start writing entries to automatically create journals organized by time periods.</p>
            <a href="{% url 'new_entry' %}" class="btn-gradient inline-flex items-center px-4 py-2 rounded-xl text-white font-medium shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all">
              Create Your First Entry
            </a>
          </div>
        {% endfor %}
      </div>

      <!-- Browse by Tags Section -->
      <div class="section-container mt-8">
        <h3 class="text-base sm:text-lg font-bold text-gray-800 mb-4 diary-font flex items-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 mr-2 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
          </svg>
          Browse by Tags
        </h3>

        <div class="filters-container">
          <div class="filter-chip active">
            <span>All Tags</span>
          </div>
          {% for tag in tags %}
            <a href="{% url 'library' %}?tag={{ tag.name }}" class="filter-chip {% if tag.active %}active{% endif %}">
              <span>{{ tag.name }}</span>
              <span class="ml-1 px-1.5 py-0.5 rounded-full bg-white/80 text-xs text-gray-600">{{ tag.count }}</span>
            </a>
          {% empty %}
            <span class="text-sm text-gray-500 px-2">No tags found</span>
          {% endfor %}
        </div>
      </div>

      <!-- Browse by Moods Section -->
      <div class="section-container mt-6">
        <h3 class="text-base sm:text-lg font-bold text-gray-800 mb-4 diary-font flex items-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 mr-2 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          Browse by Moods
        </h3>

        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-2 sm:gap-3">
          {% for mood in moods %}
            <a href="{% url 'library' %}?mood={{ mood.name }}" class="glass-card rounded-xl p-3 text-center group {% if mood.active %}ring-2 ring-indigo-400{% endif %} animate-scale-in" style="animation-delay: {{ forloop.counter0 }}00ms;">
              <div class="text-2xl sm:text-3xl mb-1">{{ mood.emoji }}</div>
              <div class="font-medium text-gray-800 mb-1 text-xs sm:text-sm group-hover:text-indigo-600 capitalize">{{ mood.name }}</div>
              <div class="text-xs text-gray-500">{{ mood.count }} entries</div>
            </a>
          {% empty %}
            <div class="col-span-full empty-state">
              <p class="text-gray-600 text-sm">No mood data available yet</p>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- Timeline Tab -->
    <div id="timeline-tab" class="tab-content hidden animate-fade-in">
      <div class="timeline-container">
        <div class="timeline-line"></div>

        {% for entry in entries %}
          <div class="timeline-entry" style="animation-delay: {{ forloop.counter0 }}00ms;">
            <div class="glass-card rounded-xl overflow-hidden {% if entry.mood %}border-l-4 border-{% if entry.mood == 'happy' %}green-400{% elif entry.mood == 'content' %}blue-400{% elif entry.mood == 'excited' %}purple-400{% elif entry.mood == 'anxious' %}amber-400{% elif entry.mood == 'sad' %}red-400{% else %}gray-400{% endif %}{% endif %}">
              <div class="p-3 sm:p-4">
                <div class="flex flex-col sm:flex-row sm:justify-between sm:items-start mb-2 sm:mb-3">
                  <h3 class="font-bold diary-font text-gray-800 text-base mb-1 sm:mb-0">{{ entry.title|default:"Untitled Entry" }}</h3>
                  <div class="text-xs text-gray-500 flex items-center gap-1 sm:gap-2 bg-white/50 px-2 py-1 rounded-full self-start">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    {{ entry.created_at|date:"F j, Y" }}
                  </div>
                </div>

                <div class="flex flex-col sm:flex-row sm:items-start gap-2 sm:gap-4">
                  {% if entry.photos.first %}
                    <div class="w-full sm:w-24 h-24 shrink-0 rounded-lg overflow-hidden shadow-sm">
                      <img src="{{ entry.photos.first.photo.url }}" alt="Entry photo" class="w-full h-full object-cover" />
                    </div>
                  {% elif entry.photo.url|default:'' %}
                    <div class="w-full sm:w-24 h-24 shrink-0 rounded-lg overflow-hidden shadow-sm">
                      <img src="{{ entry.photo.url }}" alt="Entry photo" class="w-full h-full object-cover" />
                    </div>
                  {% endif %}

                  <div class="flex-grow">
                    <p class="text-gray-700 handwritten text-xs sm:text-sm mb-3">{{ entry.content|truncatechars:150 }}</p>

                    <div class="flex flex-wrap gap-2 items-center">
                      {% if entry.mood %}
                        <span class="mood-pill {{ entry.mood }}">
                          {% if entry.mood == 'happy' %}üòä
                          {% elif entry.mood == 'content' %}üòå
                          {% elif entry.mood == 'excited' %}ü§©
                          {% elif entry.mood == 'neutral' %}üòê
                          {% elif entry.mood == 'anxious' %}üò∞
                          {% elif entry.mood == 'sad' %}üò¢
                          {% else %}üòê
                          {% endif %}
                          {{ entry.mood|title }}
                        </span>
                      {% endif %}

                      {% for tag in entry.tags.all %}
                        <a href="{% url 'library' %}?tag={{ tag.name }}" class="bg-white text-xs px-2 py-1 rounded-full border border-gray-200 hover:border-indigo-200 hover:bg-indigo-50 transition-colors">
                          #{{ tag.name }}
                        </a>
                      {% endfor %}

                      <div class="w-full sm:w-auto sm:ml-auto mt-2 sm:mt-0">
                        <a href="{% url 'entry_detail' entry.id %}" class="text-indigo-600 text-xs hover:text-indigo-800 flex items-center gap-1 bg-white/50 px-3 py-1 rounded-full shadow-sm hover:bg-white/80 transition-colors w-full sm:w-auto justify-center sm:justify-start">
                          <span>Read more</span>
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                          </svg>
                        </a>
                      </div>
                    </div>
                  </div>
                </div>

                {% if entry.summary %}
                <div class="border-t border-gray-100 bg-gradient-to-r from-indigo-50/50 to-purple-50/50 px-3 sm:px-4 py-2 sm:py-3 mt-3">
                  <div class="flex items-center text-xs sm:text-sm text-indigo-700 mb-1">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                    </svg>
                    <span class="font-medium">AI Insight</span>
                  </div>
                  <p class="text-xs text-gray-600 handwritten">{{ entry.summary|truncatechars:100 }}</p>
                </div>
                {% endif %}
              </div>
            </div>
          </div>
        {% empty %}
          <div class="empty-state">
            <div class="empty-state-icon">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14-10v2m-2 4h10m-10 4h10m-10 4h10" />
              </svg>
            </div>
            <h3 class="text-lg sm:text-xl font-bold text-gray-800 mb-2">Your Timeline Is Empty</h3>
            <p class="text-sm text-gray-600 mb-4 sm:mb-6 max-w-md mx-auto">Start journaling to build your personal timeline of memories.</p>
            <a href="{% url 'new_entry' %}" class="btn-gradient inline-flex items-center px-4 py-2 rounded-xl text-white font-medium shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all">
              Create Your First Entry
            </a>
          </div>
        {% endfor %}

        {% if entries|length > 10 %}
        <!-- Load More Button -->
        <div class="text-center mt-6 mb-4">
          <button id="loadMoreTimeline" class="px-4 py-2.5 bg-white rounded-xl shadow border border-gray-200 text-gray-700 font-medium hover:bg-gray-50 transition-colors flex items-center mx-auto">
            <span>Load More Entries</span>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- Calendar Tab -->
    <div id="calendar-tab" class="tab-content hidden animate-fade-in">
      <div class="glass-card rounded-xl p-3 sm:p-5 mb-4 sm:mb-6">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-3 sm:mb-4">
          <h3 class="text-lg sm:text-xl font-bold text-gray-800 diary-font">{{ current_month|default:"April 2025" }}</h3>
          <div class="flex items-center gap-2 mt-2 sm:mt-0">
            <button class="p-1.5 sm:p-2 rounded-lg bg-white/70 hover:bg-indigo-50 transition-colors border border-gray-200 shadow-sm">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
              </svg>
            </button>
            <button class="px-2 sm:px-3 py-1 sm:py-1.5 rounded-lg bg-white/70 hover:bg-gray-50 transition-colors border border-gray-200 shadow-sm text-xs sm:text-sm font-medium text-gray-700">
              Today
            </button>
            <button class="p-1.5 sm:p-2 rounded-lg bg-white/70 hover:bg-indigo-50 transition-colors border border-gray-200 shadow-sm">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
            </button>
          </div>
        </div>

        <!-- Calendar header -->
        <div class="grid grid-cols-7 gap-0.5 mb-1 sm:mb-2 text-center">
          <div class="text-xs font-medium text-gray-500 py-1">S</div>
          <div class="text-xs font-medium text-gray-500 py-1">M</div>
          <div class="text-xs font-medium text-gray-500 py-1">T</div>
          <div class="text-xs font-medium text-gray-500 py-1">W</div>
          <div class="text-xs font-medium text-gray-500 py-1">T</div>
          <div class="text-xs font-medium text-gray-500 py-1">F</div>
          <div class="text-xs font-medium text-gray-500 py-1">S</div>
        </div>

        <!-- Calendar grid -->
        <div class="calendar-view">
          <!-- Sample calendar days - in real implementation, this would be dynamic -->
          {% for day in "123456789012345678901234567890"|make_list %}
            {% if forloop.counter <= 30 %}
            <div class="calendar-day {% if forloop.counter == 9 or forloop.counter == 12 or forloop.counter == 16 or forloop.counter == 22 or forloop.counter == 24 %}has-entry{% endif %} {% if forloop.counter == 25 %}bg-indigo-100 border-indigo-300{% endif %}">
              <span class="calendar-day-number {% if forloop.counter == 25 %}font-bold text-indigo-600{% endif %}">{{ forloop.counter }}</span>
              {% if forloop.counter == 9 or forloop.counter == 12 or forloop.counter == 16 or forloop.counter == 22 or forloop.counter == 24 %}
              <div class="calendar-day-indicator"></div>
              {% endif %}
            </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>

      <!-- Entries for selected day -->
      <h3 class="text-lg font-bold text-gray-800 diary-font mb-3 flex items-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
        Entries for {{ selected_date|default:"April 25, 2025" }}
      </h3>

      <!-- Sample entries for the day -->
      <div class="space-y-3 sm:space-y-4">
        <div class="glass-card rounded-xl p-3 sm:p-4 animate-scale-in">
          <div class="flex justify-between items-start mb-2">
            <h4 class="font-bold text-gray-800 text-base sm:text-lg">Morning reflection</h4>
            <div class="mood-pill happy">
              <span>üòä Happy</span>
            </div>
          </div>
          <p class="text-gray-700 handwritten text-xs sm:text-sm mb-2">Started the day with a wonderful sunrise view from my balcony. The way the light filtered through the clouds reminded me that every day brings new possibilities...</p>
          <div class="flex justify-end">
            <a href="#" class="text-indigo-600 text-xs sm:text-sm hover:text-indigo-800 flex items-center gap-1 bg-white/50 px-3 py-1 rounded-full shadow-sm hover:bg-white/80 transition-colors">
              <span>Read full entry</span>
              <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
              </svg>
            </a>
          </div>
        </div>

        <div class="glass-card rounded-xl p-3 sm:p-4 animation-delay-100 animate-scale-in">
          <div class="flex justify-between items-start mb-2">
            <h4 class="font-bold text-gray-800 text-base sm:text-lg">Project breakthrough</h4>
            <div class="mood-pill excited">
              <span>ü§© Excited</span>
            </div>
          </div>
          <p class="text-gray-700 handwritten text-xs sm:text-sm mb-2">Finally solved that coding problem I've been stuck on for days! The solution came to me while I was taking a walk in the park. Sometimes stepping away from the screen is exactly what you need...</p>
          <div class="flex justify-end">
            <a href="#" class="text-indigo-600 text-xs sm:text-sm hover:text-indigo-800 flex items-center gap-1 bg-white/50 px-3 py-1 rounded-full shadow-sm hover:bg-white/80 transition-colors">
              <span>Read full entry</span>
              <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
              </svg>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Mobile Bottom Navigation -->
  <div class="mobile-bottom-nav hidden">
    <button onclick="switchTab('memories')" class="mobile-nav-item active">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mobile-nav-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
      </svg>
      <span class="mobile-nav-label">Memories</span>
    </button>
    <button onclick="switchTab('journals')" class="mobile-nav-item">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mobile-nav-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
      </svg>
      <span class="mobile-nav-label">Journals</span>
    </button>
    <button onclick="switchTab('timeline')" class="mobile-nav-item">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mobile-nav-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14-10v2m-2 4h10m-10 4h10m-10 4h10" />
      </svg>
      <span class="mobile-nav-label">Timeline</span>
    </button>
    <button onclick="switchTab('calendar')" class="mobile-nav-item">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mobile-nav-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
      </svg>
      <span class="mobile-nav-label">Calendar</span>
    </button>
  </div>

  <!-- Floating Action Button -->
  <a href="{% url 'new_entry' %}" class="floating-action-button">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
    </svg>
  </a>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Initialize tabs
  initTabs();
  
  // Initialize load more functionality
  initLoadMore();
  
  // Initialize memory grid interactions
  initMemoryGrid();
  
  // Initialize image preloading
  preloadEntryImages();
  
  // Initialize mobile features
  initMobileFeatures();
  
  // Initialize search functionality
  initSearch();
});

// Mobile-specific features
function initMobileFeatures() {
  if (window.innerWidth <= 768) {
    document.querySelector('.mobile-bottom-nav')?.classList.remove('hidden');
    // NOTE: We don't add pb-16 to page-content anymore since the base template handles scrolling
  }

  // Touch-friendly journal card previews
  const journalCards = document.querySelectorAll('.journal-card');
  journalCards.forEach(card => {
    card.addEventListener('touchstart', function() {
      journalCards.forEach(c => c.classList.remove('touch-active'));
      this.classList.toggle('touch-active');
    });
  });
}

// Tab switching with URL update
function switchTab(tabName) {
  // Hide all tabs
  const allTabs = ['memories', 'journals', 'timeline', 'calendar'];
  allTabs.forEach(tab => {
    const tabElement = document.getElementById(tab + '-tab');
    if (tabElement) {
      tabElement.classList.add('hidden');
    }
  });

  // Show selected tab
  const selectedTab = document.getElementById(tabName + '-tab');
  if (selectedTab) {
    selectedTab.classList.remove('hidden');
  }

  // Update active state on buttons
  document.querySelectorAll('.modern-tab').forEach(btn => {
    btn.classList.remove('active');
    if (btn.getAttribute('onclick')?.includes(tabName)) {
      btn.classList.add('active');
    }
  });

  // Update mobile navigation
  document.querySelectorAll('.mobile-nav-item').forEach(item => {
    item.classList.remove('active');
    if (item.getAttribute('onclick')?.includes(tabName)) {
      item.classList.add('active');
    }
  });

  // Animate tab selector
  const activeTab = document.querySelector(`.modern-tab[onclick*="${tabName}"]`);
  const tabSelector = document.getElementById('tabSelector');

  if (activeTab && tabSelector) {
    const width = activeTab.getAttribute('data-tab-width');
    const offset = activeTab.getAttribute('data-tab-offset');

    if (width && offset) {
      tabSelector.style.width = width;
      tabSelector.style.transform = `translateX(${offset})`;
    }
  }

  // Update URL without page reload
  const url = new URL(window.location);
  url.searchParams.set('tab', tabName);
  window.history.pushState({}, '', url);
}

// Initialize tabs from URL
function initTabs() {
  const urlParams = new URLSearchParams(window.location.search);
  const tabParam = urlParams.get('tab');

  if (tabParam && ['memories', 'journals', 'timeline', 'calendar'].includes(tabParam)) {
    switchTab(tabParam);
  } else {
    switchTab('memories');
  }
}

// Load more functionality
function initLoadMore() {
  const loadMoreButtons = [
    document.getElementById('loadMoreMemories'),
    document.getElementById('loadMoreTimeline')
  ];

  loadMoreButtons.forEach(btn => {
    if (btn) {
      btn.addEventListener('click', function() {
        const originalText = this.innerHTML;
        this.innerHTML = `
          <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-gray-700 inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          Loading...
        `;

        // Simulate loading (replace with actual AJAX call)
        setTimeout(() => {
          this.innerHTML = originalText;
          this.style.display = 'none';
          showToast('All entries loaded');
        }, 1000);
      });
    }
  });
}

// Memory grid hover effects
function initMemoryGrid() {
  const memoryCards = document.querySelectorAll('.memory-card');

  memoryCards.forEach(card => {
    card.addEventListener('mouseenter', function() {
      const img = this.querySelector('.memory-image');
      if (img) {
        img.style.transform = 'scale(1.1)';
      }
    });

    card.addEventListener('mouseleave', function() {
      const img = this.querySelector('.memory-image');
      if (img) {
        img.style.transform = '';
      }
    });
  });
}

// Preload images for better performance
function preloadEntryImages() {
  const images = document.querySelectorAll('.memory-image, .journal-cover');

  images.forEach(img => {
    if (img.src && !img.complete) {
      img.classList.add('loading-shimmer');
      img.onload = function() {
        img.classList.remove('loading-shimmer');
      };
    }
  });
}

// Search functionality
function initSearch() {
  const searchInput = document.querySelector('.search-input');
  if (!searchInput) return;

  let searchTimeout;
  searchInput.addEventListener('input', function(e) {
    clearTimeout(searchTimeout);
    const query = e.target.value.trim();

    searchTimeout = setTimeout(() => {
      if (query.length >= 2) {
        // Implement search functionality
        console.log('Searching for:', query);
        // In real implementation, this would filter entries or make an API call
      }
    }, 300);
  });
}

// Toast notification
function showToast(message) {
  const toast = document.createElement('div');
  toast.className = 'fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-fade-in text-sm';
  toast.textContent = message;

  document.body.appendChild(toast);

  setTimeout(() => {
    toast.style.opacity = '0';
    toast.style.transform = 'translate(-50%, 10px)';
    setTimeout(() => {
      document.body.removeChild(toast);
    }, 500);
  }, 3000);
}

// Filter chip functionality
document.querySelectorAll('.filter-chip').forEach(chip => {
  if (!chip.classList.contains('active') && chip.tagName.toLowerCase() !== 'a') {
    chip.addEventListener('click', function() {
      const currentActive = this.parentNode.querySelector('.filter-chip.active');
      if (currentActive) {
        currentActive.classList.remove('active');
      }
      this.classList.add('active');
      
      // Implement filtering logic here
      const filterType = this.textContent.trim();
      console.log('Filter activated:', filterType);
    });
  }
});

// Calendar day selection
document.querySelectorAll('.calendar-day').forEach(day => {
  day.addEventListener('click', function() {
    if (!this.classList.contains('opacity-40')) {
      document.querySelectorAll('.calendar-day').forEach(d => {
        d.style.backgroundColor = '';
        d.style.borderColor = '';
        const num = d.querySelector('.calendar-day-number');
        if (num) {
          num.classList.remove('font-bold', 'text-indigo-600');
        }
      });

      this.style.backgroundColor = 'rgba(99, 102, 241, 0.15)';
      this.style.borderColor = 'rgba(99, 102, 241, 0.3)';
      const num = this.querySelector('.calendar-day-number');
      if (num) {
        num.classList.add('font-bold', 'text-indigo-600');
      }

      // Update day entries header
      const dayNumber = this.querySelector('.calendar-day-number').textContent;
      const monthHeader = document.querySelector('.diary-font').textContent;
      const entriesHeader = document.querySelector('h3:last-of-type');
      if (entriesHeader && entriesHeader.textContent.includes('Entries for')) {
        entriesHeader.childNodes[1].textContent = `Entries for ${monthHeader.split(' ')[0]} ${dayNumber}, ${monthHeader.split(' ')[1]}`;
      }
    }
  });
});

// Handle window resize
window.addEventListener('resize', function() {
  const mobileNav = document.querySelector('.mobile-bottom-nav');

  if (window.innerWidth <= 768) {
    if (mobileNav) mobileNav.classList.remove('hidden');
    // NOTE: We don't add pb-16 anymore
  } else {
    if (mobileNav) mobileNav.classList.add('hidden');
  }
});

// Make functions available globally
window.switchTab = switchTab;
window.showToast = showToast;
</script>
{% endblock %}